# Beem Video AI - Telegram Bot MVP

–õ–æ–∫–∞–ª—å–Ω—ã–π MVP Telegram-–±–æ—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ –∏–∑ —Ñ–æ—Ç–æ –∏ —Ç–µ–∫—Å—Ç–∞.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üì∏ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ (JPEG)
- üìù –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- üé¨ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ (6-10 —Å–µ–∫—É–Ω–¥)
- ‚è≥ Real-time –ø—Ä–æ–≥—Ä–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- üíæ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ –≤–∏–¥–µ–æ –ø—Ä—è–º–æ –≤ Telegram

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–ª—É—á–∏ Telegram Bot Token

1. –û—Ç–∫—Ä–æ–π [@BotFather](https://t.me/botfather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å `/newbot`
3. –°–ª–µ–¥—É–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –∏ —Å–∫–æ–ø–∏—Ä—É–π —Ç–æ–∫–µ–Ω

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd bot
npm install
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env.local
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π `.env.local` –∏ –¥–æ–±–∞–≤—å —Ç–æ–∫–µ–Ω:

```env
TELEGRAM_BOT_TOKEN=YOUR_TOKEN_HERE
BEEM_BASE_URL=http://localhost:4321
```

### 4. –ó–∞–ø—É—Å–∫ Astro backend (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)

```bash
cd astro
npm install
npm run dev
```

Backend –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:4321`

### 5. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)

```bash
cd bot
npm run dev
```

–í—ã–≤–æ–¥:
```
ü§ñ Starting Beem Telegram Bot...
üì° Checking backend at http://localhost:4321...
‚úÖ Backend is available
‚úÖ Bot is running!
‚úÖ Logged in as @your_bot_name
```

## üì± –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω

```
/start ‚Üí –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∫–Ω–æ–ø–∫–∞ "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ"
```

### –ü—Ä–∏–º–µ—Ä –¥–∏–∞–ª–æ–≥–∞

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: `/start`
   - **–ë–æ—Ç**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –∫–Ω–æ–ø–∫—É "üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ"

2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ
   - **–ë–æ—Ç**: "‚úÖ –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ! –ù–∞–ø–∏—à–∏ –æ–ø–∏—Å–∞–Ω–∏–µ..."

3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: "–ö—Ä–∞—Å–∏–≤—ã–π –∑–∞–∫–∞—Ç –Ω–∞–¥ –º–æ—Ä–µ–º —Å –ø–µ–Ω–∏–µ–º –ø—Ç–∏—Ü"
   - **–ë–æ—Ç**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—é–º–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: –ù–∞–∂–∏–º–∞–µ—Ç "‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å"
   - **–ë–æ—Ç**: "‚è≥ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –≤–∏–¥–µ–æ... (0%, 25%, 50%...)"
   - –ß–µ—Ä–µ–∑ 1-3 –º–∏–Ω—É—Ç—ã: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–∏–¥–µ–æ –≤ Telegram

5. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: –ú–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ–µ –≤–∏–¥–µ–æ –∏–ª–∏ –æ—Ç–º–µ–Ω–∏—Ç—å

## üìã API Endpoints

### POST /api/telegram/generate

–°–æ–∑–¥–∞—ë—Ç –∑–∞–¥–∞—á—É –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –≤–∏–¥–µ–æ.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã** (multipart/form-data):
- `telegram_user_id` (required) - ID Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `photo` (required) - JPEG —Ñ–∞–π–ª
- `prompt` (required) - –¢–µ–∫—Å—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç (–º–∞–∫—Å 2000 —Å–∏–º–≤–æ–ª–æ–≤)
- `duration` (optional) - 6 –∏–ª–∏ 10 —Å–µ–∫—É–Ω–¥ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 6)

**–û—Ç–≤–µ—Ç**:
```json
{
  "success": true,
  "generationId": "tg_gen_1234567890_abc123",
  "status": "queued",
  "cost": 1
}
```

### GET /api/telegram/status?generation_id=...

–ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `generation_id` (required) - ID –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**–û—Ç–≤–µ—Ç**:
```json
{
  "success": true,
  "generationId": "tg_gen_1234567890_abc123",
  "status": "processing",
  "video_url": "/storage/tg_123456789/output.mp4"
}
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã**:
- `queued` - –í –æ—á–µ—Ä–µ–¥–∏ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É
- `processing` - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è
- `done` - –ì–æ—Ç–æ–≤–æ (–µ—Å—Ç—å `video_url`)
- `failed` - –û—à–∏–±–∫–∞

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
bot/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts           # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –±–æ—Ç–∞ (handlers, keyboard)
‚îÇ   ‚îú‚îÄ‚îÄ state.ts           # In-memory —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ api.ts             # HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è backend
‚îÇ   ‚îî‚îÄ‚îÄ types.ts           # TypeScript —Ç–∏–ø—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ package.json           # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ tsconfig.json          # TypeScript –∫–æ–Ω—Ñ–∏–≥
‚îú‚îÄ‚îÄ .env.example           # –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ README.md              # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üîß –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (in-memory)

```typescript
UserState {
  step: 'waiting_photo' | 'waiting_prompt' | 'confirm' | 'generating'
  photo_file_id: string // Telegram file_id
  photo_path: string // –õ–æ–∫–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–æ—Ç–æ
  prompt_text: string // –¢–µ–∫—Å—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç
  last_generation_id: string // ID –ø–æ—Å–ª–µ–¥–Ω–µ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
  last_generation_status: string // –°—Ç–∞—Ç—É—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
}
```

–°–æ—Å—Ç–æ—è–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞—é—Ç—Å—è –∫–∞–∂–¥—ã–π —á–∞—Å.

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- **–§–æ—Ç–æ**: `bot/tmp/bot/photo_{USER_ID}.jpg`
- **–í–∏–¥–µ–æ**: `bot/tmp/bot/video_{USER_ID}.mp4`

–û—á–∏—â–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ë–æ—Ç –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è:

```
[BOT_START] user=123456789
[BOT_PHOTO_RECEIVED] user=123456789 length: 1024
[BOT_PROMPT_RECEIVED] user=123456789 length: 42
[BOT_GENERATE_CLICK] user=123456789
[TG_GENERATE_CREATED] user=123456789 generation_id: tg_gen_...
[TG_STATUS] user=123456789 status: processing
[BOT_DONE] user=123456789
[API] Generation started: tg_gen_...
[API] Video downloaded: bot/tmp/bot/video_123456789.mp4
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|-----------|---------|------------|
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω –æ—Ç @BotFather | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ |
| `BEEM_BASE_URL` | –ê–¥—Ä–µ—Å backend | http://localhost:4321 |

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã

| –ò–Ω—Ç–µ—Ä–≤–∞–ª | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|---------|
| Polling —Å—Ç–∞—Ç—É—Å–∞ | 1 —Å–µ–∫ |
| –ú–∞–∫—Å –æ–∂–∏–¥–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ | 2 –º–∏–Ω—É—Ç—ã (120 –ø–æ–ø—ã—Ç–æ–∫) |
| –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è | 3 —á–∞—Å–∞ –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä—å backend

```bash
curl http://localhost:4321/
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å HTML –∏–ª–∏ JSON –±–µ–∑ –æ—à–∏–±–æ–∫.

### –ü—Ä–æ–≤–µ—Ä—å Telegram —Ç–æ–∫–µ–Ω

```bash
curl https://api.telegram.org/botTOKEN/getMe
```

### –õ–æ–≥–∏ –±–æ—Ç–∞

–ë–æ—Ç –≤—ã–≤–æ–¥–∏—Ç –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –≤ –∫–æ–Ω—Å–æ–ª—å —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[EVENT_TYPE]`.

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –Ω–∞–ø—Ä—è–º—É—é

```bash
# 1. –°–æ—Ö—Ä–∞–Ω–∏ —Ç–µ—Å—Ç–æ–≤–æ–µ —Ñ–æ—Ç–æ
curl https://example.com/test.jpg -o test.jpg

# 2. –ó–∞–ø—É—Å—Ç–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
curl -X POST http://localhost:4321/api/telegram/generate \
  -F telegram_user_id=123456789 \
  -F photo=@test.jpg \
  -F prompt="–∫—Ä–∞—Å–∏–≤–æ–µ –∑–∞–∫–∞—Ç–Ω–æ–µ –Ω–µ–±–æ"

# 3. –ü–æ–ª—É—á–∏ —Å—Ç–∞—Ç—É—Å
curl http://localhost:4321/api/telegram/status?generation_id=tg_gen_...
```

## üí° MVP –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- **–ë–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**: –õ—é–±–æ–π –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –≤—Å–µ –æ–¥–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
- **–ë–µ–∑ –±–∞–ª–∞–Ω—Å–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤**: –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–Ω–∞ –ø–µ—Ä–≤—ã–π —ç—Ç–∞–ø)
- **–¢–æ–ª—å–∫–æ JPEG —Ñ–æ—Ç–æ**: –î—Ä—É–≥–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è
- **–ú–∞–∫—Å–∏–º—É–º 2000 —Å–∏–º–≤–æ–ª–æ–≤**: –í —Ç–µ–∫—Å—Ç–æ–≤–æ–º –ø—Ä–æ–º–ø—Ç–µ
- **In-memory —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: –¢–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ –±–æ—Ç–∞
- **–ë–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—à–∏–±–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É**: –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Å–æ–ª—å

## üìà –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –∫—Ä–µ–¥–∏—Ç–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–µ–π (YooKassa)
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
- [ ] –£–ª—É—á—à–µ–Ω–∏–µ UI –∫–ª–∞–≤–∏–∞—Ç—É—Ä
- [ ] –†–∞–∑–Ω—ã–µ —Ä–µ–∂–∏–º—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (template/prompt)
- [ ] Admin-–ø–∞–Ω–µ–ª—å
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

## üÜò –ü–æ–º–æ—â—å

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**
   - –ü—Ä–æ–≤–µ—Ä—å —Ç–æ–∫–µ–Ω –≤ `.env.local`
   - –ó–∞–ø—É—Å—Ç–∏ `npm run dev` –≤ –ø–∞–ø–∫–µ `bot`

2. **Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω**
   - –£–±–µ–¥–∏—Å—å —á—Ç–æ Astro –∑–∞–ø—É—â–µ–Ω: `npm run dev` –≤ –ø–∞–ø–∫–µ `astro`
   - –ü—Ä–æ–≤–µ—Ä—å `BEEM_BASE_URL` –≤ `.env.local`

3. **–í–∏–¥–µ–æ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è**
   - –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Astro backend
   - –£–±–µ–¥–∏—Å—å —á—Ç–æ MiniMax API –∫–ª—é—á –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ Astro `.env`

4. **–û—à–∏–±–∫–∏ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ TypeScript**
   - –ó–∞–ø—É—Å—Ç–∏ `npm install` –≤ –ø–∞–ø–∫–µ `bot`
   - –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `rm -rf node_modules && npm install`

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
