# üìã –°–ø–∏—Å–æ–∫ –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–ª—è Telegram Bot MVP

## üîß Backend Endpoints (Astro)

### 1. `/astro/src/pages/api/telegram/generate.ts` (243 —Å—Ç—Ä–æ–∫)

**–§—É–Ω–∫—Ü–∏—è**: –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –≤–∏–¥–µ–æ

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** (multipart/form-data):
- `telegram_user_id` - ID Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `photo` - JPEG —Ñ–∞–π–ª
- `prompt` - –¢–µ–∫—Å—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç
- `duration` - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–í—ã—Ö–æ–¥**: `{ success, generationId, status: 'queued', cost }`

**–ö–ª—é—á–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**:
1. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–æ—Ç–æ –≤ `/storage/tg_{id}/image.jpg`
2. –£–ª—É—á—à–∞–µ—Ç –ø—Ä–æ–º–ø—Ç —á–µ—Ä–µ–∑ GPT-4o-mini (enhancePrompt)
3. –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç camera commands (compileCameraCommands)
4. –°–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î —Ç–∞–±–ª–∏—Ü–∞ `generations`
5. –î–æ–±–∞–≤–ª—è–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å (enqueueGeneration)
6. –ó–∞–ø—É—Å–∫–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É (processQueue)

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
- `enhancePrompt()` –∏–∑ `/lib/promptEnhancer.ts`
- `compileCameraCommands()` –∏–∑ `/lib/cameraPromptCompiler.ts`
- `enqueueGeneration()` –∏–∑ `/lib/minimax/queue.ts`
- `processQueue()` –∏–∑ `/lib/minimax/processor.ts`
- `notifyAdmin()` –∏–∑ `/lib/telegramNotifier.ts`

### 2. `/astro/src/pages/api/telegram/status.ts` (59 —Å—Ç—Ä–æ–∫)

**–§—É–Ω–∫—Ü–∏—è**: –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** (query string):
- `generation_id` - ID –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**–í—ã—Ö–æ–¥**: `{ success, generationId, status: 'queued|processing|done|failed', video_url? }`

**–ö–ª—é—á–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**:
1. –ü–æ–ª—É—á–∞–µ—Ç –∑–∞–ø–∏—Å—å –∏–∑ –ë–î —Ç–∞–±–ª–∏—Ü–∞ `generations`
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ —ç—Ç–æ Telegram –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (userId –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `tg_`)
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∏ URL –≤–∏–¥–µ–æ (–µ—Å–ª–∏ –≥–æ—Ç–æ–≤–æ)

## ü§ñ Telegram Bot (Node.js)

### 3. `/bot/src/index.ts` (550+ —Å—Ç—Ä–æ–∫)

**–§—É–Ω–∫—Ü–∏—è**: –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª Telegram-–±–æ—Ç–∞ —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `grammy` - Telegram Bot Framework
- `axios` - HTTP –∫–ª–∏–µ–Ω—Ç
- `dotenv` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–ö–ª—é—á–µ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏**:

1. **`/start` –∫–æ–º–∞–Ω–¥–∞**
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
   - –ö–Ω–æ–ø–∫–∞ "üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ"
   - –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

2. **`start_photo` –∫–Ω–æ–ø–∫–∞**
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —à–∞–≥ –Ω–∞ `waiting_photo`
   - –ü—Ä–æ—Å–∏—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ

3. **`message:photo` –æ–±—Ä–∞–±–æ—Ç—á–∏–∫**
   - –ü–æ–ª—É—á–∞–µ—Ç —Ñ–æ—Ç–æ –∏–∑ Telegram
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ –≤ `/tmp/bot/photo_{id}.jpg`
   - –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —à–∞–≥ `waiting_prompt`

4. **`message:text` –æ–±—Ä–∞–±–æ—Ç—á–∏–∫**
   - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–ª–∏–Ω—É –ø—Ä–æ–º–ø—Ç–∞ (3-2000 —Å–∏–º–≤–æ–ª–æ–≤)
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—é–º–µ —Å 4 –∫–Ω–æ–ø–∫–∞–º–∏:
     - "‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å"
     - "‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç"
     - "üì∏ –ó–∞–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ"
     - "‚ùå –û—Ç–º–µ–Ω–∞"

5. **`confirm_generate` –∫–Ω–æ–ø–∫–∞**
   - –í—ã–∑—ã–≤–∞–µ—Ç `POST /api/telegram/generate`
   - –ù–∞—á–∏–Ω–∞–µ—Ç polling `/api/telegram/status` –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å (0%, 25%, 50%, 75%, 100%)
   - –°–∫–∞—á–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ –∫–æ–≥–¥–∞ `status == 'done'`
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–∏–¥–µ–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

6. **`cancel_generation` –∫–Ω–æ–ø–∫–∞**
   - –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ
   - –û—á–∏—â–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- `[BOT_START]` - –Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
- `[BOT_PHOTO_RECEIVED]` - –ø–æ–ª—É—á–µ–Ω–æ —Ñ–æ—Ç–æ
- `[BOT_PROMPT_RECEIVED]` - –ø–æ–ª—É—á–µ–Ω –ø—Ä–æ–º–ø—Ç
- `[BOT_GENERATE_CLICK]` - –∫–ª–∏–∫ –ø–æ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å"
- `[TG_GENERATE_CREATED]` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- `[TG_STATUS]` - —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—ë–Ω
- `[BOT_DONE]` - –≤–∏–¥–µ–æ –≥–æ—Ç–æ–≤–æ
- `[BOT_ERROR]` - –æ—à–∏–±–∫–∞

### 4. `/bot/src/state.ts` (97 —Å—Ç—Ä–æ–∫)

**–§—É–Ω–∫—Ü–∏—è**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ in-memory —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å UserState**:
```typescript
{
  step: 'waiting_photo' | 'waiting_prompt' | 'confirm' | 'generating'
  photo_file_id: string | null
  photo_path: string | null
  prompt_text: string | null
  last_generation_id: string | null
  last_generation_status: string | null
  last_update: number
}
```

**–ú–µ—Ç–æ–¥—ã**:
- `getState(userId)` - –ø–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- `setState(userId, updates)` - –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- `resetState(userId)` - —Å–±—Ä–æ—Å–∏—Ç—å –Ω–∞ –Ω–∞—á–∞–ª—å–Ω–æ–µ
- `deleteState(userId)` - —É–¥–∞–ª–∏—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é
- `getActiveCount()` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞**: –£–¥–∞–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç–∞—Ä—à–µ 3 —á–∞—Å–æ–≤ –∫–∞–∂–¥—ã–π —á–∞—Å

### 5. `/bot/src/api.ts` (145 —Å—Ç—Ä–æ–∫)

**–§—É–Ω–∫—Ü–∏—è**: HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å Astro backend

**–§—É–Ω–∫—Ü–∏–∏**:

1. **`generateVideo(telegramUserId, photoPath, prompt, duration)`**
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `POST /api/telegram/generate`
   - –ß–∏—Ç–∞–µ—Ç —Ñ–æ—Ç–æ —Å –¥–∏—Å–∫–∞
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ success, generationId, status, cost }`

2. **`getGenerationStatus(generationId)`**
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `GET /api/telegram/status`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ success, status, video_url? }`

3. **`downloadVideo(videoUrl, outputPath)`**
   - –°–∫–∞—á–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ –ø–æ URL
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏ (`/storage/...`)
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `outputPath`

4. **`checkBackendHealth()`**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å backend
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞

**–û—à–∏–±–∫–∏**: –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–±—Ä–∞—Å—ã–≤–∞—é—Ç –æ—à–∏–±–∫—É –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–µ

## üì¶ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 6. `/bot/package.json` (31 —Å—Ç—Ä–æ–∫–∞)

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `grammy@^1.24.1` - Telegram Bot Framework
- `axios@^1.6.5` - HTTP –∫–ª–∏–µ–Ω—Ç
- `dotenv@^16.3.1` - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**Dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `@types/node@^20.10.5`
- `typescript@^5.3.3`
- `tsx@^4.7.0` - –ó–∞–ø—É—Å–∫ TypeScript –Ω–∞–ø—Ä—è–º—É—é

**Scripts**:
- `npm run dev` - –ó–∞–ø—É—Å–∫ —Å hot reload
- `npm run build` - –ö–æ–º–ø–∏–ª—è—Ü–∏—è TypeScript
- `npm start` - –ó–∞–ø—É—Å–∫ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞

### 7. `/bot/tsconfig.json` (17 —Å—Ç—Ä–æ–∫)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏**:
- Target: ES2020
- Module: ESNext
- Strict mode: –≤–∫–ª—é—á–µ–Ω
- Source root: `./src`
- Output: `./dist`

### 8. `/bot/.env.example` (7 —Å—Ç—Ä–æ–∫)

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
- `TELEGRAM_BOT_TOKEN` - –¢–æ–∫–µ–Ω –æ—Ç @BotFather (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω)
- `BEEM_BASE_URL` - –ê–¥—Ä–µ—Å backend (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é http://localhost:4321)

### 9. `/bot/.gitignore` (9 —Å—Ç—Ä–æ–∫)

–ò—Å–∫–ª—é—á–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã:
- `node_modules/`
- `dist/`
- `.env.local`
- `*.mp4`, `*.jpg`
- `tmp/`

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### 10. `/bot/README.md` (300+ —Å—Ç—Ä–æ–∫)

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ**:
- –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
- API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- –û—Ç–ª–∞–¥–∫–∞
- MVP –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### 11. `/astro/TELEGRAM_BOT_MVP.md` (600+ —Å—Ç—Ä–æ–∫)

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ**:
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã (–¥–∏–∞–≥—Ä–∞–º–º–∞)
- –ü–æ–ª–Ω—ã–π –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ curl
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞
- –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- –ß–µ–∫–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (30+ –ø—É–Ω–∫—Ç–æ–≤)
- –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

### 12. `/astro/TELEGRAM_BOT_QUICKSTART.sh` (60 —Å—Ç—Ä–æ–∫)

**–§—É–Ω–∫—Ü–∏—è**: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å —à–∞–≥–∞–º–∏ –∑–∞–ø—É—Å–∫–∞

**–í—ã–≤–æ–¥**:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ Node.js
- –ü–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### 13. `/astro/TELEGRAM_BOT_FILES.md` (—ç—Ç–æ—Ç —Ñ–∞–π–ª)

**–§—É–Ω–∫—Ü–∏—è**: –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ |
|-----------|-----------|
| **Backend endpoints** | 2 —Ñ–∞–π–ª–∞ (302 —Å—Ç—Ä–æ–∫) |
| **Bot source** | 3 —Ñ–∞–π–ª–∞ (792 —Å—Ç—Ä–æ–∫) |
| **Config files** | 4 —Ñ–∞–π–ª–∞ (64 —Å—Ç—Ä–æ–∫) |
| **Documentation** | 4 —Ñ–∞–π–ª–∞ (1000+ —Å—Ç—Ä–æ–∫) |
| **–í–°–ï–ì–û** | 13 —Ñ–∞–π–ª–æ–≤ (2000+ —Å—Ç—Ä–æ–∫) |

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –Ω–∞ –¥–∏—Å–∫–µ

```
/astro/
‚îú‚îÄ‚îÄ src/pages/api/telegram/
‚îÇ   ‚îú‚îÄ‚îÄ generate.ts          (243 —Å—Ç—Ä–æ–∫) ‚úÖ –ù–û–í–´–ô
‚îÇ   ‚îî‚îÄ‚îÄ status.ts            (59 —Å—Ç—Ä–æ–∫)  ‚úÖ –ù–û–í–´–ô
‚îÇ
‚îú‚îÄ‚îÄ bot/                                  ‚úÖ –ù–û–í–ê–Ø –ü–ê–ü–ö–ê
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts         (550+ —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ state.ts         (97 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.ts           (145 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ package.json         (31 —Å—Ç—Ä–æ–∫–∞)
‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json        (17 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ .env.example         (7 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ .gitignore           (9 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ README.md            (300+ —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îî‚îÄ‚îÄ tmp/                 (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îÇ
‚îú‚îÄ‚îÄ TELEGRAM_BOT_MVP.md      (600+ —Å—Ç—Ä–æ–∫) ‚úÖ –ù–û–í–´–ô
‚îú‚îÄ‚îÄ TELEGRAM_BOT_QUICKSTART.sh (60 —Å—Ç—Ä–æ–∫) ‚úÖ –ù–û–í–´–ô
‚îú‚îÄ‚îÄ TELEGRAM_BOT_FILES.md    (—ç—Ç–æ—Ç —Ñ–∞–π–ª) ‚úÖ –ù–û–í–´–ô
‚îÇ
‚îî‚îÄ‚îÄ ... (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã)
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å—ë —Å–æ–∑–¥–∞–Ω–æ

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º backend endpoints
ls -la astro/src/pages/api/telegram/
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: generate.ts, status.ts

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–æ—Ç
ls -la astro/bot/
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: package.json, tsconfig.json, .env.example, README.md, src/

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
ls -la astro/TELEGRAM_BOT_*
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: MVP.md, QUICKSTART.sh, FILES.md (—ç—Ç–æ—Ç)
```

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

1. **–ü–µ—Ä–≤—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª** (Backend):
   ```bash
   cd astro
   npm install
   npm run dev
   ```

2. **–í—Ç–æ—Ä–æ–π —Ç–µ—Ä–º–∏–Ω–∞–ª** (Bot):
   ```bash
   cd bot
   npm install
   cp .env.example .env.local
   # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π .env.local –∏ –¥–æ–±–∞–≤—å TELEGRAM_BOT_TOKEN
   npm run dev
   ```

3. **Telegram**:
   - –û—Ç–∫—Ä–æ–π —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞
   - –û—Ç–ø—Ä–∞–≤—å `/start`
   - –°–ª–µ–¥—É–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º

## üîÑ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

Telegram Bot –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É Beem:

- ‚úÖ `enhancePrompt()` - —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ —á–µ—Ä–µ–∑ GPT
- ‚úÖ `compileCameraCommands()` - –∫–æ–º–ø–∏–ª—è—Ü–∏—è camera commands
- ‚úÖ `enqueueGeneration()` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å
- ‚úÖ `processQueue()` - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- ‚úÖ `notifyAdmin()` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram
- ‚úÖ SQLite –ë–î —Ç–∞–±–ª–∏—Ü–∞ `generations`
- ‚úÖ MiniMax Video API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ `/storage/`

**–ù–∏—á–µ–≥–æ –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–æ, –≤—Å—ë –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ!** ‚úÖ

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

- –ò—Å–ø–æ–ª—å–∑—É–µ–º `telegram_user_id` –∫–∞–∫ –≥–ª–∞–≤–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –ø–∞–ø–∫–∞–º `/storage/tg_{id}/`
- –ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π users/sessions

### 2. –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

- In-memory Map –≤ `stateManager`
- –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –∫–∞–∂–¥—ã–π —á–∞—Å
- –¢–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ (MVP limitation)

### 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ

- –û–¥–Ω–∞ –∏ —Ç–∞ –∂–µ –æ—á–µ—Ä–µ–¥—å `processQueue()` –¥–ª—è –≤—Å–µ—Ö (—Ç–≥ –∏ web)
- –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PROMPT MODE (—Å–≤–æ–±–æ–¥–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π)
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞

### 4. Polling —Å—Ç–∞—Ç—É—Å–∞

- –ë–æ—Ç –¥–µ–ª–∞–µ—Ç GET –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –¥–æ 2 –º–∏–Ω—É—Ç
- –ú–∞–∫—Å–∏–º—É–º 120 –ø–æ–ø—ã—Ç–æ–∫
- Timeout –µ—Å–ª–∏ –≤–∏–¥–µ–æ —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (MVP)

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –≠—Ç–æ MVP, –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ!

- ‚ùå –ù–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–ª—é–±–æ–π –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å)
- ‚ùå –ù–µ—Ç rate limiting
- ‚ùå –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç spam/abuse
- ‚ùå –ù–µ—ÇÈ™åËØÅ Telegram webhook signature

–î–ª—è production –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤
- ‚úÖ YooKassa –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ Rate limiting
- ‚úÖ Telegram webhook verification
- ‚úÖ Admin-–ø–∞–Ω–µ–ª—å –¥–ª—è ban –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏:

**Backend**:
- `[TG_GEN*]` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ
- `[TG_STATUS]` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- `[API]` - API endpoints
- `[PROCESSOR]` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏

**Bot**:
- `[BOT_*]` - —Å–æ–±—ã—Ç–∏—è –±–æ—Ç–∞
- `[TG_*]` - Telegram-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- `[API]` - HTTP –∑–∞–ø—Ä–æ—Å—ã

## üéì –ò–∑—É—á–µ–Ω–∏–µ –∫–æ–¥–∞

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫:

1. –ù–∞—á–Ω–∏ —Å `/bot/README.md` - –±—ã—Å—Ç—Ä—ã–π –æ–±–∑–æ—Ä
2. –ü–æ—Å–º–æ—Ç—Ä–∏ `/bot/src/state.ts` - –ø—Ä–æ—Å—Ç–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ
3. –ü–æ—Å–º–æ—Ç—Ä–∏ `/bot/src/api.ts` - HTTP –∫–ª–∏–µ–Ω—Ç
4. –ü–æ—Å–º–æ—Ç—Ä–∏ `/bot/src/index.ts` - –≥–ª–∞–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ (550+ —Å—Ç—Ä–æ–∫)
5. –ü–æ—Å–º–æ—Ç—Ä–∏ `/astro/src/pages/api/telegram/generate.ts` - backend
6. –ü—Ä–æ—á–∏—Ç–∞–π `TELEGRAM_BOT_MVP.md` - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –¥–µ—Ç–∞–ª–∏

## üìû –í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã

**Q: –ü–æ—á–µ–º—É in-memory —Å–æ—Å—Ç–æ—è–Ω–∏–µ?**
A: MVP - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫. Production –≤–µ—Ä—Å–∏—è –¥–æ–ª–∂–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis.

**Q: –ü–æ—á–µ–º—É –≤—Å–µ–≥–¥–∞ PROMPT MODE?**
A: Telegram —Ç—Ä–µ–±—É–µ—Ç –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞. TEMPLATE MODE —Ç—Ä–µ–±—É–µ—Ç –≤—ã–±–æ—Ä–∞ –∏–∑ —Å–ø–∏—Å–∫–∞.

**Q: –ü–æ—á–µ–º—É –Ω–µ—Ç –ë–î –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π?**
A: –ò–∑–±–µ–≥–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏–π –ë–î. –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∏ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ.

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é?**
A: –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `telegram_users` —Å `telegram_id` –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π YooKassa.

**Q: –ö–∞–∫ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –Ω–∞ production?**
A: –ü–æ—Å–º–æ—Ç—Ä–∏ —Ä–∞–∑–¥–µ–ª "–ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è" –≤ TELEGRAM_BOT_MVP.md
