# ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ MiniMax

## –ß—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ ‚úÖ

- [x] –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å MiniMax API (`/src/lib/minimax/`)
- [x] Endpoint –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (`/api/upload-image`)
- [x] –û–±–Ω–æ–≤–ª–µ–Ω endpoint –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (`/api/generate`)
- [x] Webhook –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (`/api/minimax_callback`)
- [x] –û–±–Ω–æ–≤–ª–µ–Ω —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (`app.astro`)
- [x] –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î (–Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏)
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ç–µ–±–µ üöÄ

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å MiniMax API –∫–ª—é—á
- [ ] –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ https://www.minimaxi.com/
- [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
- [ ] –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á (–≤–∏–¥–∞ `sk-api-xxxxx`)
- [ ] –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å .env.local

```bash
# –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ /home/user/ai/astro/
cp .env.example .env.local
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `.env.local`:

```env
MINIMAX_API_KEY=sk-api-xxxxx
MINIMAX_CALLBACK_URL=https://yourdomain.com/api/minimax_callback
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å callback URL

#### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (—Å ngrok):

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ngrok (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
brew install ngrok

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å ngrok
ngrok http 3000

# 3. –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ - –¥–æ–±–∞–≤–∏—Ç—å URL –≤ .env.local
MINIMAX_CALLBACK_URL=https://xxxxxxxx.ngrok-free.app/api/minimax_callback
```

#### Production:

```env
MINIMAX_CALLBACK_URL=https://yourdomain.com/api/minimax_callback
```

### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç

```bash
cd /home/user/ai/astro
npm run dev
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
```
‚úÖ Database initialized with billing tables
‚úÖ Migration: Added minimax_job_id column
‚úÖ Migration: Added video_url column
‚úÖ Migration: Added minimax_status column
```

### –®–∞–≥ 5: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

1. **–û—Ç–∫—Ä–æ–∏—Ç—å –±—Ä–∞—É–∑–µ—Ä:** http://localhost:3000
2. **–í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç** (Sign in)
3. **–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞** /app (Generate page)
4. **–í—ã–±—Ä–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ** (jpg)
5. **–ù–∞–ø–∏—Å–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ** (–Ω–∞–ø—Ä–∏–º–µ—Ä: "—Ç–æ–≤–∞—Ä –≤—Ä–∞—â–∞–µ—Ç—Å—è")
6. **–í—ã–±—Ä–∞—Ç—å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** (6 –∏–ª–∏ 10 —Å–µ–∫)
7. **–ù–∞–∂–∞—Ç—å Generate**
8. **–ñ–¥–∞—Ç—å** (1-5 –º–∏–Ω—É—Ç)
9. **–í–∏–¥–µ—Ç—å –≥–æ—Ç–æ–≤–æ–µ –≤–∏–¥–µ–æ** ‚úÖ

### –®–∞–≥ 6: –ö–æ–º–º–∏—Ç–∏—Ç—å –∏ –ø—É—à–∏—Ç—å –∫–æ–¥

```bash
cd /home/user/ai/astro
git add -A
git commit -m "feat: integrate MiniMax real video generation"
git push origin claude/explore-astro-ai-G0zFW
```

---

## –§–∞–π–ª—ã –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã/–æ–±–Ω–æ–≤–ª–µ–Ω—ã

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `/src/lib/minimax/imageToBase64.ts`
- ‚úÖ `/src/lib/minimax/callMinimaxAPI.ts`
- ‚úÖ `/src/lib/minimax/downloadVideoFromMinimax.ts`
- ‚úÖ `/src/pages/api/upload-image.ts`
- ‚úÖ `/src/pages/api/minimax_callback.ts`
- ‚úÖ `/uploads/` (–ø–∞–ø–∫–∞)
- ‚úÖ `/videos/` (–ø–∞–ø–∫–∞)
- ‚úÖ `.env.example`
- ‚úÖ `ENV_SETUP.md`
- ‚úÖ `MINIMAX_INTEGRATION.md`
- ‚úÖ `MINIMAX_SETUP.md`

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `/src/lib/db.ts` (–º–∏–≥—Ä–∞—Ü–∏—è)
- ‚úÖ `/src/lib/billing/chargeGeneration.ts` (–Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)
- ‚úÖ `/src/pages/api/generate.ts` (–≤—ã–∑–æ–≤ MiniMax)
- ‚úÖ `/src/pages/app.astro` (—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –≤ –ª–æ–≥–∞—Ö –±—É–¥—É—Ç:

```
[UPLOAD] ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: /uploads/image.jpg
[GEN] –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ MiniMax: generation=gen_1234567890_userID
[MINIMAX] ‚úÖ Task created: task_xyz
[CALLBACK] ‚úÖ MiniMax success: generationId=gen_1234567890_userID
[DOWNLOAD] ‚úÖ –í–∏–¥–µ–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: /videos/output.mp4 (1234567 –±–∞–π—Ç)
[CHARGE] user=googleID before=5 cost=1 after=4
```

### –§–∞–π–ª—ã –Ω–∞ –¥–∏—Å–∫–µ

```bash
# –î–æ–ª–∂–Ω—ã —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å:
ls -la /home/user/ai/astro/uploads/image.jpg
ls -la /home/user/ai/astro/videos/output.mp4
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏:
sqlite3 vr_ai.db "PRAGMA table_info(generations);"

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–æ–ª–æ–Ω–∫–∏:
# - minimax_job_id
# - video_url
# - minimax_status
```

---

## –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|---------|---------|
| "MINIMAX_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω" | –î–æ–±–∞–≤—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ `.env.local` |
| Callback –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç | –ü—Ä–æ–≤–µ—Ä—å MINIMAX_CALLBACK_URL (–∏—Å–ø–æ–ª—å–∑—É–π ngrok –¥–ª—è –ª–æ–∫–∞–ª–∏) |
| –í–∏–¥–µ–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è | –ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –ø–∞–ø–∫—É `/videos` |
| –°—Ç–∞—Ç—É—Å –∑–∞–≤–∏—Å–∞–µ—Ç –Ω–∞ "processing" | –ñ–¥–∏—Ç–µ –¥–æ–ª—å—à–µ (MiniMax –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 1-5 –º–∏–Ω—É—Ç) |
| –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ | –£–±–µ–¥–∏—Å—å —á—Ç–æ –≤–æ—à–µ–ª –≤ –∞–∫–∫–∞—É–Ω—Ç (–ø—Ä–æ–≤–µ—Ä—å session_token –≤ cookies) |

---

## –ì–ª–∞–≤–Ω–æ–µ

1. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´, –∏–Ω–∞—á–µ –Ω–∏—á–µ–≥–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. **Callback URL** - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ (ngrok –¥–ª—è –ª–æ–∫–∞–ª–∏)
3. **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏** - MiniMax –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–∏–¥–µ–æ 1-5 –º–∏–Ω—É—Ç, –±—É–¥—å —Ç–µ—Ä–ø–µ–ª–∏–≤
4. **–ö—Ä–µ–¥–∏—Ç—ã** - —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –ü–û–°–õ–ï —É—Å–ø–µ—à–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–∑–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫)

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏: `npm run dev`
2. –ü—Ä–æ—á–∏—Ç–∞–π `MINIMAX_SETUP.md`
3. –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env.local`
4. –£–±–µ–¥–∏—Å—å —á—Ç–æ callback URL –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
5. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ MiniMax API –∫–ª—é—á –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π

---

**–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –ø—Ä–∏—Å—Ç—É–ø–∞–π –∫ —à–∞–≥–∞–º –≤—ã—à–µ. üöÄ**
