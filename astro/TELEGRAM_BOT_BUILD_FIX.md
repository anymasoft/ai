# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ —Å–±–æ—Ä–∫–∏ Telegram-–±–æ—Ç–∞ –≤ Astro

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

```
Rollup failed to resolve import "grammy"
from src/telegram/bot.ts
```

Vite –ø—ã—Ç–∞–ª—Å—è –±–∞–Ω–¥–ª–∏—Ç—å `grammy` –∫–∞–∫ –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –º–æ–¥—É–ª—å, —Ö–æ—Ç—è —ç—Ç–æ Node.js-only –±–∏–±–ª–∏–æ—Ç–µ–∫–∞.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –û–±–Ω–æ–≤–ª—ë–Ω `astro.config.mjs`

–î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è Vite SSR:

```javascript
vite: {
  plugins: [
    skipHostCheck(),
    tailwindcss()
  ],
  ssr: {
    // –ò—Å–∫–ª—é—á–∞–µ–º Node.js –º–æ–¥—É–ª–∏ –∏–∑ –±–∞–Ω–¥–ª–∞ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
    external: ['grammy', 'axios']
  }
}
```

**–ß—Ç–æ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç**:
- `grammy` –Ω–µ –±–∞–Ω–¥–ª–∏—Ç—Å—è –≤ bundle
- `grammy` –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–∞–∫ Node.js dependency –≤ runtime
- –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ

### 2. –û—á–∏—â–µ–Ω `telegram/start.ts`

–£–¥–∞–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –º–æ–¥—É–ª—è.
–¢–µ–ø–µ—Ä—å –±–æ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ middleware –µ–≥–æ –≤—ã–∑—ã–≤–∞–µ—Ç.

**–ü–æ—Ç–æ–∫ –∑–∞–ø—É—Å–∫–∞**:
1. npm run dev/preview ‚Üí Astro –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
2. –ü–µ—Ä–≤—ã–π HTTP –∑–∞–ø—Ä–æ—Å ‚Üí middleware —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
3. middleware –≤—ã–∑—ã–≤–∞–µ—Ç `initializeTelegramBot()`
4. –ë–æ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ (–±–ª–∞–≥–æ–¥–∞—Ä—è —Ñ–ª–∞–≥—É)

## üìÅ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
astro.config.mjs
  ‚îî‚îÄ vite.ssr.external: ['grammy', 'axios']

src/middleware.ts
  ‚îî‚îÄ import { initializeTelegramBot } from './telegram/start'
     ‚îî‚îÄ –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ

src/telegram/start.ts
  ‚îî‚îÄ export function initializeTelegramBot()
     ‚îî‚îÄ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç globalThis.__telegramBotStarted
     ‚îî‚îÄ —Å–æ–∑–¥–∞—ë—Ç Bot –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç polling

src/telegram/bot.ts
  ‚îî‚îÄ import { Bot, ... } from 'grammy'
     ‚îî‚îÄ –¢–æ–ª—å–∫–æ Node.js, –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä
```

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –°–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
npm run build

# –ó–∞–ø—É—Å—Ç–∏—Ç—å preview (production-like)
npm run preview

# –ò–ª–∏ dev —Ä–µ–∂–∏–º
npm run dev
```

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∏ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ –≤ Telegram.

## ‚úÖ –ß–µ–≥–æ –æ–∂–∏–¥–∞—Ç—å

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ (dev –∏–ª–∏ preview) —Ç—ã —É–≤–∏–¥–∏—à—å:

```
[TELEGRAM-INIT] Initializing Telegram bot...
[TELEGRAM-BOT] Bot instance created
[TELEGRAM-BOT] Starting bot...
[TELEGRAM-BOT] ‚úÖ Backend is available
[TELEGRAM-BOT] ‚úÖ Bot logged in as @your_bot_name
[TELEGRAM-BOT] ‚úÖ Telegram bot is running!
```

## üìù –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å —Å—Ç–∞—Ä—ã–º

- –í—Å–µ API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
- –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã
- Telegram UX –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (in-memory) –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏

## üéØ –ò—Ç–æ–≥–æ

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-----------|
| `astro.config.mjs` | ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ `vite.ssr.external` |
| `telegram/start.ts` | ‚úÖ –£–¥–∞–ª–µ–Ω–∞ –∞–≤—Ç–æ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è |
| `telegram/bot.ts` | ‚ùå –ù–µ –∏–∑–º–µ–Ω—ë–Ω |
| `middleware.ts` | ‚ùå –ù–µ –∏–∑–º–µ–Ω—ë–Ω (—É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π) |
| `package.json` | ‚ùå –ù–µ –∏–∑–º–µ–Ω—ë–Ω (–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã) |

**–°–±–æ—Ä–∫–∞ —Ç–µ–ø–µ—Ä—å –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫!** ‚ú®
