---
import Stats from '../components/Stats.astro';
import Features from '../components/Features.astro';
import HeroSection from '../components/HeroSection.astro';
import Layout from '../layouts/Layout.astro';
// import Testimonials from '../components/Testimonials.astro';
import CallToAction from '../components/CallToAction.astro';
import Pricing from '../components/Pricing.astro';
import { getUserFromSession } from '../lib/auth';

// Эта страница должна быть динамичной для работы с middleware и cookies
export const prerender = false;

// Получаем текущего пользователя из сессии
const sessionToken = Astro.cookies.get('session_token')?.value;
const user = sessionToken ? getUserFromSession(sessionToken) : null;

// Если пользователь авторизован, редиректим на /app
if (user) {
  return Astro.redirect('/app');
}
---

<Layout title="Welcome to Astrolus.">
	<main class="space-y-40 mb-40">
		<HeroSection/>
		<Features/>
		<Stats/>
		{/* <Testimonials/> */}
		<CallToAction/>
		<Pricing/>
	</main>
</Layout>