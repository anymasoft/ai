---
import Container from '../components/Container.astro';
import AppLayout from '../layouts/AppLayout.astro';
import { getUserFromSession } from '../lib/auth';

// Эта страница должна быть динамичной для работы с middleware и cookies
export const prerender = false;

// Получаем текущего пользователя из сессии
const sessionToken = Astro.cookies.get('session_token')?.value;
const user = sessionToken ? getUserFromSession(sessionToken) : null;

// Если пользователь не авторизован, редиректим на главную
if (!user) {
  return Astro.redirect('/');
}
---

<AppLayout title="Billing - Video Reader AI">
	<div class="w-full h-full flex flex-col overflow-hidden">
		<div class="flex-1 overflow-hidden flex items-center justify-center">
			<div class="p-4 w-full h-full flex flex-col">
				<div class="max-w-3xl mx-auto text-center space-y-3 flex flex-col h-full">
					<!-- Back Button -->
					<a href="/app" class="inline-flex items-center justify-center p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition cursor-pointer self-start -ml-2 mb-2">
						<svg class="w-6 h-6 text-gray-700 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
						</svg>
					</a>

					<h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white">
						Upgrade Your Account
					</h1>
					<p class="text-base text-gray-600 dark:text-gray-300">
						Buy more credits to continue generating videos
					</p>

					<div class="grid md:grid-cols-2 gap-3 flex-1 min-h-0 overflow-hidden">
						<div class="border border-gray-100 dark:border-gray-700 rounded-3xl p-4 bg-white dark:bg-gray-800 text-left hover:shadow-2xl hover:shadow-gray-600/10 transition flex flex-col">
							<h3 class="text-lg font-bold text-gray-900 dark:text-white mb-1">
								Starter Pack
							</h3>
							<p class="text-sm text-gray-600 dark:text-gray-300 mb-2">
								Perfect for trying out
							</p>
							<p class="text-3xl font-bold text-primary mb-3">
								$9
							</p>
							<ul class="space-y-1 mb-3 text-gray-600 dark:text-gray-300 flex-1 text-sm">
								<li class="flex items-center gap-2">
									<span class="text-primary text-xs">✓</span>
									<span>10 video credits</span>
								</li>
								<li class="flex items-center gap-2">
									<span class="text-primary text-xs">✓</span>
									<span>Up to 60 seconds</span>
								</li>
								<li class="flex items-center gap-2">
									<span class="text-primary text-xs">✓</span>
									<span>Standard quality</span>
								</li>
							</ul>
							<button class="w-full relative flex h-9 items-center justify-center px-6 before:absolute before:inset-0 before:rounded-full before:bg-primary before:transition before:duration-300 hover:before:scale-105 active:before:scale-95">
								<span class="relative text-sm font-semibold text-white">Coming Soon</span>
							</button>
						</div>

						<div class="border-2 border-primary rounded-3xl p-4 bg-white dark:bg-gray-800 text-left relative hover:shadow-2xl hover:shadow-gray-600/10 transition flex flex-col">
							<div class="absolute -top-3 left-1/2 -translate-x-1/2 bg-primary text-white px-3 py-0.5 rounded-full text-xs font-semibold">
								Most Popular
							</div>
							<h3 class="text-lg font-bold text-gray-900 dark:text-white mb-1 pt-2">
								Pro Pack
							</h3>
							<p class="text-sm text-gray-600 dark:text-gray-300 mb-2">
								For serious creators
							</p>
							<p class="text-3xl font-bold text-primary mb-3">
								$29
							</p>
							<ul class="space-y-1 mb-3 text-gray-600 dark:text-gray-300 flex-1 text-sm">
								<li class="flex items-center gap-2">
									<span class="text-primary text-xs">✓</span>
									<span>50 video credits</span>
								</li>
								<li class="flex items-center gap-2">
									<span class="text-primary text-xs">✓</span>
									<span>Up to 120 seconds</span>
								</li>
								<li class="flex items-center gap-2">
									<span class="text-primary text-xs">✓</span>
									<span>Premium quality</span>
								</li>
								<li class="flex items-center gap-2">
									<span class="text-primary text-xs">✓</span>
									<span>Priority processing</span>
								</li>
							</ul>
							<button class="w-full relative flex h-9 items-center justify-center px-6 before:absolute before:inset-0 before:rounded-full before:bg-primary before:transition before:duration-300 hover:before:scale-105 active:before:scale-95">
								<span class="relative text-sm font-semibold text-white">Coming Soon</span>
							</button>
						</div>
					</div>

					<p class="text-sm text-gray-600 dark:text-gray-300 text-center mt-2">
						Payment processing coming soon. Enjoy <strong>5 free credits</strong>!
					</p>
				</div>
			</div>
		</div>
	</div>
</AppLayout>
