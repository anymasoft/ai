---
// PromptInput.astro
// Основано на Shadcn/ui Textarea компоненте
// https://ui.shadcn.com/docs/components/textarea
---

<div class="relative w-full">
  <textarea
    id="prompt"
    placeholder="Красивая девушка в чёрном платье медленно идёт вперёд, камера плавно приближается, волосы развеваются на ветру"
    class="w-full px-4 py-3
           border border-white/30 dark:border-white/20
           rounded-lg
           bg-white/30 dark:bg-white/10 backdrop-blur-md
           text-slate-900 dark:text-slate-50
           placeholder:text-slate-500 dark:placeholder:text-slate-400
           focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2
           dark:focus:ring-offset-slate-950
           disabled:cursor-not-allowed disabled:opacity-50
           resize-none text-sm
           transition-colors duration-200
           shadow-sm"
    rows="3"
  ></textarea>

  <!-- Generate Button Inside -->
  <button
    id="generate-btn"
    class="absolute right-3 top-3
           p-2 rounded-md
           bg-white/20 hover:bg-white/30 dark:bg-white/15 dark:hover:bg-white/25 backdrop-blur-md
           border border-white/30 dark:border-white/20
           text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300
           transition-all duration-200
           hover:shadow-md
           disabled:opacity-50 disabled:cursor-not-allowed
           active:scale-95"
    disabled
  >
    <svg id="generate-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
    </svg>
    <svg id="generate-spinner" class="hidden w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" opacity="0.3"></circle>
      <path stroke="currentColor" stroke-width="2" fill="none" d="M12 2a10 10 0 0110 10" stroke-linecap="round"></path>
    </svg>
  </button>
</div>

<style>
  @keyframes neon-glow {
    0%, 100% {
      box-shadow:
        0 0 10px 0 rgba(59, 130, 246, 0.6),
        0 0 20px 0 rgba(59, 130, 246, 0.4),
        0 0 30px 0 rgba(59, 130, 246, 0.2),
        inset 0 0 10px 0 rgba(59, 130, 246, 0.15);
    }
    50% {
      box-shadow:
        0 0 20px 0 rgba(59, 130, 246, 1),
        0 0 40px 0 rgba(59, 130, 246, 0.8),
        0 0 60px 0 rgba(59, 130, 246, 0.4),
        inset 0 0 15px 0 rgba(59, 130, 246, 0.3);
    }
  }

  /* NO-VIDEO MODE: White/Opaque UI */
  .no-video #prompt {
    background-color: #ffffff !important;
    border: 1px solid #e5e7eb !important;
    color: #1f2937 !important;
    backdrop-filter: none !important;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1) !important;
  }

  .dark .no-video #prompt {
    background-color: #1f2937 !important;
    border: 1px solid #374151 !important;
    color: #f3f4f6 !important;
  }

  .no-video #prompt::placeholder {
    color: #9ca3af !important;
  }

  .dark .no-video #prompt::placeholder {
    color: #6b7280 !important;
  }

  /* HAS-VIDEO MODE: Glass Blur UI */
  .has-video #prompt {
    border: 1px solid rgba(255, 255, 255, 0.3);
    background-color: rgba(255, 255, 255, 0.3);
    background-image: none;
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
    color: #475569;
  }

  .dark .has-video #prompt {
    border-color: rgba(255, 255, 255, 0.2);
    background-color: rgba(255, 255, 255, 0.05);
    color: #cbd5e1;
  }

  /* Base textarea styles */
  #prompt {
    border-color: rgba(59, 130, 246, 0.3);
    transition: border-color 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease, backdrop-filter 0.3s ease;
  }

  #prompt:hover {
    animation: neon-glow 2s ease-in-out infinite !important;
    border-color: rgb(59, 130, 246) !important;
  }

  #prompt:focus {
    animation: neon-glow 2s ease-in-out infinite !important;
    border-color: rgb(59, 130, 246) !important;
  }

  textarea {
    font-family: inherit;
    min-height: 100px;
    max-height: 200px;
  }

  textarea::-webkit-scrollbar {
    width: 6px;
  }

  textarea::-webkit-scrollbar-track {
    background: transparent;
  }

  textarea::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 3px;
  }

  textarea::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }

  :dark textarea::-webkit-scrollbar-thumb {
    background: #475569;
  }

  :dark textarea::-webkit-scrollbar-thumb:hover {
    background: #64748b;
  }

  /* NO-VIDEO MODE: Button white/opaque */
  .no-video #generate-btn {
    background-color: #ffffff !important;
    border: 1px solid #d1d5db !important;
    color: #2563eb !important;
    backdrop-filter: none !important;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1) !important;
  }

  .dark .no-video #generate-btn {
    background-color: #374151 !important;
    border: 1px solid #4b5563 !important;
  }

  .no-video #generate-btn:hover:not(:disabled) {
    background-color: #f3f4f6 !important;
  }

  .dark .no-video #generate-btn:hover:not(:disabled) {
    background-color: #4b5563 !important;
  }

  /* HAS-VIDEO MODE: Button glass blur */
  .has-video #generate-btn {
    background-color: rgba(255, 255, 255, 0.2) !important;
    border: 1px solid rgba(255, 255, 255, 0.3) !important;
    backdrop-filter: blur(10px) !important;
  }

  .dark .has-video #generate-btn {
    background-color: rgba(255, 255, 255, 0.15) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
  }

  .has-video #generate-btn:hover:not(:disabled) {
    background-color: rgba(255, 255, 255, 0.3) !important;
  }

  .dark .has-video #generate-btn:hover:not(:disabled) {
    background-color: rgba(255, 255, 255, 0.25) !important;
  }
</style>

<script>
  // Auto-resize textarea
  const textarea = document.getElementById('prompt');

  if (textarea) {
    textarea.addEventListener('input', (e) => {
      const target = e.target as HTMLTextAreaElement;
      target.style.height = 'auto';
      target.style.height = Math.min(target.scrollHeight, 200) + 'px';
    });
  }
</script>
