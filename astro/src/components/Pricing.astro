---
import Container from "./Container.astro"
import { PRICING_PLANS, formatPrice, getPlansSummary } from '../lib/pricing';

// Получаем только небезопасные для лендинга тарифы (исключаем custom)
const purchasablePlans = getPlansSummary();

// Маппинг точных текстов для каждого плана
const planTexts: Record<string, { title: string; description: string; benefits: string[] }> = {
  free: {
    title: 'Free',
    description: '3 кредита при регистрации',
    benefits: [
      'Можно сразу проверить на своём товаре',
      'Ваш товар заметят сразу',
      'Можно попробовать без подписки',
      'Видео сразу готово для WB и Ozon',
      'Загружается в карточку без монтажа',
      'Можно купить любое количество кредитов'
    ]
  },
  basic: {
    title: 'Basic',
    description: 'Лучший вариант для регулярных продаж',
    benefits: [
      '50 видео для ваших карточек',
      'Вертикальные ролики под WB и Ozon',
      'Видео создаётся за ~1 минуту',
      'Помогает увеличить кликабельность карточек',
      'Даёт больше просмотров и заказов',
      'Самый популярный пакет'
    ]
  },
  professional: {
    title: 'Professional',
    description: 'Для масштабирования продаж',
    benefits: [
      '200 видео для каталога товаров',
      'Подходит для агентств и брендов',
      'Создавайте видео для сотен SKU',
      'Минимальная цена за один ролик',
      'Максимальная отдача от каждого кредита',
      'Лучший выбор для больших объёмов'
    ]
  }
};
---

<div id="pricing" class="bg-white dark:bg-gray-900">
  <Container>
    <!-- Заголовок секции -->
    <div class="mb-16 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4">Сколько стоит увеличить продажи</h2>
      <p class="text-lg text-gray-600 dark:text-gray-300">Стоимость от <span class="font-semibold text-primary">69 ₽ за видео</span>. Вы покупаете кредиты и используете их, когда нужно - никаких помесячных списаний.</p>
      <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">6 секунд = 1 кредит · 10 секунд = 2 кредита</p>
    </div>

    <!-- Pricing Cards -->
    <div class="grid gap-8 mb-16 lg:grid-cols-3 p-4 md:p-8">
      {purchasablePlans.map((plan) => {
        const texts = planTexts[plan.id] || planTexts.basic;
        return (
          <div class={`relative ${plan.popular ? '' : ''}`}>
            {plan.popular && (
              <div class="absolute left-0 right-0 flex justify-center -top-4">
                <span class="flex items-center gap-1 px-4 py-1 text-sm font-medium text-white rounded-full bg-gradient-to-r from-indigo-600 to-violet-600">
                  <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z"></path>
                  </svg>
                  Самый популярный
                </span>
              </div>
            )}

            <div class={`flex flex-col justify-between h-full bg-white dark:bg-gray-800 rounded-lg ${plan.popular ? 'border-2 border-indigo-400 shadow-lg' : 'border border-gray-200 dark:border-gray-700 shadow-sm'}`}>
              <div class="p-6">
                {/* Название пакета */}
                <h3 class="text-2xl font-semibold text-gray-900 dark:text-white">{texts.title}</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">{texts.description}</p>

                {/* Цена */}
                <div class="mt-6">
                  <span class="text-4xl font-bold text-gray-900 dark:text-white">{formatPrice(plan.price)} ₽</span>
                </div>

                {/* Кредиты */}
                <div class="mt-2">
                  <p class="text-lg text-gray-600 dark:text-gray-400">{plan.credits} кредитов</p>
                  {plan.id !== 'free' && (
                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">1 кредит = {plan.pricePerCredit} ₽</p>
                  )}
                </div>

                {/* Преимущества */}
                <ul class="mt-6 space-y-2">
                  {texts.benefits.map((benefit) => (
                    <li class="flex items-start gap-2 text-sm text-gray-600 dark:text-gray-300">
                      <svg class="h-5 w-5 text-green-500 flex-shrink-0 mt-0.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"></path>
                      </svg>
                      <span>{benefit}</span>
                    </li>
                  ))}
                </ul>
              </div>

              {/* Кнопка */}
              <div class={`p-6 border-t rounded-b-lg ${plan.popular ? 'border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900' : 'border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900'}`}>
                <a href="/sign-in"
                  class={`block w-full px-4 py-2 font-medium text-center rounded-lg transition-colors ${
                    plan.popular
                      ? 'text-white bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-700 hover:to-violet-700'
                      : 'text-white bg-gray-900 dark:bg-gray-700 hover:bg-gray-800 dark:hover:bg-gray-600'
                  }`}>
                  {plan.id === 'free' ? 'Попробовать' : 'Купить кредиты'}
                  <svg class="h-4 w-4 inline-block ml-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path>
                  </svg>
                </a>
              </div>
            </div>
          </div>
        );
      })}
    </div>
  </Container>
</div>
