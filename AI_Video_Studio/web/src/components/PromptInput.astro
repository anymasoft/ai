---
// PromptInput.astro — Clean textarea without generate button
// Generate button lives in the sidebar (app.astro)
---

<div class="space-y-1.5">
  <label class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Описание сцены</label>
  <div class="relative">
    <textarea
      id="prompt"
      placeholder="Опишите сцену..."
      class="w-full px-3 py-2.5
             border border-gray-300 dark:border-gray-700
             rounded-lg
             bg-white dark:bg-gray-900
             text-sm text-gray-900 dark:text-gray-100
             placeholder:text-gray-400 dark:placeholder:text-gray-500
             focus:outline-none focus:ring-2 focus:ring-indigo-500/30 focus:border-indigo-400 dark:focus:border-indigo-500
             disabled:cursor-not-allowed disabled:opacity-50
             resize-none
             transition-colors duration-150"
      rows="3"
    ></textarea>
    <span
      id="char-count"
      class="absolute bottom-2 right-2.5 text-[10px] text-gray-400 dark:text-gray-600 pointer-events-none select-none"
    >0/500</span>
  </div>
</div>

<style>
  textarea {
    font-family: inherit;
    min-height: 80px;
    max-height: 180px;
  }

  textarea::-webkit-scrollbar {
    width: 4px;
  }

  textarea::-webkit-scrollbar-track {
    background: transparent;
  }

  textarea::-webkit-scrollbar-thumb {
    background: #d1d5db;
    border-radius: 2px;
  }

  .dark textarea::-webkit-scrollbar-thumb {
    background: #4b5563;
  }
</style>

<script>
  const textarea = document.getElementById('prompt') as HTMLTextAreaElement;
  const charCount = document.getElementById('char-count');

  if (textarea) {
    function updateCharCount() {
      const count = textarea.value.length;
      if (charCount) {
        charCount.textContent = `${count}/500`;
        if (count > 450) {
          charCount.style.color = count >= 500 ? '#ef4444' : '#f59e0b';
        } else {
          charCount.style.color = '';
        }
      }
    }

    textarea.addEventListener('input', () => {
      textarea.style.height = 'auto';
      textarea.style.height = Math.min(textarea.scrollHeight, 180) + 'px';

      if (textarea.value.length > 500) {
        textarea.value = textarea.value.substring(0, 500);
      }

      updateCharCount();
    });

    updateCharCount();
  }
</script>
