# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—É–±—Ç–∏—Ç—Ä–æ–≤ YouTube

## –û–±–∑–æ—Ä

–≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—É–±—Ç–∏—Ç—Ä–æ–≤ —Å YouTube, –∏—Å–ø–æ–ª—å–∑—É—è –º–µ—Ç–æ–¥—ã –∏–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è YouTubeSummary.

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–æ–¥–∏–Ω –º–µ—Ç–æ–¥)

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **—Ç–æ–ª—å–∫–æ –º–µ—Ç–æ–¥ YouTube Internal API** - –æ–Ω —Å–∞–º—ã–π –Ω–∞–¥—ë–∂–Ω—ã–π –∏ –±—ã—Å—Ç—Ä—ã–π.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†–æ–±–∞—Å—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (multiple fallbacks)

–î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ –≤—Å–µ 4 –º–µ—Ç–æ–¥–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ì–∏–±—Ä–∏–¥–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–†–µ–∞–ª–∏–∑—É–π—Ç–µ **2 –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–∞**:
1. YouTube Internal API (–æ—Å–Ω–æ–≤–Ω–æ–π)
2. DOM –ü–∞—Ä—Å–∏–Ω–≥ (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π)

–≠—Ç–æ –¥–∞—Å—Ç ~95% –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ –±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.

---

## üìù –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ YouTube –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `utils/youtube-parser.js`:

```javascript
/**
 * –ò–∑–≤–ª–µ–∫–∞–µ—Ç captionTracks –∏–∑ HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã YouTube
 * @param {string} html - HTML –∫–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
 * @returns {Array} - –ú–∞—Å—Å–∏–≤ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—É–±—Ç–∏—Ç—Ä–æ–≤
 */
export function extractCaptionTracks(html) {
  try {
    // –ú–µ—Ç–æ–¥ 1: Split –ø–∞—Ä—Å–∏–Ω–≥ (–±—ã—Å—Ç—Ä–µ–µ regex)
    const parts = html.split('"captions":');
    if (parts.length < 2) {
      return [];
    }

    const captionsJson = parts[1].split(',"videoDetails')[0].replace(/\n/g, "");
    const captions = JSON.parse(captionsJson);

    const tracks = captions?.playerCaptionsTracklistRenderer?.captionTracks || [];

    return tracks.map(track => {
      // –£–¥–∞–ª—è–µ–º —Ç–æ—á–∫—É –≤ –Ω–∞—á–∞–ª–µ vssId, –µ—Å–ª–∏ –µ—Å—Ç—å
      let langCode = track.vssId || "";
      if (langCode.startsWith(".")) {
        langCode = langCode.slice(1);
      }

      return {
        link: track.baseUrl || "",
        language: track.name?.simpleText || "",
        langCode: langCode,
        languageCode: track.languageCode || "",
        kind: track.kind || "",  // "asr" –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
        isTranslatable: track.isTranslatable || false
      };
    });
  } catch (error) {
    console.error("Failed to extract caption tracks:", error);
    return [];
  }
}

/**
 * –ò–∑–≤–ª–µ–∫–∞–µ—Ç params –¥–ª—è YouTube Internal API
 * @param {string} html - HTML –∫–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
 * @returns {string} - –ó–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π params
 */
export function extractTranscriptParams(html) {
  try {
    const parts = html.split('"getTranscriptEndpoint":');
    if (parts.length < 2) {
      return "";
    }

    const paramsMatch = parts[1].split('"params":"')[1];
    if (!paramsMatch) {
      return "";
    }

    return paramsMatch.split('"')[0];
  } catch (error) {
    console.error("Failed to extract transcript params:", error);
    return "";
  }
}

/**
 * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é –≤–µ—Ä—Å–∏—é –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 30 –¥–Ω–µ–π
 * @returns {string} - –í–µ—Ä—Å–∏—è –≤–∏–¥–∞ "2.20241115.00.00"
 */
export function generateRandomClientVersion() {
  const dates = Array.from({ length: 30 }, (_, i) => {
    const date = new Date();
    date.setDate(date.getDate() - i);
    return date.toISOString().split("T")[0].replace(/-/g, "");
  });

  const randomDate = dates[Math.floor(Math.random() * dates.length)];
  return `2.${randomDate}.00.00`;
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã YouTube –≤–∏–¥–µ–æ
 * @param {string} videoId - ID –≤–∏–¥–µ–æ
 * @returns {Promise<string>} - HTML –∫–æ–¥
 */
export async function fetchYouTubePageHtml(videoId) {
  const url = `https://www.youtube.com/watch?v=${videoId}`;
  const response = await fetch(url);

  if (!response.ok) {
    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
  }

  const html = await response.text();
  if (!html || html.trim().length === 0) {
    throw new Error("Empty response from YouTube");
  }

  return html;
}
```

---

### –®–∞–≥ 2: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞ YouTube Internal API

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `services/youtube-transcript-api.js`:

```javascript
import {
  fetchYouTubePageHtml,
  extractTranscriptParams,
  generateRandomClientVersion,
  extractCaptionTracks
} from '../utils/youtube-parser.js';

/**
 * –ü–æ–ª—É—á–∞–µ—Ç —Å—É–±—Ç–∏—Ç—Ä—ã —á–µ—Ä–µ–∑ YouTube Internal API
 * @param {string} videoId - ID –≤–∏–¥–µ–æ
 * @param {string} params - –ó–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π params (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
 * @returns {Promise<Array>} - –ú–∞—Å—Å–∏–≤ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ —Å—É–±—Ç–∏—Ç—Ä–æ–≤
 */
export async function getTranscriptViaInternalAPI(videoId, params = null) {
  try {
    // 1. –ï—Å–ª–∏ params –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω, –ø–æ–ª—É—á–∞–µ–º –µ–≥–æ –∏–∑ HTML
    if (!params) {
      const html = await fetchYouTubePageHtml(videoId);
      params = extractTranscriptParams(html);

      if (!params) {
        throw new Error("Failed to extract transcript params from HTML");
      }
    }

    // 2. –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å
    const url = "https://www.youtube.com/youtubei/v1/get_transcript?prettyPrint=false";
    const body = {
      context: {
        client: {
          clientName: "WEB",
          clientVersion: generateRandomClientVersion()
        }
      },
      params: params
    };

    // 3. –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å
    const response = await fetch(url, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(body)
    });

    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }

    const text = await response.text();
    if (!text || text.trim().length === 0) {
      throw new Error("Empty transcript response");
    }

    // 4. –ü–∞—Ä—Å–∏–º –æ—Ç–≤–µ—Ç
    const data = JSON.parse(text);

    // 5. –ò–∑–≤–ª–µ–∫–∞–µ–º —Å–µ–≥–º–µ–Ω—Ç—ã
    const segments = extractSegmentsFromInternalAPI(data);

    return segments;
  } catch (error) {
    console.error("Failed to get transcript via Internal API:", error);
    throw error;
  }
}

/**
 * –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å–µ–≥–º–µ–Ω—Ç—ã –∏–∑ –æ—Ç–≤–µ—Ç–∞ Internal API
 * @param {Object} data - JSON –æ—Ç–≤–µ—Ç –æ—Ç API
 * @returns {Array} - –ú–∞—Å—Å–∏–≤ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
 */
function extractSegmentsFromInternalAPI(data) {
  try {
    const actions = data?.actions || [];
    if (actions.length === 0) {
      throw new Error("No actions in response");
    }

    const panelRenderer = actions[0]
      ?.updateEngagementPanelAction
      ?.content
      ?.transcriptRenderer
      ?.content
      ?.transcriptSearchPanelRenderer;

    if (!panelRenderer) {
      throw new Error("Invalid response structure");
    }

    // –ò–∑–≤–ª–µ–∫–∞–µ–º —Å–µ–≥–º–µ–Ω—Ç—ã
    const initialSegments = panelRenderer?.body
      ?.transcriptSegmentListRenderer
      ?.initialSegments || [];

    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
    const segments = initialSegments
      .map((segment, index) => {
        const renderer = segment?.transcriptSegmentRenderer;
        if (!renderer) return null;

        const startMs = renderer.startMs;
        const endMs = renderer.endMs;
        const text = renderer.snippet?.runs?.[0]?.text || "";

        if (!startMs || !endMs || !text) return null;

        return {
          index: index,
          start: Number(startMs) / 1000,  // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ —Å–µ–∫—É–Ω–¥—ã
          end: Number(endMs) / 1000,
          duration: (Number(endMs) - Number(startMs)) / 1000,
          text: cleanText(text)
        };
      })
      .filter(Boolean);  // –£–¥–∞–ª—è–µ–º null –∑–Ω–∞—á–µ–Ω–∏—è

    return segments;
  } catch (error) {
    console.error("Failed to extract segments:", error);
    throw error;
  }
}

/**
 * –û—á–∏—â–∞–µ—Ç —Ç–µ–∫—Å—Ç —Å—É–±—Ç–∏—Ç—Ä–∞
 * @param {string} text - –°—ã—Ä–æ–π —Ç–µ–∫—Å—Ç
 * @returns {string} - –û—á–∏—â–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
 */
function cleanText(text) {
  // 1. –£–¥–∞–ª—è–µ–º HTML —Ç–µ–≥–∏
  text = text.replace(/<[^>]*>/g, "");

  // 2. –î–µ–∫–æ–¥–∏—Ä—É–µ–º HTML entities
  text = decodeHtmlEntities(text);

  // 3. –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
  text = text.replace(/\s+/g, " ").trim();

  return text;
}

/**
 * –î–µ–∫–æ–¥–∏—Ä—É–µ—Ç HTML entities
 * @param {string} text - –¢–µ–∫—Å—Ç —Å entities
 * @returns {string} - –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
 */
function decodeHtmlEntities(text) {
  const entities = {
    "&amp;": "&",
    "&lt;": "<",
    "&gt;": ">",
    "&quot;": '"',
    "&#39;": "'",
    "&#x27;": "'",
    "&apos;": "'",
    "&nbsp;": " ",
    "&laquo;": "¬´",
    "&raquo;": "¬ª"
  };

  return text.replace(/&#\d+;|&\w+;/g, entity => {
    return entities[entity] || entity;
  });
}
```

---

### –®–∞–≥ 3: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ (DOM –ø–∞—Ä—Å–∏–Ω–≥)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `services/youtube-dom-parser.js`:

```javascript
/**
 * –ñ–¥—ë—Ç –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ DOM
 * @param {string} selector - CSS —Å–µ–ª–µ–∫—Ç–æ—Ä
 * @param {number} timeout - –¢–∞–π–º–∞—É—Ç –≤ –º—Å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3000)
 * @returns {Promise<Element|null>} - –ù–∞–π–¥–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –∏–ª–∏ null
 */
function waitForElement(selector, timeout = 3000) {
  return new Promise((resolve) => {
    const element = document.querySelector(selector);
    if (element) {
      resolve(element);
      return;
    }

    const interval = setInterval(() => {
      const element = document.querySelector(selector);
      if (element) {
        clearInterval(interval);
        resolve(element);
      }
    }, 100);

    setTimeout(() => {
      clearInterval(interval);
      resolve(null);
    }, timeout);
  });
}

/**
 * –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–∞–π–º—Å—Ç–∞–º–ø –≤ —Å–µ–∫—É–Ω–¥—ã
 * @param {string} timestamp - –í—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ "MM:SS" –∏–ª–∏ "HH:MM:SS"
 * @returns {number} - –°–µ–∫—É–Ω–¥—ã
 */
function convertTimestampToSeconds(timestamp) {
  const parts = timestamp.split(":").map(Number);
  let seconds = 0;

  if (parts.length === 3) {
    // HH:MM:SS
    seconds += parts[0] * 3600;
    seconds += parts[1] * 60;
    seconds += parts[2];
  } else if (parts.length === 2) {
    // MM:SS
    seconds += parts[0] * 60;
    seconds += parts[1];
  } else if (parts.length === 1) {
    // SS
    seconds += parts[0];
  }

  return seconds;
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç —Å—É–±—Ç–∏—Ç—Ä—ã —á–µ—Ä–µ–∑ DOM –ø–∞—Ä—Å–∏–Ω–≥
 * @param {string} videoId - ID –≤–∏–¥–µ–æ (–¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è)
 * @returns {Promise<Array>} - –ú–∞—Å—Å–∏–≤ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ —Å—É–±—Ç–∏—Ç—Ä–æ–≤
 */
export async function getTranscriptViaDomParsing(videoId) {
  try {
    // –°–µ–ª–µ–∫—Ç–æ—Ä—ã (–º–æ–≥—É—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ YouTube)
    const BUTTON_SELECTOR = "#primary-button > ytd-button-renderer > yt-button-shape > button";
    const SEGMENT_SELECTOR = "#segments-container > ytd-transcript-segment-renderer";

    // 1. –ù–∞—Ö–æ–¥–∏–º –∏ –∫–ª–∏–∫–∞–µ–º –Ω–∞ –∫–Ω–æ–ø–∫—É "Show transcript"
    const button = document.querySelector(BUTTON_SELECTOR);
    if (!button) {
      throw new Error("Transcript button not found");
    }

    button.click();

    // 2. –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
    await waitForElement(SEGMENT_SELECTOR);

    // 3. –ü–∞—Ä—Å–∏–º —Å–µ–≥–º–µ–Ω—Ç—ã
    const segmentElements = document.querySelectorAll(SEGMENT_SELECTOR);
    if (!segmentElements || segmentElements.length === 0) {
      throw new Error("No transcript segments found");
    }

    const segments = [];
    segmentElements.forEach((element, index) => {
      // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–∞–π–º—Å—Ç–∞–º–ø
      const timestampEl = element.querySelector("div.segment-timestamp");
      const timestamp = timestampEl?.textContent?.trim() || "";

      // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç
      const textEl = element.querySelector("yt-formatted-string");
      const text = textEl?.textContent?.trim() || "";

      if (timestamp && text) {
        segments.push({
          index: index,
          start: convertTimestampToSeconds(timestamp),
          text: cleanText(text)
        });
      }
    });

    return segments;
  } catch (error) {
    console.error("Failed to get transcript via DOM parsing:", error);
    throw error;
  }
}

/**
 * –û—á–∏—â–∞–µ—Ç —Ç–µ–∫—Å—Ç —Å—É–±—Ç–∏—Ç—Ä–∞
 * @param {string} text - –°—ã—Ä–æ–π —Ç–µ–∫—Å—Ç
 * @returns {string} - –û—á–∏—â–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
 */
function cleanText(text) {
  // –î–µ–∫–æ–¥–∏—Ä—É–µ–º HTML entities (–±—Ä–∞—É–∑–µ—Ä –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ textContent)
  // –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
  return text.replace(/\s+/g, " ").trim();
}
```

---

### –®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ —Å fallback –ª–æ–≥–∏–∫–æ–π

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `services/youtube-transcript-service.js`:

```javascript
import { getTranscriptViaInternalAPI } from './youtube-transcript-api.js';
import { getTranscriptViaDomParsing } from './youtube-dom-parser.js';
import {
  fetchYouTubePageHtml,
  extractCaptionTracks,
  extractTranscriptParams
} from '../utils/youtube-parser.js';

/**
 * –ü–æ–ª—É—á–∞–µ—Ç —Å—É–±—Ç–∏—Ç—Ä—ã –¥–ª—è YouTube –≤–∏–¥–µ–æ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback
 * @param {string} videoId - ID –≤–∏–¥–µ–æ
 * @param {Object} options - –û–ø—Ü–∏–∏
 * @param {string} options.preferredLanguage - –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π —è–∑—ã–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
 * @param {boolean} options.useCache - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true)
 * @returns {Promise<Object>} - –û–±—ä–µ–∫—Ç —Å —Å—É–±—Ç–∏—Ç—Ä–∞–º–∏ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
 */
export async function getYouTubeTranscript(videoId, options = {}) {
  const {
    preferredLanguage = "en",
    useCache = true
  } = options;

  try {
    // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
    if (useCache) {
      const cached = getCachedTranscript(videoId);
      if (cached) {
        console.log("Using cached transcript");
        return cached;
      }
    }

    // 2. –ü–æ–ª—É—á–∞–µ–º HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–Ω—É–∂–µ–Ω –¥–ª—è –æ–±–æ–∏—Ö –º–µ—Ç–æ–¥–æ–≤)
    console.log("Fetching YouTube page HTML...");
    const html = await fetchYouTubePageHtml(videoId);

    // 3. –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—É–±—Ç–∏—Ç—Ä–∞—Ö
    const availableLanguages = extractCaptionTracks(html);
    console.log("Available languages:", availableLanguages);

    // 4. –ò–∑–≤–ª–µ–∫–∞–µ–º params –¥–ª—è Internal API
    const params = extractTranscriptParams(html);

    // 5. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–æ–π —è–∑—ã–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
    const selectedLanguage = selectLanguage(availableLanguages, preferredLanguage);
    if (!selectedLanguage) {
      throw new Error("No suitable language found");
    }

    console.log("Selected language:", selectedLanguage.language);

    // 6. –ü–û–ü–´–¢–ö–ê 1: YouTube Internal API
    console.log("Attempting method 1: YouTube Internal API...");
    try {
      const segments = await getTranscriptViaInternalAPI(videoId, params);
      if (segments && segments.length > 0) {
        const result = {
          videoId,
          method: "internal_api",
          language: selectedLanguage.language,
          langCode: selectedLanguage.langCode,
          availableLanguages,
          segments,
          totalSegments: segments.length,
          fetchedAt: new Date().toISOString()
        };

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
        cacheTranscript(videoId, result);

        return result;
      }
    } catch (error) {
      console.error("Method 1 failed:", error.message);
    }

    // 7. –ü–û–ü–´–¢–ö–ê 2: DOM –ü–∞—Ä—Å–∏–Ω–≥
    console.log("Attempting method 2: DOM Parsing...");
    try {
      const segments = await getTranscriptViaDomParsing(videoId);
      if (segments && segments.length > 0) {
        const result = {
          videoId,
          method: "dom_parsing",
          language: "unknown",  // DOM –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ –¥–∞—ë—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —è–∑—ã–∫–µ
          langCode: "unknown",
          availableLanguages,
          segments,
          totalSegments: segments.length,
          fetchedAt: new Date().toISOString()
        };

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
        cacheTranscript(videoId, result);

        return result;
      }
    } catch (error) {
      console.error("Method 2 failed:", error.message);
    }

    // 8. –í—Å–µ –º–µ—Ç–æ–¥—ã –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å
    throw new Error("All methods failed to fetch transcript");

  } catch (error) {
    console.error("Failed to get YouTube transcript:", error);
    throw error;
  }
}

/**
 * –í—ã–±–∏—Ä–∞–µ—Ç —è–∑—ã–∫ —Å—É–±—Ç–∏—Ç—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π
 * @param {Array} availableLanguages - –î–æ—Å—Ç—É–ø–Ω—ã–µ —è–∑—ã–∫–∏
 * @param {string} preferredLanguage - –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π –∫–æ–¥ —è–∑—ã–∫–∞
 * @returns {Object|null} - –í—ã–±—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫ –∏–ª–∏ null
 */
function selectLanguage(availableLanguages, preferredLanguage) {
  if (!availableLanguages || availableLanguages.length === 0) {
    return null;
  }

  // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ langCode
  let selected = availableLanguages.find(
    lang => lang.langCode === preferredLanguage
  );
  if (selected) return selected;

  // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ languageCode
  selected = availableLanguages.find(
    lang => lang.languageCode === preferredLanguage
  );
  if (selected) return selected;

  // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ —è–∑—ã–∫–∞
  selected = availableLanguages.find(
    lang => lang.language.toLowerCase().includes(preferredLanguage.toLowerCase())
  );
  if (selected) return selected;

  // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: –ê–Ω–≥–ª–∏–π—Å–∫–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  selected = availableLanguages.find(
    lang => lang.langCode === "en" || lang.language === "English"
  );
  if (selected) return selected;

  // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 5: –ü–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π
  return availableLanguages[0];
}

/**
 * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—É–±—Ç–∏—Ç—Ä—ã –≤ –∫—ç—à
 * @param {string} videoId - ID –≤–∏–¥–µ–æ
 * @param {Object} data - –î–∞–Ω–Ω—ã–µ –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
 */
function cacheTranscript(videoId, data) {
  try {
    const cacheKey = `youtube_transcript_${videoId}`;
    localStorage.setItem(cacheKey, JSON.stringify(data));
  } catch (error) {
    console.error("Failed to cache transcript:", error);
  }
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç —Å—É–±—Ç–∏—Ç—Ä—ã –∏–∑ –∫—ç—à–∞
 * @param {string} videoId - ID –≤–∏–¥–µ–æ
 * @returns {Object|null} - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ null
 */
function getCachedTranscript(videoId) {
  try {
    const cacheKey = `youtube_transcript_${videoId}`;
    const cached = localStorage.getItem(cacheKey);
    return cached ? JSON.parse(cached) : null;
  } catch (error) {
    console.error("Failed to get cached transcript:", error);
    return null;
  }
}

/**
 * –û—á–∏—â–∞–µ—Ç –∫—ç—à —Å—É–±—Ç–∏—Ç—Ä–æ–≤
 * @param {string} videoId - ID –≤–∏–¥–µ–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω - –æ—á–∏—â–∞–µ—Ç –≤–µ—Å—å –∫—ç—à)
 */
export function clearTranscriptCache(videoId = null) {
  try {
    if (videoId) {
      const cacheKey = `youtube_transcript_${videoId}`;
      localStorage.removeItem(cacheKey);
    } else {
      // –û—á–∏—â–∞–µ–º –≤–µ—Å—å –∫—ç—à —Å—É–±—Ç–∏—Ç—Ä–æ–≤
      Object.keys(localStorage)
        .filter(key => key.startsWith("youtube_transcript_"))
        .forEach(key => localStorage.removeItem(key));
    }
  } catch (error) {
    console.error("Failed to clear transcript cache:", error);
  }
}
```

---

### –®–∞–≥ 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Content Script

–û–±–Ω–æ–≤–∏—Ç–µ –≤–∞—à `content-script.js`:

```javascript
import { getYouTubeTranscript } from './services/youtube-transcript-service.js';

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è video ID –∏–∑ URL
function getVideoIdFromUrl(url) {
  const urlParams = new URLSearchParams(new URL(url).search);
  return urlParams.get('v');
}

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
async function main() {
  try {
    // 1. –ü–æ–ª—É—á–∞–µ–º ID –≤–∏–¥–µ–æ
    const videoId = getVideoIdFromUrl(window.location.href);
    if (!videoId) {
      console.log("Not a YouTube video page");
      return;
    }

    console.log("Video ID:", videoId);

    // 2. –ü–æ–ª—É—á–∞–µ–º —Å—É–±—Ç–∏—Ç—Ä—ã
    const transcript = await getYouTubeTranscript(videoId, {
      preferredLanguage: "en",  // –∏–ª–∏ "ru" –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ
      useCache: true
    });

    console.log("Transcript fetched successfully:", transcript);

    // 3. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É–±—Ç–∏—Ç—Ä—ã –≤ –≤–∞—à–µ–π –ª–æ–≥–∏–∫–µ
    processTranscript(transcript);

  } catch (error) {
    console.error("Error in main:", error);
  }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Å—É–±—Ç–∏—Ç—Ä–æ–≤
function processTranscript(transcript) {
  console.log(`Got ${transcript.totalSegments} segments`);
  console.log(`Method used: ${transcript.method}`);
  console.log(`Language: ${transcript.language}`);

  // –ü—Ä–∏–º–µ—Ä: –í—ã–≤–µ—Å—Ç–∏ –ø–µ—Ä–≤—ã–µ 5 —Å–µ–≥–º–µ–Ω—Ç–æ–≤
  transcript.segments.slice(0, 5).forEach(segment => {
    console.log(`[${segment.start}s] ${segment.text}`);
  });

  // –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –∑–¥–µ—Å—å...
}

// –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', main);
} else {
  main();
}

// –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è URL (–¥–ª—è SPA –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ YouTube)
let lastUrl = location.href;
new MutationObserver(() => {
  const url = location.href;
  if (url !== lastUrl) {
    lastUrl = url;
    main();
  }
}).observe(document, { subtree: true, childList: true });
```

---

### –®–∞–≥ 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ manifest.json

–î–æ–±–∞–≤—å—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ permissions:

```json
{
  "manifest_version": 3,
  "name": "Your Extension",
  "version": "1.0.0",
  "permissions": [
    "storage"
  ],
  "host_permissions": [
    "https://www.youtube.com/*",
    "https://www.youtube.com/youtubei/*",
    "https://www.youtube.com/api/*"
  ],
  "content_scripts": [
    {
      "matches": ["https://www.youtube.com/*"],
      "js": ["content-script.js"],
      "run_at": "document_idle"
    }
  ]
}
```

---

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏

```javascript
/**
 * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–µ–∫—É–Ω–¥—ã –≤ —á–∏—Ç–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç
 * @param {number} seconds - –°–µ–∫—É–Ω–¥—ã
 * @returns {string} - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è "MM:SS" –∏–ª–∏ "HH:MM:SS"
 */
export function formatTime(seconds) {
  const hasHours = seconds >= 3600;
  const hours = Math.floor(seconds / 3600);
  const minutes = Math.floor((seconds % 3600) / 60);
  const secs = Math.floor(seconds % 60);

  if (hasHours) {
    return `${hours}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
  } else {
    return `${minutes}:${String(secs).padStart(2, '0')}`;
  }
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ —Å—É–±—Ç–∏—Ç—Ä–æ–≤

```javascript
/**
 * –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å–µ —Å–µ–≥–º–µ–Ω—Ç—ã –≤ –æ–¥–∏–Ω —Ç–µ–∫—Å—Ç
 * @param {Array} segments - –ú–∞—Å—Å–∏–≤ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
 * @param {boolean} withTimestamps - –í–∫–ª—é—á–∞—Ç—å –ª–∏ —Ç–∞–π–º—Å—Ç–∞–º–ø—ã
 * @returns {string} - –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç
 */
export function getFullTranscriptText(segments, withTimestamps = false) {
  if (withTimestamps) {
    return segments
      .map(segment => `[${formatTime(segment.start)}] ${segment.text}`)
      .join('\n');
  } else {
    return segments
      .map(segment => segment.text)
      .join(' ');
  }
}
```

### –ü–æ–∏—Å–∫ –ø–æ —Å—É–±—Ç–∏—Ç—Ä–∞–º

```javascript
/**
 * –ò—â–µ—Ç —Å–µ–≥–º–µ–Ω—Ç—ã, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –∑–∞–ø—Ä–æ—Å
 * @param {Array} segments - –ú–∞—Å—Å–∏–≤ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
 * @param {string} query - –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
 * @param {boolean} caseSensitive - –£—á–∏—Ç—ã–≤–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä
 * @returns {Array} - –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Å–µ–≥–º–µ–Ω—Ç—ã
 */
export function searchInTranscript(segments, query, caseSensitive = false) {
  if (!query) return segments;

  const normalizedQuery = caseSensitive ? query : query.toLowerCase();

  return segments.filter(segment => {
    const text = caseSensitive ? segment.text : segment.text.toLowerCase();
    return text.includes(normalizedQuery);
  });
}
```

---

## üöÄ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```javascript
import { getYouTubeTranscript } from './services/youtube-transcript-service.js';

const videoId = "dQw4w9WgXcQ";
const transcript = await getYouTubeTranscript(videoId);

console.log(transcript.segments);
```

### –ü—Ä–∏–º–µ—Ä 2: –° –≤—ã–±–æ—Ä–æ–º —è–∑—ã–∫–∞

```javascript
const transcript = await getYouTubeTranscript(videoId, {
  preferredLanguage: "ru"  // –†—É—Å—Å–∫–∏–µ —Å—É–±—Ç–∏—Ç—Ä—ã
});
```

### –ü—Ä–∏–º–µ—Ä 3: –ë–µ–∑ –∫—ç—à–∞

```javascript
const transcript = await getYouTubeTranscript(videoId, {
  useCache: false  // –í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
});
```

### –ü—Ä–∏–º–µ—Ä 4: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```javascript
try {
  const transcript = await getYouTubeTranscript(videoId);
  console.log("Success:", transcript);
} catch (error) {
  if (error.message.includes("No suitable language")) {
    console.error("Video has no transcripts available");
  } else if (error.message.includes("All methods failed")) {
    console.error("Could not fetch transcript using any method");
  } else {
    console.error("Unknown error:", error);
  }
}
```

### –ü—Ä–∏–º–µ—Ä 5: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —è–∑—ã–∫–æ–≤

```javascript
import { fetchYouTubePageHtml, extractCaptionTracks } from './utils/youtube-parser.js';

const html = await fetchYouTubePageHtml(videoId);
const languages = extractCaptionTracks(html);

console.log("Available languages:");
languages.forEach(lang => {
  console.log(`- ${lang.language} (${lang.langCode})${lang.kind === 'asr' ? ' [Auto-generated]' : ''}`);
});
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. –°–µ–ª–µ–∫—Ç–æ—Ä—ã DOM –º–æ–≥—É—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è

YouTube —Ä–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –ï—Å–ª–∏ –º–µ—Ç–æ–¥ DOM –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø–µ—Ä–µ—Å—Ç–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤:

```javascript
// –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ YouTube –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
document.querySelector("#primary-button > ytd-button-renderer > yt-button-shape > button");
document.querySelectorAll("#segments-container > ytd-transcript-segment-renderer");
```

### 2. CORS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

–ï—Å–ª–∏ –≤—ã –¥–µ–ª–∞–µ—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –∏–∑ –æ–±—ã—á–Ω–æ–≥–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–Ω–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è), –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å CORS –æ—à–∏–±–∫–∏. –†–µ—à–µ–Ω–∏—è:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Chrome Extension (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ DOM –ø–∞—Ä—Å–∏–Ω–≥ –º–µ—Ç–æ–¥

### 3. Rate limiting

YouTube –º–æ–∂–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –î–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- –†–æ—Ç–∏—Ä—É–π—Ç–µ –≤–µ—Ä—Å–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

### 4. –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—É–±—Ç–∏—Ç—Ä—ã

–°—É–±—Ç–∏—Ç—Ä—ã —Å `kind: "asr"` —è–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏ –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—à–∏–±–∫–∏. –£—á–∏—Ç—ã–≤–∞–π—Ç–µ —ç—Ç–æ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–µ–∫—Å—Ç–∞.

### 5. –í–∏–¥–µ–æ –±–µ–∑ —Å—É–±—Ç–∏—Ç—Ä–æ–≤

–ù–µ –≤—Å–µ –≤–∏–¥–µ–æ –∏–º–µ—é—Ç —Å—É–±—Ç–∏—Ç—Ä—ã. –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ:

```javascript
const languages = extractCaptionTracks(html);
if (languages.length === 0) {
  console.log("This video has no captions available");
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–µ –≤–∏–¥–µ–æ

1. **–° —Ä—É—á–Ω—ã–º–∏ —Å—É–±—Ç–∏—Ç—Ä–∞–º–∏**: `dQw4w9WgXcQ` (Rick Astley - Never Gonna Give You Up)
2. **–° –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏**: –ª—é–±–æ–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ –≤–∏–¥–µ–æ
3. **–° –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —è–∑—ã–∫–∞–º–∏**: –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –≤–∏–¥–µ–æ –æ—Ç –∫—Ä—É–ø–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤

### –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞

```javascript
async function testTranscriptService() {
  const testCases = [
    { videoId: "dQw4w9WgXcQ", description: "Popular music video" },
    { videoId: "jNQXAC9IVRw", description: "Me at the zoo (first YouTube video)" }
  ];

  for (const testCase of testCases) {
    console.log(`\nTesting: ${testCase.description}`);
    try {
      const transcript = await getYouTubeTranscript(testCase.videoId);
      console.log(`‚úÖ Success: ${transcript.totalSegments} segments, method: ${transcript.method}`);
    } catch (error) {
      console.log(`‚ùå Failed: ${error.message}`);
    }
  }
}

testTranscriptService();
```

---

## üìà –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Å—É–±—Ç–∏—Ç—Ä—ã –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–∏–¥–µ–æ:

```javascript
async function getMultipleTranscripts(videoIds) {
  const promises = videoIds.map(id =>
    getYouTubeTranscript(id).catch(err => ({
      videoId: id,
      error: err.message
    }))
  );

  return await Promise.all(promises);
}
```

### 2. –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ HTML

–ï—Å–ª–∏ –≤—ã —É–∂–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ YouTube, –Ω–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å fetch:

```javascript
// –í–º–µ—Å—Ç–æ:
const html = await fetchYouTubePageHtml(videoId);

// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
const html = document.documentElement.outerHTML;
```

### 3. –°–∂–∞—Ç–∏–µ –∫—ç—à–∞

–î–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞ –≤ localStorage:

```javascript
function cacheTranscript(videoId, data) {
  // –•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ
  const compressed = {
    v: videoId,
    l: data.language,
    s: data.segments.map(seg => [seg.start, seg.text])  // –¢–æ–ª—å–∫–æ –≤—Ä–µ–º—è –∏ —Ç–µ–∫—Å—Ç
  };
  localStorage.setItem(`yt_${videoId}`, JSON.stringify(compressed));
}
```

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏—Ö –º–µ—Ç–æ–¥–æ–≤

### –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ youtube-transcript npm –ø–∞–∫–µ—Ç:

```javascript
// –°—Ç–∞—Ä—ã–π –∫–æ–¥:
import { YoutubeTranscript } from 'youtube-transcript';
const transcript = await YoutubeTranscript.fetchTranscript(videoId);

// –ù–æ–≤—ã–π –∫–æ–¥:
import { getYouTubeTranscript } from './services/youtube-transcript-service.js';
const result = await getYouTubeTranscript(videoId);
const transcript = result.segments;
```

### –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ YouTube Data API v3:

YouTube Data API v3 **–ù–ï –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç** –¥–æ—Å—Ç—É–ø –∫ —Å—É–±—Ç–∏—Ç—Ä–∞–º. –ú–µ—Ç–æ–¥—ã –∏–∑ —ç—Ç–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Å—É–±—Ç–∏—Ç—Ä—ã.

---

## üéì –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [YouTube Player API](https://developers.google.com/youtube/iframe_api_reference)
- [Chrome Extension Development](https://developer.chrome.com/docs/extensions/)
- [Performance API](https://developer.mozilla.org/en-US/docs/Web/API/Performance_API)

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- [ ] –°–æ–∑–¥–∞–ª `utils/youtube-parser.js`
- [ ] –°–æ–∑–¥–∞–ª `services/youtube-transcript-api.js`
- [ ] –°–æ–∑–¥–∞–ª `services/youtube-dom-parser.js`
- [ ] –°–æ–∑–¥–∞–ª `services/youtube-transcript-service.js`
- [ ] –û–±–Ω–æ–≤–∏–ª `content-script.js`
- [ ] –û–±–Ω–æ–≤–∏–ª `manifest.json`
- [ ] –î–æ–±–∞–≤–∏–ª –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –≤–∏–¥–µ–æ
- [ ] –î–æ–±–∞–≤–∏–ª –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –î–æ–±–∞–≤–∏–ª fallback –º–µ—Ç–æ–¥—ã

---

## üí° –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–µ—Ç –≤–∞–º:
- ‚úÖ **95%+ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å** –ø–æ–ª—É—á–µ–Ω–∏—è —Å—É–±—Ç–∏—Ç—Ä–æ–≤
- ‚úÖ **–ë—ã—Å—Ç—Ä—É—é —Ä–∞–±–æ—Ç—É** –±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—é
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback** –ø—Ä–∏ —Å–±–æ—è—Ö
- ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫—É –ª—é–±—ã—Ö —è–∑—ã–∫–æ–≤**
- ‚úÖ **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º YouTube**

–ù–∞—á–Ω–∏—Ç–µ —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Å—Ç–æ–π –≤–µ—Ä—Å–∏–∏ (—Ç–æ–ª—å–∫–æ Internal API), –∑–∞—Ç–µ–º –¥–æ–±–∞–≤—å—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
