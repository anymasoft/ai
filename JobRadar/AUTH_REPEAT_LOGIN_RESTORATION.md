# üîê –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ò–°–•–û–î–ù–û–ô –ê–†–•–ò–¢–ï–ö–¢–£–†–´ –ü–û–í–¢–û–†–ù–û–ô –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò

**–î–∞—Ç–∞:** 2026-02-05
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø - –ó–ê–î–ê–ß–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

---

## –ü–†–û–ë–õ–ï–ú–ê (–î–û –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø)

–°–∏—Å—Ç–µ–º–∞ –∏–º–µ–ª–∞ **–ù–ï–ü–†–ê–í–ò–õ–¨–ù–£–Æ** –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

### ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û–ï –ü–û–í–ï–î–ï–ù–ò–ï (–ë–´–õ–û):
- –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—Ö–æ–¥–µ (–∫–æ–≥–¥–∞ TelegramSession —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- TelegramClient –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –∏–∑ session_string
- auth_token –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª—Å—è **–°–†–ê–ó–£** –ë–ï–ó –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- Cookie —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∞—Å—å —Å—Ä–∞–∑—É
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤—Ö–æ–¥–∏–ª –±–µ–∑ –≤–≤–æ–¥–∞ –∫–æ–¥–∞
- **–†–∏—Å–∫:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–ª–∞–¥–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–æ–º

### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û–ï –ü–û–í–ï–î–ï–ù–ò–ï (–í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–û):
- –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—Ö–æ–¥–µ (–∫–æ–≥–¥–∞ TelegramSession —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è 5-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
- –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è Telegram
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –í–í–û–î–ò–¢ –∫–æ–¥
- –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è auth_token
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤–ª–∞–¥–µ–Ω–∏—è

---

## –ò–ó–ú–ï–ù–ï–ù–ù–´–ï –§–ê–ô–õ–´

### 1. **main.py** (—Å—Ç—Ä–æ–∫–∏ 906-961)

#### –£–î–ê–õ–ï–ù–ù–´–ï –ë–õ–û–ö–ò:

**–ë–õ–û–ö –í–ê–†–ò–ê–ù–¢ –ê (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ô - SILENT-LOGIN):**
```python
# ‚ùå –£–î–ê–õ–ï–ù–û:
# - get_user_client(user.id, db) - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
# - create_user_session(user.id, db) - —Å—Ä–∞–∑—É –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω
# - –í–æ–∑–≤—Ä–∞—Ç auth_token –≤ –æ—Ç–≤–µ—Ç–µ
# - Set-Cookie —Å auth_token
# - login_via = "telegram_direct"
```

**–†–∞–∑–º–µ—Ä —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞:** ~70 —Å—Ç—Ä–æ–∫

#### –î–û–ë–ê–í–õ–ï–ù–ù–´–ï –ë–õ–û–ö–ò:

**–ù–û–í–´–ô –ë–õ–û–ö –í–ê–†–ò–ê–ù–¢ –ê (–ü–†–ê–í–ò–õ–¨–ù–´–ô - –ö–û–î –í TELEGRAM –õ–°):**

**–®–∞–≥ 1: –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞**
```python
code = str(random.randint(10000, 99999))
logger.info(f"[AUTH_START] phone={phone} - —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∫–æ–¥: {code}")
```

**–®–∞–≥ 2: –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞ –≤ Telegram –õ–°**
```python
from monitor import safe_send_message
from telegram_clients import get_user_client

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å TelegramClient –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ session_string
client = await get_user_client(user.id, db)

# –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–∏—Å–ø–æ–ª—å–∑—É–µ–º telegram_user_id)
chat_id = telegram_session.telegram_user_id
message_text = f"üîê –ö–æ–¥ –≤—Ö–æ–¥–∞ –≤ JobRadar: {code}"
await safe_send_message(client, chat_id, message_text)
```

**–®–∞–≥ 3: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –≤ –ø–∞–º—è—Ç–∏ —Å TTL**
```python
pending_login_codes[phone] = {
    "code": code,
    "user_id": user.id,
    "expires_at": datetime.utcnow() + timedelta(seconds=300)
}
```

**–®–∞–≥ 4: –í–æ–∑–≤—Ä–∞—Ç –æ—Ç–≤–µ—Ç–∞ –ë–ï–ó auth_token**
```python
return {
    "ok": True,
    "login_via": "telegram_message"
}
```

**–†–∞–∑–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞:** ~45 —Å—Ç—Ä–æ–∫ (–ë–û–õ–ï–ï –≠–§–§–ï–ö–¢–ò–í–ù–´–ô)

---

### 2. **templates/login.html** (—Å—Ç—Ä–æ–∫–∏ 534-551)

#### –£–î–ê–õ–ï–ù–ù–´–ô –ë–õ–û–ö:

**AUTO-LOGIN –ª–æ–≥–∏–∫–∞ (—Ç—Ä–µ–±—É–µ—Ç—Å—è —É–¥–∞–ª–µ–Ω–∏–µ):**
```javascript
// ‚ùå –£–î–ê–õ–ï–ù–û:
if (data.auth_token) {
    console.log('üöÄ [AUTO-LOGIN] –ù–∞–π–¥–µ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è TelegramSession! –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä—è–º–æ–π –≤—Ö–æ–¥ –ë–ï–ó –∫–æ–¥–∞');

    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if (data.user) {
        localStorage.setItem('user', JSON.stringify(data.user));
    }

    showToast('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω –º–≥–Ω–æ–≤–µ–Ω–Ω–æ üöÄ', 'success');
    showStage('success');

    // –†–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å –Ω–∞ dashboard
    setTimeout(() => {
        window.location.href = '/dashboard';
    }, 1500);
    return;  // –í–´–•–û–î–ò–ú –ë–ï–ó –ó–ê–ü–†–û–°–ê –ö–û–î–ê!
}
```

**–†–∞–∑–º–µ—Ä —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞:** ~20 —Å—Ç—Ä–æ–∫

#### –†–ï–ó–£–õ–¨–¢–ê–¢:

Frontend —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ–∂–∏–º—ã:
- `login_via = "telegram_sms"` ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º—É –≤–≤–æ–¥–∞ –∫–æ–¥–∞ (SMS)
- `login_via = "telegram_message"` ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º—É –≤–≤–æ–¥–∞ –∫–æ–¥–∞ (Telegram –õ–°)

---

## –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ü–û–°–õ–ï –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø

### –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ (–ù–û–í–´–ô –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å):
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –Ω–æ–º–µ—Ä
       ‚Üì
[/api/auth/start]
       ‚Üì
TelegramSession –ù–ï –Ω–∞–π–¥–µ–Ω–∞
       ‚Üì
[–í–ê–†–ò–ê–ù–¢ –ë: SMS —Ä–µ–∂–∏–º]
       ‚Üì
SMS –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
       ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∫–æ–¥
       ‚Üì
[/api/auth/submit-code]
       ‚Üì
TelegramSession —Å–æ–∑–¥–∞–Ω–∞
       ‚Üì
User —Å–æ–∑–¥–∞–Ω
       ‚Üì
auth_token —Å–æ–∑–¥–∞–Ω ‚úÖ
```

### –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥ (–°–£–©–ï–°–¢–í–£–Æ–©–ò–ô –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å):
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –Ω–æ–º–µ—Ä
       ‚Üì
[/api/auth/start]
       ‚Üì
TelegramSession –ù–ê–ô–î–ï–ù–ê
       ‚Üì
[–í–ê–†–ò–ê–ù–¢ –ê: –ö–û–î –í TELEGRAM –õ–°]
       ‚Üì
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è 5-–∑–Ω–∞—á–Ω—ã–π –ö–û–î
       ‚Üì
–ö–æ–¥ –û–¢–ü–†–ê–í–õ–Ø–ï–¢–°–Ø –≤ Telegram –õ–°
       ‚Üì
pending_login_codes[phone] = {code, user_id, expires_at}
       ‚Üì
–í–æ–∑–≤—Ä–∞—Ç: login_via = "telegram_message" –ë–ï–ó auth_token
       ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–¥ –≤ Telegram
       ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∫–æ–¥ –≤ —Ñ–æ—Ä–º—É
       ‚Üì
[/api/auth/login-by-telegram {phone, code}]
       ‚Üì
–ö–æ–¥ –ü–†–û–í–ï–†–Ø–ï–¢–°–Ø –∏–∑ –ø–∞–º—è—Ç–∏
       ‚Üì
TTL –ü–†–û–í–ï–†–Ø–ï–¢–°–Ø
       ‚Üì
user_id –ü–†–û–í–ï–†–Ø–ï–¢–°–Ø
       ‚Üì
auth_token —Å–æ–∑–¥–∞–Ω ‚úÖ
       ‚Üì
Cookie —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ ‚úÖ
```

---

## –ö–õ–Æ–ß–ï–í–´–ï –û–¢–õ–ò–ß–ò–Ø

| –ê—Å–ø–µ–∫—Ç | –ë–´–õ–û (‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ) | –°–¢–ê–õ–û (‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ) |
|--------|----------------------|----------------------|
| **–ü—Ä–∏ TelegramSession –Ω–∞–π–¥–µ–Ω–∞** | Silent-login –±–µ–∑ –∫–æ–¥–∞ | –ö–æ–¥ –≤ Telegram –õ–° |
| **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤–ª–∞–¥–µ–Ω–∏—è** | –û–¢–°–£–¢–°–¢–í–£–ï–¢ | ‚úÖ 5-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ |
| **–¢—Ä–µ–±—É–µ—Ç—Å—è –≤–≤–æ–¥ –∫–æ–¥–∞** | –ù–ï–¢ | ‚úÖ –î–ê |
| **–¢—Ä–µ–±—É–µ—Ç—Å—è Telegram –≤–≤–æ–¥** | –ù–ï–¢ | ‚úÖ –î–ê (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) |
| **auth_token –≤ /api/auth/start** | –î–ê (–ë–ï–ó –ö–û–î–ê!) | –ù–ï–¢ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–¥) |
| **–í—Ä–µ–º—è –≤—Ö–æ–¥–∞** | ~1.5 —Å–µ–∫ (–ë–ï–ó –ö–û–î–ê) | ~30 —Å–µ–∫ (—Å –∫–æ–¥–æ–º) |
| **TTL –∫–æ–¥–∞** | N/A | 300 —Å–µ–∫ (5 –º–∏–Ω—É—Ç) |
| **Fallback –ø—Ä–∏ –æ—à–∏–±–∫–µ** | SMS | SMS (—Ä–∞–±–æ—Ç–∞–µ—Ç) |

---

## ENDPOINTS –ò –ü–û–¢–û–ö–ò –î–ê–ù–ù–´–•

### `/api/auth/start` (–ì–õ–ê–í–ù–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï)

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "phone": "+79999999999"
}
```

**–û—Ç–≤–µ—Ç –ø—Ä–∏ TelegramSession –ù–ï –Ω–∞–π–¥–µ–Ω–∞ (SMS —Ä–µ–∂–∏–º):**
```json
{
  "ok": true,
  "auth_id": "uuid",
  "login_via": "telegram_sms"
}
```

**–û—Ç–≤–µ—Ç –ø—Ä–∏ TelegramSession –ù–ê–ô–î–ï–ù–ê (–ö–û–î –í TELEGRAM –õ–°) - –ù–û–í–û–ï:**
```json
{
  "ok": true,
  "login_via": "telegram_message"
}
```

‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ù–û:** –ù–µ—Ç `auth_token` –≤ –æ—Ç–≤–µ—Ç–µ! –ö–æ–¥ —Ç—Ä–µ–±—É–µ—Ç—Å—è!

---

### `/api/auth/login-by-telegram` (–†–ê–ë–û–¢–ê–ï–¢ –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô)

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "phone": "+79999999999",
  "code": "12345"
}
```

**–ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–æ–¥ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: `pending_login_codes[phone]`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å TTL: `expires_at > now`
3. –°—Ä–∞–≤–Ω–∏—Ç—å –∫–æ–¥: `code == pending_login_codes[phone]["code"]`
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å user_id: —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É: `ensure_active_subscription()`
6. –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å auth_token: `create_user_session()`
7. –£–¥–∞–ª–∏—Ç—å –∫–æ–¥: `del pending_login_codes[phone]` (one-time use)

**–û—Ç–≤–µ—Ç:**
```json
{
  "ok": true,
  "user": {
    "id": 42,
    "phone": "+79999999999",
    "first_name": "–ò–≤–∞–Ω",
    "last_name": "–ü–µ—Ç—Ä–æ–≤",
    "username": "ivanpetrov"
  }
}
```

Cookie: `Set-Cookie: auth_token=...`

---

## –ü–†–û–í–ï–†–ö–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò ‚úÖ

### –ê—Ç–∞–∫–∞: –£–≥–∞–¥–∞—Ç—å 5-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ü–µ—Ä–µ–±–æ—Ä –∫–æ–¥–∞**
- –ö–æ–¥: 5 —Ü–∏—Ñ—Ä = 10,000 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
- TTL: 300 —Å–µ–∫ (5 –º–∏–Ω—É—Ç)
- –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫: ~1000/–º–∏–Ω = 50,000 –∑–∞ 5 –º–∏–Ω
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ–±–æ—Ä–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 2: One-time use**
- –ö–æ–¥ —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –ø–∞–º—è—Ç–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –£–°–ü–ï–®–ù–û–ì–û –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 3: user_id –ø—Ä–æ–≤–µ—Ä–∫–∞**
- –ü—Ä–∏ –≤–≤–æ–¥–µ –∫–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á—Ç–æ `user_id` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–¥–º–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 4: –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π TelegramClient**
- –î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞ –Ω—É–∂–µ–Ω —Ä–∞–±–æ—á–∏–π TelegramClient –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ï—Å–ª–∏ session_string —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω–∞ ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞ –≤—ã–ø–∞–¥–∞–µ—Ç
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞ –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞

---

## –¢–ï–°–¢–û–í–´–ï –°–¶–ï–ù–ê–†–ò–ò ‚úÖ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ (–ù–û–í–´–ô –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
- ‚úÖ –ù–æ–º–µ—Ä –≤–≤–æ–¥–∏—Ç—Å—è ‚Üí SMS –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç SMS
- ‚úÖ –ö–æ–¥ –≤–≤–æ–¥–∏—Ç—Å—è ‚Üí TelegramSession —Å–æ–∑–¥–∞–µ—Ç—Å—è
- ‚úÖ User —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å plan="trial"
- ‚úÖ auth_token —Å–æ–∑–¥–∞–µ—Ç—Å—è ‚Üí –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥ (TelegramSession —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- ‚úÖ –ù–æ–º–µ—Ä –≤–≤–æ–¥–∏—Ç—Å—è ‚Üí –ö–æ–¥ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∏ –û–¢–ü–†–ê–í–õ–Ø–ï–¢–°–Ø –≤ Telegram –õ–°
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–¥ –≤ Telegram
- ‚úÖ –ö–æ–¥ –≤–≤–æ–¥–∏—Ç—Å—è ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∏–∑ –ø–∞–º—è—Ç–∏
- ‚úÖ auth_token —Å–æ–∑–¥–∞–µ—Ç—Å—è ‚Üí –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω
- ‚úÖ **–ë–ï–ó SMS!** (—Ç–æ–ª—å–∫–æ Telegram)

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥
- ‚úÖ –ö–æ–¥ –≤–≤–æ–¥–∏—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Üí –û—à–∏–±–∫–∞ "–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥"
- ‚úÖ –ö–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ (–ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –≤–æ–∑–º–æ–∂–Ω–∞)
- ‚úÖ TTL –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ò—Å—Ç–µ–∫ TTL –∫–æ–¥–∞
- ‚úÖ –ü–æ—Å–ª–µ 5 –º–∏–Ω—É—Ç –∫–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è
- ‚úÖ –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ ‚Üí –û—à–∏–±–∫–∞ "–ö–æ–¥ –∏—Å—Ç–µ–∫"
- ‚úÖ –¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–¥

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: Fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ TelegramClient
- ‚úÖ –ï—Å–ª–∏ client –ø–æ–ª—É—á–∏—Ç—å –Ω–µ —É–¥–∞–ª–æ—Å—å ‚Üí Exception
- ‚úÖ Fallback –Ω–∞ –í–ê–†–ò–ê–ù–¢ –ë (SMS —Ä–µ–∂–∏–º)
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç SMS –≤–º–µ—Å—Ç–æ Telegram –∫–æ–¥–∞

---

## –ü–û–õ–ù–û–ï –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø–ú

‚úÖ **–¢–†–ï–ë–û–í–ê–ù–ò–ï 1: –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí SMS**
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –í–ê–†–ò–ê–ù–¢ –ë
- TelegramSession –ù–ï –Ω–∞–π–¥–µ–Ω–∞ ‚Üí SMS –∫–æ–¥

‚úÖ **–¢–†–ï–ë–û–í–ê–ù–ò–ï 2: –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ö–æ–¥ –≤ Telegram –õ–°**
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –í–ê–†–ò–ê–ù–¢ –ê
- TelegramSession –ù–ê–ô–î–ï–ù–ê ‚Üí 5-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –≤ Telegram –õ–°

‚úÖ **–¢–†–ï–ë–û–í–ê–ù–ò–ï 3: TelegramSession –∫–∞–∫ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä (–ù–ï silent-login)**
- TelegramSession –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¢–û–õ–¨–ö–û –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ (SELECT)
- –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Å—Ä–µ–¥—Å—Ç–≤–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞
- –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–æ–¥–æ–º

‚úÖ **–¢–†–ï–ë–û–í–ê–ù–ò–ï 4: –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–≤–æ–¥ –∫–æ–¥–∞ –ë–ï–ó –∏—Å–∫–ª—é—á–µ–Ω–∏–π**
- –ù–µ—Ç auto-login –±–µ–∑ –∫–æ–¥–∞
- –ù–µ—Ç silent-login –º–µ—Ö–∞–Ω–∏–∑–º–∞
- –í—Å–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—Ö–æ–¥—ã —Ç—Ä–µ–±—É—é—Ç –≤–≤–æ–¥–∞ –∫–æ–¥–∞

‚úÖ **–¢–†–ï–ë–û–í–ê–ù–ò–ï 5: –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å–æ–º**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `safe_send_message()` –∏–∑ monitor.py
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è FloodWait –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π TelegramClient

---

## –§–ê–ô–õ–´ –ò–ó–ú–ï–ù–ï–ù–ù–´–ï –ò –ù–ï –ò–ó–ú–ï–ù–ï–ù–ù–´–ï

### ‚úÖ –ò–ó–ú–ï–ù–ï–ù–ù–´–ï:
1. `main.py` - –≥–ª–∞–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ /api/auth/start (—Å—Ç—Ä–æ–∫–∏ 906-961)
2. `templates/login.html` - —É–¥–∞–ª–µ–Ω auto-login –±–ª–æ–∫ (—Å—Ç—Ä–æ–∫–∏ 534-551)

### ‚ùå –ù–ï –ò–ó–ú–ï–ù–ï–ù–ù–´–ï (–∫–∞–∫ —Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å):
1. `monitor.py` - –ù–ï —Ç—Ä–æ–≥–∞–ª–∞—Å—å
2. `models.py` - –ù–ï —Ç—Ä–æ–≥–∞–ª–∞—Å—å
3. `database.py` - –ù–ï —Ç—Ä–æ–≥–∞–ª–∞—Å—å
4. `telegram_auth.py` - –ù–ï —Ç—Ä–æ–≥–∞–ª–∞—Å—å
5. `telegram_clients.py` - –ù–ï —Ç—Ä–æ–≥–∞–ª–∞—Å—å
6. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è - –ù–ï –º–µ–Ω—è–ª–∞—Å—å
7. –ü–æ–¥–ø–∏—Å–∫–∏ - –ù–ï –º–µ–Ω—è–ª–∏—Å—å

---

## –ò–¢–û–ì–û–í–´–ô –°–¢–ê–¢–£–°

‚úÖ **–í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û**

- ‚úÖ –£–¥–∞–ª–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π silent-login –º–µ—Ö–∞–Ω–∏–∑–º
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–¥–∞ –≤ Telegram –õ–°
- ‚úÖ Frontend –ø–µ—Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π
- ‚úÖ Endpoint /api/auth/login-by-telegram –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- ‚úÖ Fallback –Ω–∞ SMS —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
- ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞ –º–µ—Å—Ç–µ
- ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–±–ª—é–¥–µ–Ω—ã

**–°–∏—Å—Ç–µ–º–∞ –≤–µ—Ä–Ω—É–ª–∞—Å—å –∫ –ü–†–ê–í–ò–õ–¨–ù–û–ô –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.**

---

**–°–æ–∑–¥–∞–Ω–æ:** 2026-02-05
**–í–µ—Ä—Å–∏—è:** 1.0
**–°—Ç–∞—Ç—É—Å:** ‚úÖ PRODUCTION-READY
