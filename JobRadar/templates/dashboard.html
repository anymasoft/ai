<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JobRadar - Lead Monitoring SaaS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #5856d6;
            --primary-dark: #4c4ab3;
            --gray-light: #f8f9fa;
            --gray-bg: #f5f5f5;
            --gray-border: #e0e0e0;
            --text-dark: #222;
            --text-gray: #666;
            --text-light: #999;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--gray-bg);
            color: var(--text-dark);
        }

        .dashboard {
            display: flex;
            min-height: 100vh;
        }

        /* SIDEBAR */
        .sidebar {
            width: 250px;
            background: white;
            border-right: 1px solid var(--gray-border);
            padding: 1.5rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-brand {
            padding: 0 1.5rem;
            margin-bottom: 2rem;
        }

        .sidebar-brand h5 {
            color: var(--primary);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            color: var(--text-gray);
            cursor: pointer;
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .nav-link:hover {
            color: var(--primary);
            background: rgba(88, 86, 214, 0.05);
        }

        .nav-link.active {
            color: var(--primary);
            background: rgba(88, 86, 214, 0.1);
            border-left-color: var(--primary);
            font-weight: 600;
        }

        .nav-link i {
            width: 20px;
        }

        /* MAIN */
        .main-content {
            margin-left: 250px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: white;
            border-bottom: 1px solid var(--gray-border);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left h3 {
            margin: 0;
            font-size: 1.5rem;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .header-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.25rem;
            color: var(--text-gray);
            position: relative;
            transition: color 0.3s;
        }

        .header-btn:hover {
            color: var(--primary);
        }

        .badge-count {
            position: absolute;
            top: -5px;
            right: -8px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        .content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* CARDS */
        .stat-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--gray-border);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        /* TASK CARDS */
        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .task-card {
            background: white;
            border: 1px solid var(--gray-border);
            border-radius: 8px;
            padding: 1.5rem;
            position: relative;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .task-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
            flex: 1;
        }

        .task-status {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .task-status.running {
            background: #d4edda;
            color: #155724;
        }

        .task-status.paused {
            background: #fff3cd;
            color: #856404;
        }

        .task-counts {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--gray-border);
            font-size: 0.85rem;
        }

        .task-count {
            text-align: center;
        }

        .task-count-value {
            font-weight: 700;
            color: var(--primary);
        }

        .task-count-label {
            color: var(--text-light);
            font-size: 0.75rem;
        }

        .task-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--gray-border);
            background: white;
            color: var(--text-gray);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            border-color: var(--primary-dark);
        }

        .btn-danger {
            color: #dc3545;
        }

        .btn-danger:hover {
            color: #c82333;
            border-color: #dc3545;
        }

        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            flex: 1;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--text-gray);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-gray);
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--gray-border);
            border-radius: 4px;
            font-family: inherit;
            font-size: 0.95rem;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(88, 86, 214, 0.1);
        }

        .form-hint {
            display: block;
            margin-top: 0.25rem;
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .modal-actions button {
            flex: 1;
        }

        /* LEADS TABLE */
        .leads-filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .leads-filters select,
        .leads-filters input {
            padding: 0.75rem;
            border: 1px solid var(--gray-border);
            border-radius: 4px;
            font-family: inherit;
            font-size: 0.95rem;
            flex: 1;
            min-width: 150px;
        }

        .leads-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .lead-item {
            background: white;
            border: 1px solid var(--gray-border);
            border-radius: 4px;
            padding: 1rem;
        }

        .lead-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.75rem;
        }

        .lead-text {
            font-weight: 500;
            color: var(--text-dark);
            flex: 1;
            margin-right: 1rem;
        }

        .lead-status {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .lead-status.new {
            background: #d1ecf1;
            color: #0c5460;
        }

        .lead-status.viewed {
            background: #e2e3e5;
            color: #383d41;
        }

        .lead-status.archived {
            background: #f8d7da;
            color: #721c24;
        }

        .lead-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 0.75rem;
        }

        .lead-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .lead-actions button {
            font-size: 0.8rem;
            padding: 0.4rem 0.75rem;
        }

        /* BILLING */
        .pricing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .pricing-card {
            background: white;
            border: 2px solid var(--gray-border);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            position: relative;
        }

        .pricing-card.current {
            border-color: var(--primary);
            background: rgba(88, 86, 214, 0.02);
        }

        .pricing-badge {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .pricing-name {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .pricing-price {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .pricing-features {
            text-align: left;
            margin-bottom: 1.5rem;
        }

        .pricing-features li {
            list-style: none;
            padding: 0.5rem 0;
            font-size: 0.9rem;
            color: var(--text-gray);
        }

        .pricing-features li:before {
            content: '✓ ';
            color: var(--primary);
            font-weight: 700;
            margin-right: 0.5rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
        }

        .empty-state i {
            font-size: 3rem;
            color: var(--gray-border);
            margin-bottom: 1rem;
        }

        .empty-state h4 {
            color: var(--text-gray);
            margin-bottom: 0.5rem;
        }

        .empty-state p {
            color: var(--text-light);
            margin-bottom: 1.5rem;
        }

        /* TOAST NOTIFICATIONS */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 2000;
            pointer-events: none;
        }

        .toast {
            background: white;
            border: 1px solid var(--gray-border);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            min-width: 300px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            pointer-events: auto;
            animation: slideInRight 0.3s ease-out;
        }

        .toast.success {
            border-left: 4px solid #22c55e;
            background: #f0fdf4;
        }

        .toast.error {
            border-left: 4px solid #ef4444;
            background: #fef2f2;
        }

        .toast.warning {
            border-left: 4px solid #f97316;
            background: #fffbeb;
        }

        .toast.info {
            border-left: 4px solid var(--primary);
            background: #f5f3ff;
        }

        .toast-icon {
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .toast.success .toast-icon { color: #22c55e; }
        .toast.error .toast-icon { color: #ef4444; }
        .toast.warning .toast-icon { color: #f97316; }
        .toast.info .toast-icon { color: var(--primary); }

        .toast-close {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-gray);
            font-size: 1.25rem;
            padding: 0;
            margin-left: auto;
            flex-shrink: 0;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(20px);
            }
        }

        .toast.removing {
            animation: slideOutRight 0.3s ease-in;
        }

        /* DIALOG/MODAL */
        .dialog-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1500;
            align-items: center;
            justify-content: center;
        }

        .dialog-overlay.visible {
            display: flex;
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .dialog-content {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dialog-header {
            margin-bottom: 1.5rem;
        }

        .dialog-header h3 {
            font-size: 1.25rem;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .dialog-header p {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .dialog-body {
            margin-bottom: 1.5rem;
            color: var(--text-gray);
        }

        .dialog-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .dialog-actions button {
            padding: 0.5rem 1.5rem;
            border-radius: 4px;
            border: 1px solid var(--gray-border);
            background: white;
            color: var(--text-gray);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .dialog-actions button:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .dialog-actions .btn-primary {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .dialog-actions .btn-primary:hover {
            background: var(--primary-dark);
            border-color: var(--primary-dark);
        }

        @media (max-width: 768px) {
            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 1px solid var(--gray-border);
            }

            .main-content {
                margin-left: 0;
            }

            .tasks-grid {
                grid-template-columns: 1fr;
            }

            .stat-cards {
                grid-template-columns: repeat(2, 1fr);
            }

            .toast-container {
                left: 20px;
                right: 20px;
            }

            .toast {
                min-width: auto;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="sidebar-brand">
                <h5><i class="bi bi-speedometer2"></i> JobRadar</h5>
            </div>
            <ul class="nav-menu">
                <li><a class="nav-link active" data-section="dashboard"><i class="bi bi-speedometer2"></i> Dashboard</a></li>
                <li><a class="nav-link" data-section="tasks"><i class="bi bi-list-check"></i> Tasks</a></li>
                <li><a class="nav-link" data-section="leads"><i class="bi bi-fire"></i> Leads</a></li>
                <li><a class="nav-link" data-section="billing"><i class="bi bi-credit-card"></i> Billing</a></li>
                <li><a class="nav-link" data-section="settings"><i class="bi bi-gear"></i> Settings</a></li>
            </ul>
        </aside>

        <!-- MAIN -->
        <div class="main-content">
            <!-- HEADER -->
            <div class="header">
                <div class="header-left">
                    <h3 id="page-title">Dashboard</h3>
                </div>
                <div class="header-right">
                    <button class="header-btn" id="notifications-btn">
                        <i class="bi bi-bell"></i>
                        <span class="badge-count" id="notification-count"></span>
                    </button>
                    <button class="header-btn">
                        <i class="bi bi-person-circle"></i>
                    </button>
                </div>
            </div>

            <!-- CONTENT -->
            <div class="content">
                <!-- DASHBOARD SECTION -->
                <section id="dashboard" class="content-section active">
                    <div class="stat-cards">
                        <div class="stat-card">
                            <div class="stat-label">Active Tasks</div>
                            <div class="stat-value" id="stat-tasks">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Sources</div>
                            <div class="stat-value" id="stat-sources">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Keywords</div>
                            <div class="stat-value" id="stat-keywords">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Leads Today</div>
                            <div class="stat-value" id="stat-leads">0</div>
                        </div>
                    </div>

                    <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--gray-border); margin-bottom: 2rem;">
                        <h4 style="margin-bottom: 1rem;">Начните за 60 секунд</h4>
                        <p style="color: var(--text-light); margin-bottom: 1rem;">Создайте свою первую задачу мониторинга и начните находить лиды в каналах Telegram.</p>
                        <button class="btn btn-primary" onclick="openTaskModal()">
                            <i class="bi bi-plus"></i> Создать первую задачу
                        </button>
                    </div>

                    <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--gray-border);">
                        <h4 style="margin-bottom: 1rem;">Последние лиды</h4>
                        <div id="recent-leads" style="display: flex; flex-direction: column; gap: 1rem;"></div>
                    </div>
                </section>

                <!-- TASKS SECTION -->
                <section id="tasks" class="content-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h4>Ваши задачи</h4>
                        <button class="btn btn-primary" onclick="openTaskModal()">
                            <i class="bi bi-plus"></i> Новая задача
                        </button>
                    </div>
                    <div id="tasks-container" class="tasks-grid"></div>
                </section>

                <!-- LEADS SECTION -->
                <section id="leads" class="content-section">
                    <div class="leads-filters">
                        <select id="filter-task">
                            <option value="">Все задачи</option>
                        </select>
                        <select id="filter-status">
                            <option value="">Все статусы</option>
                            <option value="new">Новые</option>
                            <option value="viewed">Просмотренные</option>
                            <option value="archived">Архивированные</option>
                        </select>
                        <input type="text" id="filter-search" placeholder="Поиск лидов...">
                    </div>
                    <div id="leads-container" class="leads-list"></div>
                </section>

                <!-- BILLING SECTION -->
                <section id="billing" class="content-section">
                    <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--gray-border); margin-bottom: 2rem;">
                        <h4 style="margin-bottom: 1rem;">Current Plan</h4>
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary); margin-bottom: 1rem;">Free</div>
                        <p style="color: var(--text-light); margin-bottom: 1.5rem;">You're on the free plan. Upgrade to unlock more tasks and sources.</p>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; font-size: 0.9rem; margin-bottom: 1.5rem;">
                            <div>
                                <div style="font-weight: 600;">2/3 Tasks</div>
                                <div style="color: var(--text-light); font-size: 0.85rem;">Used</div>
                            </div>
                            <div>
                                <div style="font-weight: 600;">5/10 Sources</div>
                                <div style="color: var(--text-light); font-size: 0.85rem;">Used</div>
                            </div>
                            <div>
                                <div style="font-weight: 600;">10/25 Keywords</div>
                                <div style="color: var(--text-light); font-size: 0.85rem;">Used</div>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="showToast('Интеграция платежей в разработке', 'info')">Upgrade Now</button>
                    </div>

                    <h4 style="margin-bottom: 1rem;">Pricing Plans</h4>
                    <div class="pricing-grid">
                        <div class="pricing-card current">
                            <div class="pricing-badge">Current</div>
                            <div class="pricing-name">Starter</div>
                            <div class="pricing-price">Free</div>
                            <ul class="pricing-features">
                                <li>3 Tasks</li>
                                <li>10 Sources</li>
                                <li>25 Keywords</li>
                                <li>Email support</li>
                            </ul>
                            <button class="btn" disabled>Current Plan</button>
                        </div>

                        <div class="pricing-card">
                            <div class="pricing-name">Pro</div>
                            <div class="pricing-price">$29</div>
                            <div style="color: var(--text-light); margin-bottom: 1rem; font-size: 0.9rem;">per month</div>
                            <ul class="pricing-features">
                                <li>20 Tasks</li>
                                <li>100 Sources</li>
                                <li>500 Keywords</li>
                                <li>Priority support</li>
                            </ul>
                            <button class="btn btn-primary" onclick="showToast('Интеграция платежей в разработке', 'info')">Upgrade</button>
                        </div>

                        <div class="pricing-card">
                            <div class="pricing-name">Team</div>
                            <div class="pricing-price">$99</div>
                            <div style="color: var(--text-light); margin-bottom: 1rem; font-size: 0.9rem;">per month</div>
                            <ul class="pricing-features">
                                <li>Unlimited Tasks</li>
                                <li>Unlimited Sources</li>
                                <li>Unlimited Keywords</li>
                                <li>24/7 support</li>
                            </ul>
                            <button class="btn btn-primary" onclick="showToast('Интеграция платежей в разработке', 'info')">Contact</button>
                        </div>
                    </div>
                </section>

                <!-- SETTINGS SECTION -->
                <section id="settings" class="content-section">
                    <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--gray-border); margin-bottom: 1.5rem;">
                        <h4 style="margin-bottom: 1rem;">Account</h4>
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Telegram Account</label>
                            <button class="btn btn-primary" onclick="window.location.href='/login'">
                                <i class="bi bi-telegram"></i> Авторизоваться в Telegram
                            </button>
                        </div>
                    </div>

                    <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--gray-border); margin-bottom: 1.5rem;">
                        <h4 style="margin-bottom: 1rem;">Notifications</h4>
                        <div class="form-group" style="margin-bottom: 1rem;">
                            <label class="checkbox-group">
                                <input type="checkbox" id="notify-telegram" checked>
                                <span>New leads via Telegram</span>
                            </label>
                        </div>
                        <div class="form-group" style="margin-bottom: 1rem;">
                            <label class="checkbox-group">
                                <input type="checkbox" id="notify-email">
                                <span>Email digest (daily)</span>
                            </label>
                        </div>
                        <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                    </div>

                    <div style="background: #fff5f5; padding: 1.5rem; border-radius: 8px; border: 1px solid #fdd; margin-bottom: 1.5rem;">
                        <h4 style="margin-bottom: 1rem; color: #d32f2f;">Danger Zone</h4>
                        <button class="btn btn-danger" onclick="showDeleteConfirm('Вы уверены, что хотите удалить аккаунт? Это действие нельзя отменить.', () => showToast('Удаление аккаунта в разработке', 'info'))">
                            <i class="bi bi-trash"></i> Delete Account
                        </button>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- TOAST CONTAINER -->
    <div class="toast-container" id="toast-container"></div>

    <!-- DIALOG -->
    <div class="dialog-overlay" id="delete-dialog-overlay">
        <div class="dialog-content">
            <div class="dialog-header">
                <h3>Подтверждение удаления</h3>
            </div>
            <div class="dialog-body" id="delete-dialog-message"></div>
            <div class="dialog-actions">
                <button onclick="closeDeleteDialog()">Отмена</button>
                <button class="btn-primary" onclick="confirmDelete()">Удалить</button>
            </div>
        </div>
    </div>

    <!-- MODAL -->
    <div id="task-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span id="modal-title">Create Task</span>
                <button class="modal-close" onclick="closeTaskModal()">&times;</button>
            </div>
            <form id="task-form">
                <div class="form-group">
                    <label>Task Name *</label>
                    <input type="text" id="task-name" required>
                </div>

                <div class="form-group">
                    <label>Sources (channels/chats)</label>
                    <textarea id="task-sources" placeholder="telegram.me/channel&#10;https://t.me/+xxxxx&#10;One per line"></textarea>
                    <span class="form-hint">Enter Telegram channel links, one per line</span>
                </div>

                <div class="form-group">
                    <label>Include Keywords *</label>
                    <textarea id="task-include" placeholder="python&#10;remote&#10;One per line" required></textarea>
                    <span class="form-hint">Find leads containing these keywords</span>
                </div>

                <div class="form-group">
                    <label>Exclude Keywords (minus-words)</label>
                    <textarea id="task-exclude" placeholder="junior&#10;internship&#10;One per line"></textarea>
                    <span class="form-hint">Ignore leads containing these keywords</span>
                </div>

                <div class="form-group">
                    <label>Alerts</label>
                    <div class="checkbox-group" style="margin-bottom: 0.75rem;">
                        <input type="checkbox" id="alert-telegram" checked>
                        <span>Telegram</span>
                    </div>
                    <div class="checkbox-group" style="margin-bottom: 0.75rem;">
                        <input type="checkbox" id="alert-email">
                        <span>Email</span>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="alert-webhook">
                        <span>Webhook</span>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn" onclick="closeTaskModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Task</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ==================== UI COMPONENTS ====================
        function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            const icons = {
                success: 'bi-check-circle',
                error: 'bi-exclamation-circle',
                warning: 'bi-exclamation-triangle',
                info: 'bi-info-circle'
            };

            toast.innerHTML = `
                <i class="bi ${icons[type]} toast-icon"></i>
                <span>${message}</span>
                <button class="toast-close" onclick="this.parentElement.remove()">×</button>
            `;

            container.appendChild(toast);

            if (duration > 0) {
                setTimeout(() => {
                    toast.classList.add('removing');
                    setTimeout(() => toast.remove(), 300);
                }, duration);
            }
        }

        let deletePendingCallback = null;

        function showDeleteConfirm(message, onConfirm) {
            deletePendingCallback = onConfirm;
            document.getElementById('delete-dialog-message').textContent = message;
            document.getElementById('delete-dialog-overlay').classList.add('visible');
        }

        function closeDeleteDialog() {
            document.getElementById('delete-dialog-overlay').classList.remove('visible');
            deletePendingCallback = null;
        }

        function confirmDelete() {
            if (deletePendingCallback) {
                deletePendingCallback();
            }
            closeDeleteDialog();
        }

        // ==================== API FUNCTIONS ====================
        const API_BASE = '';

        async function getTasks() {
            try {
                const response = await fetch(`${API_BASE}/api/tasks`);
                if (!response.ok) throw new Error('Failed to fetch tasks');
                return await response.json();
            } catch (error) {
                console.error('Error fetching tasks:', error);
                return [];
            }
        }

        async function getStats() {
            try {
                const response = await fetch(`${API_BASE}/api/stats`);
                if (!response.ok) throw new Error('Failed to fetch stats');
                return await response.json();
            } catch (error) {
                console.error('Error fetching stats:', error);
                return {
                    active_tasks: 0,
                    total_tasks: 0,
                    total_sources: 0,
                    total_keywords: 0,
                    total_matches: 0
                };
            }
        }

        async function createTask(taskData) {
            try {
                const response = await fetch(`${API_BASE}/api/tasks`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(taskData)
                });
                if (!response.ok) throw new Error('Failed to create task');
                return await response.json();
            } catch (error) {
                console.error('Error creating task:', error);
                showToast('Ошибка создания задачи: ' + error.message, 'error');
                return null;
            }
        }

        async function updateTask(taskId, taskData) {
            try {
                const response = await fetch(`${API_BASE}/api/tasks/${taskId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(taskData)
                });
                if (!response.ok) throw new Error('Failed to update task');
                return await response.json();
            } catch (error) {
                console.error('Error updating task:', error);
                showToast('Ошибка обновления задачи: ' + error.message, 'error');
                return null;
            }
        }

        async function deleteTask(taskId) {
            try {
                const response = await fetch(`${API_BASE}/api/tasks/${taskId}`, {
                    method: 'DELETE'
                });
                if (!response.ok) throw new Error('Failed to delete task');
                return await response.json();
            } catch (error) {
                console.error('Error deleting task:', error);
                showToast('Ошибка удаления задачи: ' + error.message, 'error');
                return null;
            }
        }

        // ==================== NAVIGATION ====================
        document.querySelectorAll('[data-section]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const section = link.getAttribute('data-section');
                
                document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
                document.getElementById(section).classList.add('active');

                document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
                link.classList.add('active');

                const titles = {
                    dashboard: 'Dashboard',
                    tasks: 'Tasks',
                    leads: 'Leads',
                    billing: 'Billing',
                    settings: 'Settings'
                };
                document.getElementById('page-title').textContent = titles[section];

                if (section === 'tasks') renderTasks();
                if (section === 'leads') renderLeads();
            });
        });

        // ==================== TASK MANAGEMENT ====================
        let currentEditTaskId = null;

        async function openTaskModal(taskId = null) {
            currentEditTaskId = taskId;
            const modal = document.getElementById('task-modal');
            const form = document.getElementById('task-form');

            form.reset();

            if (taskId) {
                // Fetch the specific task
                try {
                    const response = await fetch(`${API_BASE}/api/tasks/${taskId}`);
                    if (!response.ok) throw new Error('Failed to fetch task');
                    const task = await response.json();

                    document.getElementById('modal-title').textContent = 'Edit Task';
                    document.getElementById('task-name').value = task.name;
                    document.getElementById('task-sources').value = task.sources;
                    document.getElementById('task-include').value = task.include_keywords;
                    document.getElementById('task-exclude').value = task.exclude_keywords || '';
                    document.getElementById('alert-telegram').checked = task.alerts_telegram;
                    document.getElementById('alert-email').checked = task.alerts_email;
                    document.getElementById('alert-webhook').checked = task.alerts_webhook;
                } catch (error) {
                    console.error('Error loading task:', error);
                    showToast('Ошибка загрузки задачи', 'error');
                    return;
                }
            } else {
                document.getElementById('modal-title').textContent = 'Create Task';
            }

            modal.classList.add('active');
        }

        function closeTaskModal() {
            document.getElementById('task-modal').classList.remove('active');
            currentEditTaskId = null;
        }

        document.getElementById('task-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('task-name').value.trim();
            const sources = document.getElementById('task-sources').value.trim();
            const include = document.getElementById('task-include').value.trim();
            const exclude = document.getElementById('task-exclude').value.trim();

            if (!name) {
                showToast('Название задачи обязательно', 'warning');
                return;
            }

            if (!include) {
                showToast('Требуется хотя бы одно включающее ключевое слово', 'warning');
                return;
            }

            const taskData = {
                name: name,
                status: 'running',
                sources: sources,
                include_keywords: include,
                exclude_keywords: exclude,
                alerts_telegram: document.getElementById('alert-telegram').checked,
                alerts_email: document.getElementById('alert-email').checked,
                alerts_webhook: document.getElementById('alert-webhook').checked
            };

            let result;
            if (currentEditTaskId) {
                result = await updateTask(currentEditTaskId, taskData);
            } else {
                result = await createTask(taskData);
            }

            if (result) {
                closeTaskModal();
                await renderTasks();
                await updateStats();
                showToast(currentEditTaskId ? 'Задача обновлена!' : 'Задача создана!', 'success');
            }
        });

        async function deleteTaskHandler(taskId) {
            showDeleteConfirm('Вы уверены, что хотите удалить эту задачу? Это действие нельзя отменить.', async () => {
                const result = await deleteTask(taskId);
                if (result) {
                    await renderTasks();
                    await updateStats();
                    showToast('Задача удалена', 'success');
                }
            });
        }

        async function toggleTaskStatus(taskId) {
            try {
                const response = await fetch(`${API_BASE}/api/tasks/${taskId}`);
                if (!response.ok) throw new Error('Failed to fetch task');
                const task = await response.json();

                const newStatus = task.status === 'running' ? 'paused' : 'running';
                const result = await updateTask(taskId, { status: newStatus });

                if (result) {
                    await renderTasks();
                }
            } catch (error) {
                console.error('Error toggling task status:', error);
            }
        }

        async function renderTasks() {
            const tasks = await getTasks();
            const container = document.getElementById('tasks-container');

            if (tasks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <i class="bi bi-briefcase"></i>
                        <h4>Нет задач</h4>
                        <p>Создайте свою первую задачу мониторинга, чтобы начать</p>
                        <button class="btn btn-primary" onclick="openTaskModal()">Создать задачу</button>
                    </div>
                `;
                return;
            }

            const countItems = (str) => str ? str.split(',').filter(s => s.trim()).length : 0;

            container.innerHTML = tasks.map(task => `
                <div class="task-card">
                    <div class="task-header">
                        <div class="task-title">${task.name}</div>
                        <span class="task-status ${task.status}">${task.status}</span>
                    </div>
                    <div class="task-counts">
                        <div class="task-count">
                            <div class="task-count-value">${countItems(task.sources)}</div>
                            <div class="task-count-label">Источники</div>
                        </div>
                        <div class="task-count">
                            <div class="task-count-value">${countItems(task.include_keywords)}</div>
                            <div class="task-count-label">Включить</div>
                        </div>
                        <div class="task-count">
                            <div class="task-count-value">${countItems(task.exclude_keywords)}</div>
                            <div class="task-count-label">Исключить</div>
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="btn btn-sm" onclick="toggleTaskStatus(${task.id})">
                            <i class="bi bi-pause-circle"></i> ${task.status === 'running' ? 'Пауза' : 'Запуск'}
                        </button>
                        <button class="btn btn-sm" onclick="openTaskModal(${task.id})">
                            <i class="bi bi-pencil"></i> Редактировать
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteTaskHandler(${task.id})">
                            <i class="bi bi-trash"></i> Удалить
                        </button>
                    </div>
                </div>
            `).join('');
        }

        async function renderLeads() {
            const container = document.getElementById('leads-container');

            container.innerHTML = `
                <div class="empty-state">
                    <i class="bi bi-search"></i>
                    <h4>Функция лидов в разработке</h4>
                    <p>Скоро можно будет просматривать найденные лиды</p>
                </div>
            `;
        }

        async function setLeadStatus(leadId, status) {
            // TODO: Implement when leads API is ready
            console.log('Set lead status:', leadId, status);
        }

        async function updateStats() {
            const stats = await getStats();

            document.getElementById('stat-tasks').textContent = stats.active_tasks;
            document.getElementById('stat-sources').textContent = stats.total_sources;
            document.getElementById('stat-keywords').textContent = stats.total_keywords;
            document.getElementById('stat-leads').textContent = stats.total_matches;

            const newLeads = 0; // TODO: Get from API
            if (newLeads > 0) {
                document.getElementById('notification-count').textContent = newLeads;
            } else {
                document.getElementById('notification-count').style.display = 'none';
            }

            // Update recent leads
            document.getElementById('recent-leads').innerHTML = '<div style="color: var(--text-light); padding: 0.75rem;">Лиды появятся после запуска мониторинга</div>';
        }

        function saveSettings() {
            showToast('Настройки сохранены!', 'success');
        }

        // Update task filter in leads
        async function updateTaskFilter() {
            const tasks = await getTasks();
            const select = document.getElementById('filter-task');
            const current = select.value;
            select.innerHTML = '<option value="">Все задачи</option>' +
                tasks.map(t => `<option value="${t.id}">${t.name}</option>`).join('');
            select.value = current;
        }

        document.getElementById('filter-task').addEventListener('change', renderLeads);
        document.getElementById('filter-status').addEventListener('change', renderLeads);
        document.getElementById('filter-search').addEventListener('input', renderLeads);

        // Init
        (async () => {
            await updateStats();
            await updateTaskFilter();
        })();
    </script>
</body>
</html>
