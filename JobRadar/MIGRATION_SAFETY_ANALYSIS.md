# üîí –ê–ù–ê–õ–ò–ó –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò –ú–ò–ì–†–ê–¶–ò–ò: Multi-Session

## –ü—Ä–æ–≤–µ—Ä–∫–∞: –ë—É–¥–µ—Ç –ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î?

**–û–¢–í–ï–¢: ‚úÖ –î–ê, –ê–ë–°–û–õ–Æ–¢–ù–û –ë–ï–ó–û–ü–ê–°–ù–û**

---

## üìã –ü–û–®–ê–ì–û–í–´–ô –ê–ù–ê–õ–ò–ó –ú–ò–ì–†–ê–¶–ò–ò

### –≠–¢–ê–ü 1: Base.metadata.create_all(bind=engine)

**–§–∞–π–ª:** `database.py`, line 197

```python
Base.metadata.create_all(bind=engine)
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- SQLAlchemy —á–∏—Ç–∞–µ—Ç –≤—Å–µ –º–æ–¥–µ–ª–∏ (–≤–∫–ª—é—á–∞—è –Ω–æ–≤—É—é UserSession)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL CREATE TABLE –∫–æ–º–∞–Ω–¥—ã
- **–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `IF NOT EXISTS`** –¥–ª—è SQLite
- –¢–∞–±–ª–∏—Ü—ã –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç ‚Üí **–Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ** ‚úÖ
- –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ user_sessions ‚Üí **—Å–æ–∑–¥–∞–µ—Ç—Å—è –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç** ‚úÖ

**–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î:**
```sql
-- SQLAlchemy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç:
CREATE TABLE IF NOT EXISTS user_sessions (
    id INTEGER NOT NULL,
    user_id INTEGER NOT NULL,
    auth_token VARCHAR(128) NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    last_seen_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (id),
    FOREIGN KEY(user_id) REFERENCES users (id),
    UNIQUE (auth_token)
)

-- –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç ‚úÖ
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û

---

### –≠–¢–ê–ü 2: –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

**–§–∞–π–ª:** `database.py`, lines 257-266

```python
# –ò–Ω–¥–µ–∫—Å –¥–ª—è UserSession.user_id
connection.execute(text(
    "CREATE INDEX IF NOT EXISTS idx_user_session_user_id ON user_sessions (user_id)"
))

# UNIQUE –∏–Ω–¥–µ–∫—Å –¥–ª—è UserSession.auth_token
connection.execute(text(
    "CREATE UNIQUE INDEX IF NOT EXISTS idx_user_session_auth_token ON user_sessions (auth_token)"
))
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- **`IF NOT EXISTS`** —è–≤–Ω–æ —É–∫–∞–∑–∞–Ω –≤ SQL ‚úÖ
- –ï—Å–ª–∏ –∏–Ω–¥–µ–∫—Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí **–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è** ‚úÖ
- –ï—Å–ª–∏ –∏–Ω–¥–µ–∫—Å–∞ –Ω–µ—Ç ‚Üí **—Å–æ–∑–¥–∞–µ—Ç—Å—è** ‚úÖ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û

---

### –≠–¢–ê–ü 3: –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã user_sessions)

**–§–∞–π–ª:** `database.py`, lines 157-174

```python
# –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∞–±–ª–∏—Ü–µ user_sessions
try:
    result = connection.execute(text("PRAGMA table_info(user_sessions)"))
    columns_user_sessions = {row[1] for row in result}

    if columns_user_sessions:
        print("   ‚úì –¢–∞–±–ª–∏—Ü–∞ user_sessions —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
    else:
        print("   ‚ö†Ô∏è  –¢–∞–±–ª–∏—Ü–∞ user_sessions –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ - –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –≤ ensure_tables()")
except Exception as e:
    print(f"   ‚ÑπÔ∏è –¢–∞–±–ª–∏—Ü–∞ user_sessions –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞ (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)")
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- **–¢–û–õ–¨–ö–û –ü–†–û–í–ï–†–ö–ê** - –Ω–µ –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å ‚úÖ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `PRAGMA table_info()` - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è ‚úÖ
- –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚úÖ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û

---

## üö® –ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –¢–∞–±–ª–∏—Ü–∞ user_sessions —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –¥–≤–∞–∂–¥—ã

**–†–µ—à–µ–Ω–∏–µ:**
- `Base.metadata.create_all()` —Å `IF NOT EXISTS` ‚úÖ
- –ò–Ω–¥–µ–∫—Å—ã —Å `IF NOT EXISTS` ‚úÖ
- `PRAGMA table_info()` - —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ, –±–µ–∑–æ–ø–∞—Å–Ω–∞ ‚úÖ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ù–ò–ß–ï–ì–û –ù–ï –õ–û–ú–ê–ï–¢–°–Ø

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ users.auth_token

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –í –ë–î –µ—Å—Ç—å —é–∑–µ—Ä—ã —Å–æ —Å—Ç–∞—Ä—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏ –≤ users.auth_token

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ–ª–µ `users.auth_token` **–ù–ï —É–¥–∞–ª—è–µ—Ç—Å—è** ‚úÖ
- Fallback –ª–æ–≥–∏–∫–∞ –≤ `get_current_user()` ‚úÖ
- `logout()` –ù–ï —Ç—Ä–æ–≥–∞–µ—Ç `users.auth_token` ‚úÖ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –°–¢–ê–†–´–ï –¢–û–ö–ï–ù–´ –ü–†–û–î–û–õ–ñ–ê–Æ–¢ –†–ê–ë–û–¢–ê–¢–¨

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Foreign Key constraint

**–°—Ü–µ–Ω–∞—Ä–∏–π:** user_sessions.user_id —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ users.id

**–†–µ—à–µ–Ω–∏–µ:**
- –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ users ‚úÖ
- Foreign key —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ existing rows ‚úÖ
- SQLAlchemy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç constraints ‚úÖ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ë–ï–ó –ü–†–û–ë–õ–ï–ú

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: UNIQUE constraint –Ω–∞ auth_token

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ß—Ç–æ –µ—Å–ª–∏ –¥–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ø—ã—Ç–∞—é—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é —Å –æ–¥–Ω–∏–º —Ç–æ–∫–µ–Ω–æ–º?

**–†–µ—à–µ–Ω–∏–µ:**
- `secrets.token_urlsafe(32)` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç ~2^256 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ ‚úÖ
- –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫–æ–ª–ª–∏–∑–∏–∏ < 1 –Ω–∞ –∫–≤–∞–¥—Ä–∏–ª–ª–∏–æ–Ω ‚úÖ
- UNIQUE constraint –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç ‚úÖ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò –ù–ï–í–û–ó–ú–û–ñ–ù–û

---

## ‚úÖ –ü–û–õ–ù–´–ô –ß–ï–ö–õ–ò–°–¢ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

| –û–ø–µ—Ä–∞—Ü–∏—è | –ö–æ–º–∞–Ω–¥–∞ | –°—Ç–∞—Ç—É—Å |
|----------|---------|--------|
| –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã user_sessions | `Base.metadata.create_all()` | ‚úÖ IF NOT EXISTS |
| –ò–Ω–¥–µ–∫—Å –ø–æ user_id | `CREATE INDEX IF NOT EXISTS` | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ |
| UNIQUE –∏–Ω–¥–µ–∫—Å –ø–æ auth_token | `CREATE UNIQUE INDEX IF NOT EXISTS` | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –≤ migrate_schema | `PRAGMA table_info()` | ‚úÖ –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ |
| Foreign key –∫ users.id | SQLAlchemy constraint | ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ |
| –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ users.auth_token | –ù–∏–∫–∞–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ | ‚úÖ –ù–µ —Ç—Ä–æ–≥–∞–µ—Ç—Å—è |
| Fallback –ª–æ–≥–∏–∫–∞ | `get_current_user()` | ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç legacy |

---

## üîÑ –ü–û–†–Ø–î–û–ö –í–´–ü–û–õ–ù–ï–ù–ò–Ø –ü–†–ò –°–¢–ê–†–¢–ï

```
1. init_db() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
   ‚îú‚îÄ> ensure_tables()
   ‚îÇ   ‚îú‚îÄ> Base.metadata.create_all()  ‚Üê –°–æ–∑–¥–∞–µ—Ç user_sessions –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚úÖ
   ‚îÇ   ‚îî‚îÄ> CREATE INDEX IF NOT EXISTS  ‚Üê –°–æ–∑–¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç ‚úÖ
   ‚îÇ
   ‚îî‚îÄ> migrate_schema()
       ‚îî‚îÄ> PRAGMA table_info(user_sessions)  ‚Üê –¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç ‚úÖ

2. –ï—Å–ª–∏ user_sessions –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è ‚úÖ
3. –ï—Å–ª–∏ user_sessions —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç ‚úÖ
4. –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ ‚úÖ
```

---

## üìä –°–†–ê–í–ù–ï–ù–ò–ï –°–¢–ê–†–û–ô –ò –ù–û–í–û–ô –ë–î

### –°—Ç–∞—Ä–∞—è –ë–î (–ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π):
```
users:
‚îú‚îÄ id
‚îú‚îÄ phone
‚îú‚îÄ auth_token (–≤—Å–µ —Ç–æ–∫–µ–Ω—ã –∑–¥–µ—Å—å)
‚îú‚îÄ plan
‚îî‚îÄ ...

–ù–µ—Ç —Ç–∞–±–ª–∏—Ü—ã user_sessions
```

### –ù–æ–≤–∞—è –ë–î (–ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏):
```
users:
‚îú‚îÄ id
‚îú‚îÄ phone
‚îú‚îÄ auth_token (LEGACY - –≤—Å–µ —Å—Ç–∞—Ä—ã–µ —Ç–æ–∫–µ–Ω—ã –∑–¥–µ—Å—å) ‚úÖ
‚îú‚îÄ plan
‚îî‚îÄ ...

user_sessions: (–Ω–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞)
‚îú‚îÄ id
‚îú‚îÄ user_id (FK)
‚îú‚îÄ auth_token (–Ω–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã)
‚îú‚îÄ created_at
‚îî‚îÄ last_seen_at

–í—Å–µ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ users.auth_token —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è ‚úÖ
```

---

## üéØ –ö–û–ù–ö–†–ï–¢–ù–´–ï –ü–†–ò–ú–ï–†–´

### –ü—Ä–∏–º–µ—Ä 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª –∑–∞–ª–æ–≥–∏–Ω–µ–Ω –¥–æ –º–∏–≥—Ä–∞—Ü–∏–∏

```
–î–û –º–∏–≥—Ä–∞—Ü–∏–∏:
users[id=42].auth_token = "old_token_xyz123"

–ü–û–°–õ–ï –º–∏–≥—Ä–∞—Ü–∏–∏:
users[id=42].auth_token = "old_token_xyz123" ‚úÖ –¢–ï –ñ–ï –î–ê–ù–ù–´–ï!
user_sessions = {} (–ø—É—Å—Ç–æ - –Ω–µ—Ç –Ω–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π)

–ü—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å cookie auth_token="old_token_xyz123":
get_current_user():
  1. –ò—â–µ—Ç –≤ user_sessions ‚Üí –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
  2. Fallback –Ω–∞ users.auth_token ‚Üí –ù–ê–ô–î–ï–ù–û! ‚úÖ

–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –û–°–¢–ê–ï–¢–°–Ø –ó–ê–õ–û–ì–ò–ù–ï–ù!
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –ª–æ–≥–∏–Ω–∞ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```
–ü–†–û–¶–ï–°–° –õ–û–ì–ò–ù–ê:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
2. –°–∏—Å—Ç–µ–º–∞ –≤—ã–∑—ã–≤–∞–µ—Ç create_user_session(user_id=42, db)
3. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ user_sessions:
   id=1, user_id=42, auth_token="new_token_abc789"
4. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è users[id=42].auth_token = "new_token_abc789"

–†–ï–ó–£–õ–¨–¢–ê–¢:
users[id=42].auth_token = "new_token_abc789"
user_sessions[id=1] = {user_id=42, auth_token="new_token_abc789"}

–ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ —Å —ç—Ç–∏–º —Ç–æ–∫–µ–Ω–æ–º:
get_current_user():
  1. –ò—â–µ—Ç –≤ user_sessions ‚Üí –ù–ê–ô–î–ï–ù–û! ‚úÖ
  2. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç User

–í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ! ‚úÖ
```

### –ü—Ä–∏–º–µ—Ä 3: –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –¥–≤–∞–∂–¥—ã

```
–ü–ï–†–í–´–ô –†–£–ù:
Base.metadata.create_all()
  ‚Üí CREATE TABLE IF NOT EXISTS user_sessions ‚úÖ –¢–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞

–í–¢–û–†–û–ô –†–£–ù:
Base.metadata.create_all()
  ‚Üí CREATE TABLE IF NOT EXISTS user_sessions ‚úÖ –ù–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç (IF NOT EXISTS)

CREATE INDEX IF NOT EXISTS idx_user_session_user_id
  ‚Üí ‚úÖ –ò–Ω–¥–µ–∫—Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (IF NOT EXISTS)

–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –ë–ï–ó –û–®–ò–ë–û–ö!
```

---

## üõ°Ô∏è –§–ò–ù–ê–õ–¨–ù–´–ô –í–´–í–û–î

### –ú–∏–≥—Ä–∞—Ü–∏—è –ü–û–õ–ù–û–°–¢–¨–Æ –ë–ï–ó–û–ü–ê–°–ù–ê –ø–æ—Ç–æ–º—É —á—Ç–æ:

1. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `IF NOT EXISTS` –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π CREATE
2. ‚úÖ –°—Ç–∞—Ä–æ–µ –ø–æ–ª–µ `users.auth_token` **–ù–ò–ö–û–ì–î–ê –ù–ï —É–¥–∞–ª—è–µ—Ç—Å—è**
3. ‚úÖ Fallback –ª–æ–≥–∏–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–µ —Å–∏—Å—Ç–µ–º—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
4. ‚úÖ –ü—Ä–æ—Ü–µ—Å—Å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω - –º–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –º–Ω–æ–≥–æ —Ä–∞–∑ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º
5. ‚úÖ Foreign key constraints –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
6. ‚úÖ –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ
7. ‚úÖ –ù–µ—Ç ALTER TABLE –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–ª–æ–Ω–∫–∞—Ö
8. ‚úÖ –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–º–µ—é—Ç error handling

### –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ production –ë–î:
‚úÖ **–î–ê, –ü–û–õ–ù–û–°–¢–¨–Æ –ë–ï–ó–û–ü–ê–°–ù–û**

### –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑:
‚úÖ **–î–ê, –ò–î–ï–ú–ü–û–¢–ï–ù–¢–ù–û**

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —é–∑–µ—Ä—ã –æ—Å—Ç–∞—é—Ç—Å—è –∑–∞–ª–æ–≥–∏–Ω–µ–Ω—ã:
‚úÖ **–î–ê, –ß–ï–†–ï–ó FALLBACK –õ–û–ì–ò–ö–£**

---

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 2026-02-05
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û –î–õ–Ø PRODUCTION
