var _=Object.defineProperty;var y=(i,t,e)=>t in i?_(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var s=(i,t,e)=>(y(i,typeof t!="symbol"?t+"":t,e),e);import{a as f}from"./browser-polyfill-45feeee0.js";import{g}from"./get-user-config-c40076a6.js";import{R as p,r as c,j as n}from"./jsx-runtime-4286988b.js";import{c as A,a as S,F as E,b as M,s as B,S as I}from"./createLucideIcon-6676f207.js";import{o as U,S as w}from"./settings-00b531d8.js";const L=async()=>await new Promise(t=>{const e=setTimeout(()=>{t("")},1e3);f.runtime.sendMessage({action:"get_prompt"}).then(o=>{clearTimeout(e);const a=(o==null?void 0:o.prompt)??"";t(a)})});/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=A("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=A("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),x=p.memo(({prompt:i,onClick:t})=>{const e=c.useCallback(()=>{t(i)},[i,t]);return n.jsx("button",{type:"button",className:"w-full px-2.5 py-1.5 rounded-md border border-gray-200 cursor-pointer select-none max-w-full bg-gray-50 hover:bg-gray-100",onClick:e,children:n.jsx("span",{className:"text-xs leading-snug line-clamp-3 overflow-hidden break-words text-gray-800 text-left",children:i})})});x.displayName="FollowupButton";const d=p.memo(({onClick:i,title:t,icon:e})=>n.jsx("button",{type:"button",className:"flex items-center justify-center p-1 rounded-full cursor-pointer hover:bg-gray-100 text-gray-500",title:t,onClick:i,children:e}));d.displayName="ActionButton";const R=({followupPrompts:i=[],platform:t="chatgpt"})=>{const e=c.useMemo(()=>i.length===0,[i.length]),[o,a]=c.useState(e),T=c.useCallback(async r=>{a(!0);try{await new C({platform:t}).submitPrompt(r)}catch{return}},[t]),u=c.useCallback(()=>{U()},[]),h=c.useCallback(()=>{a(r=>!r)},[]);return o?n.jsx("button",{type:"button",className:"w-8 h-8 flex items-center justify-center cursor-pointer hover:bg-gray-100 text-gray-500 rounded-full shadow-md outline outline-1 outline-gray-200 bg-white select-none",title:"Expand Quick Follow-up",onClick:h,children:n.jsx(N,{size:16})}):n.jsxs("div",{className:"w-[200px] max-w-[200px] flex flex-col gap-1 p-3 rounded-xl shadow-md outline outline-1 outline-gray-200 bg-white select-none",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("h3",{className:"text-sm font-semibold text-gray-700 m-0",children:"Quick Follow-up"}),n.jsxs("div",{className:"flex items-center gap-0.5",children:[n.jsx(d,{onClick:u,title:"Open settings",icon:n.jsx(w,{size:16})}),n.jsx(d,{onClick:h,title:"Minimize Quick Follow-up",icon:n.jsx(O,{size:16})})]})]}),i.length>0&&n.jsx("div",{className:"flex flex-col gap-2",children:i.map((r,m)=>n.jsx(x,{prompt:r,onClick:T},`${r}-${m}`))})]})},k=(i,t="chatgpt")=>{const e=S("div",E);e.style.position="fixed",e.style.bottom="24px",e.style.right="12px",e.style.zIndex="9999",M({container:e,styles:B}).render(n.jsx(p.StrictMode,{children:n.jsx(I,{children:n.jsx(R,{followupPrompts:i,platform:t})})}))},l={INTERVAL_DURATION:1500,MAX_TRIALS:5,FOLLOWUP_DELAY:2e3,SUBMIT_TIMEOUT:500,FALLBACK_TIMEOUT:500,TEXTAREA_VALUE_TYPE:{chatgpt:"innerHTML",claude:"innerHTML",mistral:"innerHTML",gemini:"innerText",aistudio:"value",grok:"innerHTML"},LOCATION_FILTER:{chatgpt:"",claude:"/new",mistral:"/chat",gemini:"",aistudio:"",grok:""}},b={chatgpt:{TEXTAREA_MAIN:"main form .ProseMirror",TEXTAREA_ALT:"main form textarea:last-child",SUBMIT_BUTTON:"main form button[aria-label='Send prompt']",SUBMIT_BUTTON_ALT:'button[aria-label="Send prompt"]',SUBMIT_BUTTON_ALT_2:'button[data-testid="send-button"]'},claude:{TEXTAREA_MAIN:".ProseMirror",TEXTAREA_ALT:"fieldset div[contenteditable='true']",SUBMIT_BUTTON:"button[aria-label='Send message']",SUBMIT_BUTTON_ALT:"fieldset button[aria-label='Send message']",SUBMIT_BUTTON_ALT_2:"fieldset button[aria-label='Send Message']"},mistral:{TEXTAREA_MAIN:"form div.ProseMirror",TEXTAREA_ALT:"form textarea[name='message.text']",SUBMIT_BUTTON:"form button[aria-label='Send question']",SUBMIT_BUTTON_ALT:"button[aria-label='Send question']",SUBMIT_BUTTON_ALT_2:"form button[type='submit']"},gemini:{TEXTAREA_MAIN:"main rich-textarea div.ql-editor.textarea",TEXTAREA_ALT:"div.ql-editor.textarea",SUBMIT_BUTTON:"main button.send-button[aria-label='Send message']",SUBMIT_BUTTON_ALT:"button.send-button",SUBMIT_BUTTON_ALT_2:"main button[aria-label='Send']"},aistudio:{TEXTAREA_MAIN:"body app-root footer ms-text-chunk textarea",TEXTAREA_ALT:"body app-root footer textarea",SUBMIT_BUTTON:"body app-root footer button[aria-label='Run']",SUBMIT_BUTTON_ALT:"button[aria-label='Run']",SUBMIT_BUTTON_ALT_2:"body app-root footer button[type='submit']"},grok:{TEXTAREA_MAIN:"main form .ProseMirror",TEXTAREA_ALT:"main form div[contenteditable='true']",SUBMIT_BUTTON:"body form button[aria-label='Submit']",SUBMIT_BUTTON_ALT:"button[aria-label='Submit']",SUBMIT_BUTTON_ALT_2:"body form button[type='submit']"}};class C{constructor({enableFollowup:t=!1,platform:e="chatgpt"}){s(this,"intervalId",null);s(this,"trial",0);s(this,"addFollowupContainer");s(this,"platform","chatgpt");s(this,"selectors");this.addFollowupContainer=t,this.platform=e,this.selectors=b[e]||b.chatgpt}async initialize(){this.shouldRunSummarizer()&&this.startPromptCheck()}shouldRunSummarizer(){const t=l.LOCATION_FILTER[this.platform];return t&&!window.location.pathname.includes(t)?!1:window.location.search.includes("glasp")}startPromptCheck(){this.intervalId=setInterval(()=>this.checkCondition(),l.INTERVAL_DURATION)}async checkCondition(){if(this.trial++,this.trial>=l.MAX_TRIALS){this.cleanup();return}try{const t=await L();if(!(t!=null&&t.trim()))return;if(await this.submitPrompt(t),this.cleanup(),this.addFollowupContainer){const e=await g(),o=this.getValidFollowupPrompts(e);if(o.length===0)return;await new Promise(a=>setTimeout(a,l.FOLLOWUP_DELAY)),k(o,this.platform)}}catch{this.cleanup()}}async submitPrompt(t){try{await this.clickSubmitButton(t)}catch{return}}getValidFollowupPrompts(t){return Object.values(t.followupPrompts).filter(e=>e.trim()!=="")}async clickSubmitButton(t,e=l.SUBMIT_TIMEOUT){const o=this.findTextarea();if(!o)throw new Error("Textarea not found");const a=(o==null?void 0:o.tagName.toLowerCase())??"textarea",T=l.TEXTAREA_VALUE_TYPE[this.platform]||"value";T==="innerHTML"?a==="textarea"?o.value=t:o.innerHTML=`<p>${t}</p>`:T==="innerText"?o.innerText=t:o.value=t,o.focus(),o.dispatchEvent(new Event("input",{bubbles:!0})),await this.delay(e);const u=this.findSubmitButton();if(!u)throw new Error("Submit button not found");u.disabled=!1,u.click()}findTextarea(){return document.querySelector(this.selectors.TEXTAREA_MAIN)||document.querySelector(this.selectors.TEXTAREA_ALT)||document.getElementsByTagName("textarea")[0]}findSubmitButton(){const t=document.querySelectorAll(this.selectors.SUBMIT_BUTTON);return t[t.length-1]||document.querySelector(this.selectors.SUBMIT_BUTTON_ALT)||document.querySelector(this.selectors.SUBMIT_BUTTON_ALT_2)}delay(t){return new Promise(e=>setTimeout(e,t))}cleanup(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}}export{C as S};
