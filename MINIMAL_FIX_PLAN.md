## üìê –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ô –ü–õ–ê–ù –ü–†–ê–í–û–ö: –û–¢–î–ï–õ–ò–¢–¨ –õ–û–ì–ò–ù –û–¢ TELEGRAM

**–¶–µ–ª—å:** –õ–æ–≥–∏–Ω –≤–æ–æ–±—â–µ –Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç Telegram API

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2026-02-05
**–ù–∞ –æ—Å–Ω–æ–≤–µ:** ARCHITECTURE_AUDIT_REPORT.md

---

## –ß–ê–°–¢–¨ 1: –í–°–ï –ü–†–û–ë–õ–ï–ú–ù–´–ï –í–´–ó–û–í–´ –õ–û–ì–ò–ù–ê

### –ü—Ä–æ–±–ª–µ–º–∞ #1: auth_start() ‚Üí get_user_client() –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—Ö–æ–¥–µ

**–§–∞–π–ª:** `main.py`
**–§—É–Ω–∫—Ü–∏—è:** `async def auth_start(request: AuthStartRequest)`
**–°—Ç—Ä–æ–∫–∏:** 929-939
**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –í–∞—Ä–∏–∞–Ω—Ç –ê - –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥ (telegram_session –Ω–∞–π–¥–µ–Ω–∞)

**–¢–µ–∫—É—â–∏–π –∫–æ–¥ (–Ω–∞—Ä—É—à–∞–µ—Ç —ç—Ç–∞–ª–æ–Ω):**
```python
# –°—Ç—Ä–æ–∫–∞ 929
client = await get_user_client(user.id, db)
if not client:
    raise Exception("TelegramClient –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω")

# –°—Ç—Ä–æ–∫–∞ 939
message_text = f"üîê –ö–æ–¥ –≤—Ö–æ–¥–∞ –≤ JobRadar: {code}"
await safe_send_message(client, chat_id, message_text)
```

**–ù–∞—Ä—É—à–µ–Ω–∏–µ —ç—Ç–∞–ª–æ–Ω–∞:**
- ‚ùå –í—ã–∑–æ–≤ `get_user_client()` —Å–æ–∑–¥–∞—ë—Ç TelegramClient –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
- ‚ùå `get_user_client()` ‚Üí `StringSession()` ‚Üí –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏–∑ session_string
- ‚ùå `get_user_client()` ‚Üí `await client.connect()` –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Telegram
- ‚ùå `safe_send_message()` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–¥ —á–µ—Ä–µ–∑ Telegram –∫–ª–∏–µ–Ω—Ç–∞
- ‚ùå –õ–æ–≥–∏–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç session_string –∏–∑ –ë–î

**–≠—Ç–∞–ª–æ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç—Ä–µ–±—É–µ—Ç:**
- ‚úÖ –ù–ò–ö–ê–ö–û–ì–û TelegramClient –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
- ‚úÖ –ù–ò–ö–ê–ö–ò–• –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ Telegram
- ‚úÖ –ü—Ä–æ—Å—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –ø–∞–º—è—Ç–∏
- ‚úÖ –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è "—á–µ—Ä–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–µ—Ö–∞–Ω–∏–∑–º —Å–µ—Ä–≤–∏—Å–∞" (–ù–ï Telegram)

---

### –ü—Ä–æ–±–ª–µ–º–∞ #2: login_by_telegram() ‚Üí get_user_client() –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ

**–§–∞–π–ª:** `main.py`
**–§—É–Ω–∫—Ü–∏—è:** `async def login_by_telegram(request: AuthLoginTelegramRequest)`
**–°—Ç—Ä–æ–∫–∏:** 1287-1304
**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—Ö–æ–¥–µ

**–¢–µ–∫—É—â–∏–π –∫–æ–¥ (–Ω–∞—Ä—É—à–∞–µ—Ç —ç—Ç–∞–ª–æ–Ω):**
```python
# –°—Ç—Ä–æ–∫–∞ 1287
client = await get_user_client(user.id, db)

# –°—Ç—Ä–æ–∫–∞ 1290
me = await client.get_me()
first_name_fresh = me.first_name
last_name_fresh = me.last_name
username_fresh = me.username

# –°—Ç—Ä–æ–∫–∏ 1301-1304: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Telegram
telegram_session.telegram_first_name = first_name_fresh
telegram_session.telegram_last_name = last_name_fresh
telegram_session.telegram_username = username_fresh
db.commit()
```

**–ù–∞—Ä—É—à–µ–Ω–∏–µ —ç—Ç–∞–ª–æ–Ω–∞:**
- ‚ùå –í—ã–∑–æ–≤ `get_user_client()` —Å–æ–∑–¥–∞—ë—Ç TelegramClient –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
- ‚ùå `await client.get_me()` –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ Telegram API –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
- ‚ùå –õ–æ–≥–∏–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç session_string –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
- ‚ùå –°–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–∞—é—Ç—Å—è –∏–∑ Telegram, –∞ –Ω–µ –∏–∑ –ë–î

**–≠—Ç–∞–ª–æ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç—Ä–µ–±—É–µ—Ç:**
- ‚úÖ –õ–æ–≥–∏–Ω –ù–ï —Ç—Ä–µ–±—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è TelegramClient
- ‚úÖ –õ–æ–≥–∏–Ω –ù–ï —Ç—Ä–æ–≥–∞–µ—Ç Telegram
- ‚úÖ –î–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ telegram_session (—É–∂–µ –≤ –ë–î)
- ‚úÖ –°–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –¢–û–õ–¨–ö–û –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º

---

## –ß–ê–°–¢–¨ 2: –¢–ê–ë–õ–ò–¶–ê –í–°–ï–• –ù–ê–†–£–®–ï–ù–ò–ô

| ‚Ññ | –§–∞–π–ª | –§—É–Ω–∫—Ü–∏—è | –°—Ç—Ä–æ–∫–∞ | –ù–∞—Ä—É—à–µ–Ω–∏–µ | –≠—Ç–∞–ª–æ–Ω | –î–µ–π—Å—Ç–≤–∏–µ |
|---|------|---------|--------|-----------|--------|----------|
| 1 | main.py | auth_start | 929 | `await get_user_client(user.id, db)` | –ù–ò–ö–ê–ö–ò–• –∫–ª–∏–µ–Ω—Ç–æ–≤ | –£–¥–∞–ª–∏—Ç—å |
| 2 | main.py | auth_start | 939 | `await safe_send_message(client, ...)` | –ö–æ–¥ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å | –ó–∞–º–µ–Ω–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å |
| 3 | main.py | login_by_telegram | 1287 | `await get_user_client(user.id, db)` | –ù–ò–ö–ê–ö–ò–• –∫–ª–∏–µ–Ω—Ç–æ–≤ | –£–¥–∞–ª–∏—Ç—å |
| 4 | main.py | login_by_telegram | 1290 | `me = await client.get_me()` | –î–∞–Ω–Ω—ã–µ –∏–∑ –ë–î | –£–¥–∞–ª–∏—Ç—å |
| 5 | main.py | login_by_telegram | 1301-1304 | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ë–î | –ó–∞–º–µ–Ω–∏—Ç—å |

---

## –ß–ê–°–¢–¨ 3: –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ô –ü–õ–ê–ù –ü–†–ê–í–û–ö

### –ü—Ä–∞–≤–∫–∞ #1: auth_start() - –£–¥–∞–ª–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—Ö–æ–¥–µ

**–§–∞–π–ª:** `main.py`
**–§—É–Ω–∫—Ü–∏—è:** `async def auth_start(request: AuthStartRequest)`
**–î–∏–∞–ø–∞–∑–æ–Ω —Å—Ç—Ä–æ–∫:** 906-958 (–≤–∞—Ä–∏–∞–Ω—Ç –ê - –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥)

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** –ü–†–û–ë–õ–ï–ú–ù–´–ô ‚ùå
```python
if telegram_session:
    # ...–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥...

    client = await get_user_client(user.id, db)  # ‚ùå –°–¢–†–û–ö–ê 929 - –£–î–ê–õ–ò–¢–¨
    if not client:
        raise Exception("TelegramClient –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω")  # ‚ùå –£–î–ê–õ–ò–¢–¨

    # ...
    await safe_send_message(client, chat_id, message_text)  # ‚ùå –°–¢–†–û–ö–ê 939 - –£–î–ê–õ–ò–¢–¨/–ó–ê–ú–ï–ù–ò–¢–¨
```

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. **–ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É 929:** `client = await get_user_client(user.id, db)`
   - ‚úÇÔ∏è **–£–î–ê–õ–ò–¢–¨ —ç—Ç—É —Å—Ç—Ä–æ–∫—É —Ü–µ–ª–∏–∫–æ–º**

2. **–ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫–∏ 930-932:** –ü—Ä–æ–≤–µ—Ä–∫–∞ if not client
   - ‚úÇÔ∏è **–£–î–ê–õ–ò–¢–¨ —ç—Ç–∏ 3 —Å—Ç—Ä–æ–∫–∏ —Ü–µ–ª–∏–∫–æ–º**
   - `if not client:`
   - `    raise Exception("TelegramClient –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω")`

3. **–ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É 939:** `await safe_send_message(client, chat_id, message_text)`
   - ‚úÇÔ∏è **–£–î–ê–õ–ò–¢–¨ —ç—Ç—É —Å—Ç—Ä–æ–∫—É —Ü–µ–ª–∏–∫–æ–º**
   - ‚ùì **–í–û–ü–†–û–°:** –ö–∞–∫ –≤–æ–æ–±—â–µ –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∫–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—Ö–æ–¥–µ?
     - –í–∞—Ä–∏–∞–Ω—Ç –ê: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ email (–µ—Å–ª–∏ –µ—Å—Ç—å –≤ –ø—Ä–æ—Ñ–∏–ª–µ)
     - –í–∞—Ä–∏–∞–Ω—Ç –ë: –û—Ç–ø—Ä–∞–≤–∏—Ç—å SMS (—Å–æ–∑–¥–∞—Ç—å –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç –∫–∞–∫ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
     - –í–∞—Ä–∏–∞–Ω—Ç –í: –ö–æ–¥ –ø—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ (pending_login_codes), –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –µ–≥–æ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ
     - **–¢–ï–ö–£–©–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø –ù–ï–Ø–°–ù–ê** - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Telegram –õ–°, –Ω–æ —ç—Ç–æ —Ç—Ä–æ–≥–∞–µ—Ç Telegram

4. **–°—Ç—Ä–æ–∫–∞ 941 (–ª–æ–≥):** `logger.info(f"‚úÖ [AUTH_START]...")`
   - ‚úÖ **–û–°–¢–ê–í–ò–¢–¨** (–ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)

5. **–°—Ç—Ä–æ–∫–∞ 943-945 (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–¥–∞):**
   ```python
   pending_login_codes[phone] = {
       "code": code,
       "user_id": user.id,
       "expires_at": datetime.utcnow() + timedelta(seconds=300)
   }
   ```
   - ‚úÖ **–û–°–¢–ê–í–ò–¢–¨** (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏ - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ)

6. **–°—Ç—Ä–æ–∫–∞ 948 (–≤–æ–∑–≤—Ä–∞—Ç):**
   ```python
   return {
       "ok": True,
       "login_via": "telegram_message"
   }
   ```
   - ‚ùì **–ü–ï–†–ï–°–ú–û–¢–†–ï–¢–¨:** –ï—Å–ª–∏ –∫–æ–¥ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Telegram, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å?
     - –ú–æ–∂–µ—Ç –±—ã—Ç—å, `"login_via": "code_input"` –∏–ª–∏ `"login_via": "pending_code"`?

**–ò–¢–û–ì–û –ø–æ –ü—Ä–∞–≤–∫–µ #1:**
```
–£–î–ê–õ–ò–¢–¨:
  - –°—Ç—Ä–æ–∫–∞ 929: client = await get_user_client(user.id, db)
  - –°—Ç—Ä–æ–∫–∏ 930-932: if not client: raise Exception(...)
  - –°—Ç—Ä–æ–∫–∞ 939: await safe_send_message(...)

–û–°–¢–ê–í–ò–¢–¨:
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–æ–¥–∞
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ pending_login_codes
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
  - –í–æ–∑–≤—Ä–∞—Ç –æ—Ç–≤–µ—Ç–∞ (–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å login_via)

–ù–ï–Ø–°–ù–û:
  - –ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (—Ç–µ–∫—É—â–µ–µ: "—á–µ—Ä–µ–∑ Telegram", –Ω—É–∂–Ω–æ: "—á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω–∏–∑–º —Å–µ—Ä–≤–∏—Å–∞")
  - –ù—É–∂–Ω–æ –ª–∏ –≤–æ–æ–±—â–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–¥ –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å—Ç–æ –≤–≤–æ–¥–∏—Ç –≤ —Ñ–æ—Ä–º–µ?
```

---

### –ü—Ä–∞–≤–∫–∞ #2: login_by_telegram() - –£–¥–∞–ª–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞

**–§–∞–π–ª:** `main.py`
**–§—É–Ω–∫—Ü–∏—è:** `async def login_by_telegram(request: AuthLoginTelegramRequest)`
**–î–∏–∞–ø–∞–∑–æ–Ω —Å—Ç—Ä–æ–∫:** 1218-1351

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** –ü–†–û–ë–õ–ï–ú–ù–´–ô ‚ùå
```python
async def login_by_telegram(request: AuthLoginTelegramRequest):
    # ... –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ ...

    telegram_session = db.query(TelegramSession).filter(...).first()  # ‚úÖ –ù–û–†–ú–ê–õ–¨–ù–û

    # ‚ùå –ü–†–û–ë–õ–ï–ú–ê –ù–ê–ß–ò–ù–ê–ï–¢–°–Ø –ó–î–ï–°–¨:
    client = await get_user_client(user.id, db)  # ‚ùå –°–¢–†–û–ö–ê 1287 - –£–î–ê–õ–ò–¢–¨
    if client:
        me = await client.get_me()  # ‚ùå –°–¢–†–û–ö–ê 1290 - –£–î–ê–õ–ò–¢–¨
        first_name_fresh = me.first_name  # ‚ùå –£–î–ê–õ–ò–¢–¨
        last_name_fresh = me.last_name  # ‚ùå –£–î–ê–õ–ò–¢–¨
        username_fresh = me.username  # ‚ùå –£–î–ê–õ–ò–¢–¨

        telegram_session.telegram_first_name = first_name_fresh  # ‚ùå –°–¢–†–û–ö–ê 1301 - –ü–ï–†–ï–ü–ò–°–ê–¢–¨
        telegram_session.telegram_last_name = last_name_fresh  # ‚ùå –°–¢–†–û–ö–ê 1302 - –ü–ï–†–ï–ü–ò–°–ê–¢–¨
        telegram_session.telegram_username = username_fresh  # ‚ùå –°–¢–†–û–ö–ê 1303 - –ü–ï–†–ï–ü–ò–°–ê–¢–¨
        db.commit()
```

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. **–ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É 1287:** `client = await get_user_client(user.id, db)`
   - ‚úÇÔ∏è **–£–î–ê–õ–ò–¢–¨ —ç—Ç—É —Å—Ç—Ä–æ–∫—É —Ü–µ–ª–∏–∫–æ–º**

2. **–ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É 1288:** `if client:`
   - ‚úÇÔ∏è **–£–î–ê–õ–ò–¢–¨ —ç—Ç—É —Å—Ç—Ä–æ–∫—É —Ü–µ–ª–∏–∫–æ–º**

3. **–ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É 1290:** `me = await client.get_me()`
   - ‚úÇÔ∏è **–£–î–ê–õ–ò–¢–¨ —ç—Ç—É —Å—Ç—Ä–æ–∫—É —Ü–µ–ª–∏–∫–æ–º**

4. **–ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫–∏ 1291-1293:**
   ```python
   first_name_fresh = me.first_name
   last_name_fresh = me.last_name
   username_fresh = me.username
   ```
   - ‚úÇÔ∏è **–£–î–ê–õ–ò–¢–¨ —ç—Ç–∏ 3 —Å—Ç—Ä–æ–∫–∏ —Ü–µ–ª–∏–∫–æ–º**

5. **–ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫–∏ 1301-1304:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö
   ```python
   telegram_session.telegram_first_name = first_name_fresh
   telegram_session.telegram_last_name = last_name_fresh
   telegram_session.telegram_username = username_fresh
   db.commit()
   ```
   - ‚úÇÔ∏è **–£–î–ê–õ–ò–¢–¨ —ç—Ç–∏ 4 —Å—Ç—Ä–æ–∫–∏ —Ü–µ–ª–∏–∫–æ–º**
   - ‚ùì **–í–û–ü–†–û–°:** –ù—É–∂–Ω–æ –ª–∏ –≤–æ–æ–±—â–µ –æ–±–Ω–æ–≤–ª—è—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ?
     - –ü–æ —ç—Ç–∞–ª–æ–Ω—É: –ù–ï–¢, –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –¢–û–õ–¨–ö–û –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
     - –¢–µ–∫—É—â–µ–µ: –î–ê, –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—Ö–æ–¥–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ

6. **–ß—Ç–æ –û–°–¢–ê–í–ò–¢–¨ –≤ —Ñ—É–Ω–∫—Ü–∏–∏:**
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ code –∏–∑ pending_login_codes
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ TTL –∫–æ–¥–∞
   - ‚úÖ SELECT user –∏ telegram_session –∏–∑ –ë–î
   - ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è auth_token
   - ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ cookie
   - ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   - ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –æ—Ç–≤–µ—Ç–∞

**–ò–¢–û–ì–û –ø–æ –ü—Ä–∞–≤–∫–µ #2:**
```
–£–î–ê–õ–ò–¢–¨:
  - –°—Ç—Ä–æ–∫–∞ 1287: client = await get_user_client(user.id, db)
  - –°—Ç—Ä–æ–∫–∞ 1288: if client:
  - –°—Ç—Ä–æ–∫–∞ 1290: me = await client.get_me()
  - –°—Ç—Ä–æ–∫–∏ 1291-1293: first_name_fresh, last_name_fresh, username_fresh
  - –°—Ç—Ä–æ–∫–∏ 1301-1304: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –ë–î (–∏ db.commit())

–û–°–¢–ê–í–ò–¢–¨:
  - –ü—Ä–æ–≤–µ—Ä–∫—É –∫–æ–¥–∞ –∏–∑ pending_login_codes
  - –ü—Ä–æ–≤–µ—Ä–∫—É TTL
  - SELECT –∏–∑ –ë–î
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—é auth_token
  - –£—Å—Ç–∞–Ω–æ–≤–∫—É cookie
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–ï–†–ï–ü–†–û–í–ï–†–ò–¢–¨:
  - –ù—É–∂–Ω–æ –ª–∏ –≤–æ–æ–±—â–µ –æ–±–Ω–æ–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ?
  - –ï—Å–ª–∏ –î–ê, –∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞—Ç—å –±–µ–∑ Telegram?
```

---

## –ß–ê–°–¢–¨ 4: –¢–ê–ë–õ–ò–¶–ê –¢–û–ß–ù–´–• –ò–ó–ú–ï–ù–ï–ù–ò–ô

| –û–ø–µ—Ä–∞—Ü–∏—è | –§–∞–π–ª | –°—Ç—Ä–æ–∫–∞(–∏) | –¢–µ–∫—É—â–∏–π –∫–æ–¥ | –î–µ–π—Å—Ç–≤–∏–µ | –ù–æ–≤—ã–π –∫–æ–¥ |
|----------|------|-----------|-------------|----------|-----------|
| 1 | main.py | 929 | `client = await get_user_client(...)` | –£–î–ê–õ–ò–¢–¨ | ‚Äî |
| 2 | main.py | 930-932 | `if not client: raise Exception(...)` | –£–î–ê–õ–ò–¢–¨ | ‚Äî |
| 3 | main.py | 939 | `await safe_send_message(client, ...)` | –£–î–ê–õ–ò–¢–¨ | ‚Äî |
| 4 | main.py | 1287 | `client = await get_user_client(...)` | –£–î–ê–õ–ò–¢–¨ | ‚Äî |
| 5 | main.py | 1288 | `if client:` | –£–î–ê–õ–ò–¢–¨ | ‚Äî |
| 6 | main.py | 1290 | `me = await client.get_me()` | –£–î–ê–õ–ò–¢–¨ | ‚Äî |
| 7 | main.py | 1291-1293 | –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è fresh –¥–∞–Ω–Ω—ã—Ö | –£–î–ê–õ–ò–¢–¨ | ‚Äî |
| 8 | main.py | 1301-1304 | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –ë–î | –£–î–ê–õ–ò–¢–¨ | ‚Äî |

---

## –ß–ê–°–¢–¨ 5: –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –í–û–ü–†–û–°–´ –î–õ–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –í–æ–ø—Ä–æ—Å 1: –ö–∞–∫ –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∫–æ–¥ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—Ö–æ–¥–µ?

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –ß–µ—Ä–µ–∑ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π TelegramClient –≤ –ª–∏—á–Ω—ã–π Telegram ‚ùå

**–ü–æ —ç—Ç–∞–ª–æ–Ω—É:** –ß–µ—Ä–µ–∑ "—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–µ—Ö–∞–Ω–∏–∑–º –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Å–µ—Ä–≤–∏—Å–∞" ‚úÖ

**–í–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**
- **–í–∞—Ä–∏–∞–Ω—Ç –ê:** Email (–µ—Å–ª–∏ email –µ—Å—Ç—å –≤ –ø—Ä–æ—Ñ–∏–ª–µ)
- **–í–∞—Ä–∏–∞–Ω—Ç –ë:** SMS (—Å–æ–∑–¥–∞—Ç—å –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç –∫–∞–∫ –¥–ª—è –Ω–æ–≤—ã—Ö, –≤–∞—Ä–∏–∞–Ω—Ç –ë)
- **–í–∞—Ä–∏–∞–Ω—Ç –í:** –ö–æ–¥ –≤ –ø–∞–º—è—Ç–∏ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ, –±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏)
- **–í–∞—Ä–∏–∞–Ω—Ç –ì:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (push, web notification)

**–¢–µ–∫—É—â–∏–π –∫–æ–¥ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç:** –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram –õ–° (–Ω–æ —ç—Ç–æ –¢–†–û–ì–ê–ï–¢ Telegram)

**–ù–£–ñ–ù–û –£–¢–û–ß–ù–ò–¢–¨ –£ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø**

---

### –í–æ–ø—Ä–æ—Å 2: –ù—É–∂–Ω–æ –ª–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å telegram_first_name, telegram_last_name, telegram_username –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ?

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –î–ê, –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `await client.get_me()` ‚ùå

**–ü–æ —ç—Ç–∞–ª–æ–Ω—É:** –ù–ï–¢, –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –¢–û–õ–¨–ö–û –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º ‚úÖ

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º –ª–æ–≥–∏–Ω–µ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ª–∏—à–Ω–∏–π –∑–∞–ø—Ä–æ—Å –∫ Telegram
- –õ–æ–≥–∏–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–∑–∞–≤–∏—Å–∏–º –æ—Ç Telegram
- –î–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ —á–µ—Ä–µ–∑ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–†–ï–®–ï–ù–ò–ï:** –£–¥–∞–ª–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ, –¥–æ–≤–µ—Ä—è—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É

---

### –í–æ–ø—Ä–æ—Å 3: –ù—É–∂–Ω–æ –ª–∏ –≤–æ–æ–±—â–µ —Ç—Ä–æ–≥–∞—Ç—å telegram_session –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ?

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –î–ê, –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ ‚ùå

**–ü–æ —ç—Ç–∞–ª–æ–Ω—É:** –¢–û–õ–¨–ö–û –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è ‚úÖ

**–†–ï–®–ï–ù–ò–ï:** –õ–æ–≥–∏–Ω –ù–ï –¥–æ–ª–∂–µ–Ω –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å telegram_session

---

## –ß–ê–°–¢–¨ 6: –û–ñ–ò–î–ê–ï–ú–´–ô –§–ò–ù–ê–õ–¨–ù–´–ô –ü–ê–ô–ü–õ–ê–ô–ù

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–ø–µ—Ä–≤—ã–π –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ SMS)

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí POST /api/auth/start (phone)
                     ‚Üì
                TelegramSession –≤ –ë–î –ù–ï –Ω–∞–π–¥–µ–Ω–∞
                     ‚Üì
                –í–∞—Ä–∏–∞–Ω—Ç –ë: SMS –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
                     ‚Üì
                TelegramClient(StringSession(), api_id, api_hash) ‚úÖ
                await client.connect() ‚úÖ
                await client.send_code_request(phone) ‚úÖ
                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ pending_auth_clients[auth_id] ‚úÖ
                     ‚Üì
                –í–µ—Ä–Ω—É—Ç—å: {"auth_id": "...", "login_via": "telegram_sms"}
                     ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí POST /api/auth/submit-code (auth_id, code)
                     ‚Üì
                –ü–æ–ª—É—á–∏—Ç—å client –∏–∑ pending_auth_clients[auth_id] ‚úÖ
                await client.sign_in(phone, code) ‚úÖ
                     ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí POST /api/auth/submit-password (auth_id, password) [–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ]
                     ‚Üì
                await client.sign_in(password=password) ‚úÖ
                     ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí POST /api/auth/save (auth_id)
                     ‚Üì
                session_string = client.session.save() ‚úÖ
                await save_session_to_db(phone, session_string, ...) ‚úÖ
                INSERT –≤ telegram_sessions ‚úÖ
                INSERT –≤ users
                –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å auth_token ‚úÖ
                     ‚Üì
                –í–µ—Ä–Ω—É—Ç—å: {"auth_token": "..."}
                Set-Cookie: auth_token ‚úÖ
```

‚úÖ **–õ–û–ì–ò–ù –ù–ï –¢–†–û–ì–ê–ï–¢ TELEGRAM** (—Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–∞–ø–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏)
‚úÖ **session_string —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î** (–¥–ª—è –±—É–¥—É—â–µ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)
‚úÖ **TelegramSession —Å–æ–∑–¥–∞–µ—Ç—Å—è –û–î–ò–ù –†–ê–ó**

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–≤—Ö–æ–¥ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí POST /api/auth/start (phone)
                     ‚Üì
                SELECT TelegramSession WHERE phone ‚úÖ
                     ‚Üì
                TelegramSession –ù–ê–ô–î–ï–ù–ê
                     ‚Üì
                –í–∞—Ä–∏–∞–Ω—Ç –ê: –ö–æ–¥ –≤ –ø–∞–º—è—Ç–∏
                     ‚Üì
                –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å 5-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ ‚úÖ
                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ pending_login_codes[phone] = {code, user_id, expires_at} ‚úÖ
                     ‚Üì
                ‚ùì –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:
                   - –í–∞—Ä–∏–∞–Ω—Ç: Email
                   - –í–∞—Ä–∏–∞–Ω—Ç: SMS (–Ω–æ–≤—ã–π –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç? –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –≤ –ø–∞–º—è—Ç–∏?)
                   - –í–∞—Ä–∏–∞–Ω—Ç: –ö–æ–¥ –≤–∏–¥–µ–Ω –≤ –ø–∞–º—è—Ç–∏/–ª–æ–≥–∞—Ö (–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è)
                     ‚Üì
                –í–µ—Ä–Ω—É—Ç—å: {"ok": True, "login_via": "code_input"} –∏–ª–∏ "telegram_sms"?
                     ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí POST /api/auth/login-by-telegram (phone, code)
                     ‚Üì
                SELECT –∏–∑ pending_login_codes[phone] ‚úÖ
                –ü—Ä–æ–≤–µ—Ä–∏—Ç—å code ‚úÖ
                –ü—Ä–æ–≤–µ—Ä–∏—Ç—å TTL (< 300 —Å–µ–∫) ‚úÖ
                DELETE –∏–∑ pending_login_codes[phone] ‚úÖ
                     ‚Üì
                SELECT User WHERE phone
                SELECT TelegramSession WHERE user_id ‚úÖ
                     ‚Üì
                –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å auth_token ‚úÖ
                     ‚Üì
                –í–µ—Ä–Ω—É—Ç—å: {"auth_token": "..."}
                Set-Cookie: auth_token ‚úÖ
```

‚úÖ **–ù–ò–ö–ê–ö–û–ì–û TelegramClient –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ** ‚ùå (–±—ã–ª –≤—ã–∑–æ–≤ get_user_client)
‚úÖ **–ù–ò–ö–ê–ö–ò–• –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ Telegram** ‚ùå (–±—ã–ª await client.connect)
‚úÖ **–ù–ò–ö–ê–ö–ò–• –≤—ã–∑–æ–≤–æ–≤ Telegram API** ‚ùå (–±—ã–ª await client.get_me)
‚úÖ **–ù–ò–ö–ê–ö–ò–• safe_send_message** ‚ùå (–æ—Ç–ø—Ä–∞–≤–ª—è–ª–∞ –∫–æ–¥ –≤ Telegram)
‚úÖ **session_string –ù–ï –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è** ‚úÖ (–±—ã–ª–∞ –≤ get_user_client)

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–æ—Ç–ø—Ä–∞–≤–∫–∞ –ª–∏–¥–æ–≤)

```
–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞:
  ‚Üì
  –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ Tasks –∏–∑ –ë–î
  –î–ª—è –∫–∞–∂–¥–æ–≥–æ task.user_id:
    ‚Üì
    await get_user_client(user_id, db) ‚úÖ [–ï–î–ò–ù–°–¢–í–ï–ù–ù–û–ï –ú–ï–°–¢–û]
      ‚îú‚îÄ SELECT TelegramSession WHERE user_id
      ‚îú‚îÄ session_string = StringSession(telegram_session.session_string) ‚úÖ
      ‚îú‚îÄ TelegramClient(session_string, ...) ‚úÖ
      ‚îú‚îÄ await client.connect() ‚úÖ
      ‚îî‚îÄ –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å –≤ telegram_clients_cache[user_id]
    ‚Üì
    –ó–∞–ø—É—Å—Ç–∏—Ç—å monitoring_loop_tasks()

–í –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ:
  ‚Üì
  process_task_for_leads(task)
    ‚îú‚îÄ check_source_for_task_leads(task, source)
    ‚îÇ  ‚îú‚îÄ await get_user_client(task.user_id, db) ‚úÖ
    ‚îÇ  ‚îú‚îÄ await client.get_entity("@source_username")
    ‚îÇ  ‚îú‚îÄ await client.get_messages(entity, ...)
    ‚îÇ  ‚îî‚îÄ –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: create_lead()
    ‚îî‚îÄ send_lead_to_telegram(task, lead)
       ‚îú‚îÄ await get_user_client(task.user_id, db) ‚úÖ
       ‚îú‚îÄ SELECT TelegramSession (–¥–ª—è telegram_user_id)
       ‚îî‚îÄ await safe_send_message(client, telegram_user_id, text) ‚úÖ
```

‚úÖ **get_user_client –¢–û–õ–¨–ö–û –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ** (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
‚úÖ **session_string –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ** (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
‚úÖ **safe_send_message –¢–û–õ–¨–ö–û –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ** (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)

---

## –ß–ê–°–¢–¨ 7: –ö–†–ê–¢–ö–ê–Ø –°–í–û–î–ö–ê –ò–ó–ú–ï–ù–ï–ù–ò–ô

| –ß—Ç–æ –±—ã–ª–æ | –ß—Ç–æ —É–¥–∞–ª—è—Ç—å | –ó–∞—á–µ–º |
|----------|-------------|-------|
| **auth_start()** | | |
| ‚Äî `await get_user_client()` –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—Ö–æ–¥–µ | –°—Ç—Ä–æ–∫–∞ 929 | –õ–æ–≥–∏–Ω –ù–ï –¥–æ–ª–∂–µ–Ω —Ç—Ä–æ–≥–∞—Ç—å Telegram |
| ‚Äî `await safe_send_message()` –≤ Telegram | –°—Ç—Ä–æ–∫–∞ 939 | –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å, –Ω–µ Telegram |
| ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ if not client | –°—Ç—Ä–æ–∫–∏ 930-932 | –õ–æ–≥–∏–∫–∞ –Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞ –±–µ–∑ –∫–ª–∏–µ–Ω—Ç–∞ |
| **login_by_telegram()** | | |
| ‚Äî `await get_user_client()` –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ | –°—Ç—Ä–æ–∫–∞ 1287 | –õ–æ–≥–∏–Ω –ù–ï –¥–æ–ª–∂–µ–Ω –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç |
| ‚Äî `await client.get_me()` | –°—Ç—Ä–æ–∫–∞ 1290 | –õ–æ–≥–∏–Ω –ù–ï –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å Telegram |
| ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ fresh –¥–∞–Ω–Ω—ã—Ö –∏–∑ Telegram | –°—Ç—Ä–æ–∫–∏ 1291-1293 | –î–∞–Ω–Ω—ã–µ —É–∂–µ –µ—Å—Ç—å –≤ telegram_session |
| ‚Äî –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ telegram_session –¥–∞–Ω–Ω—ã—Ö | –°—Ç—Ä–æ–∫–∏ 1301-1304 | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –Ω–µ –ª–æ–≥–∏–Ω |
| **–û—Å—Ç–∞—ë—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º** | | |
| ‚úÖ auth_start() –≤–∞—Ä–∏–∞–Ω—Ç –ë (SMS) | ‚Äî | –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –Ω–æ–≤—ã—Ö |
| ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ pending_login_codes | ‚Äî | –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–¥–æ–≤ |
| ‚úÖ send_lead_to_telegram() | ‚Äî | –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ |
| ‚úÖ check_source_for_task_leads() | ‚Äî | –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ |

---

## –†–ï–ó–Æ–ú–ï

**–í—Å–µ–≥–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤:** 8 –æ–ø–µ—Ä–∞—Ü–∏–π
**–í—Å–µ–≥–æ –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å:** ~15 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã:**
1. `auth_start:929` ‚Äî get_user_client()
2. `auth_start:930-932` ‚Äî if not client (–ø—Ä–æ–≤–µ—Ä–∫–∞)
3. `auth_start:939` ‚Äî safe_send_message()
4. `login_by_telegram:1287` ‚Äî get_user_client()
5. `login_by_telegram:1288` ‚Äî if client (–ø—Ä–æ–≤–µ—Ä–∫–∞)
6. `login_by_telegram:1290` ‚Äî client.get_me()
7. `login_by_telegram:1291-1293` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö
8. `login_by_telegram:1301-1304` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –ë–î

**–ü–æ—Å–ª–µ –ø—Ä–∞–≤–æ–∫:**
- ‚úÖ –õ–æ–≥–∏–Ω –í–û–û–ë–©–ï –ù–ï —Ç—Ä–æ–≥–∞–µ—Ç Telegram API
- ‚úÖ session_string –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¢–û–õ–¨–ö–û –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ get_user_client() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ safe_send_message() –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¢–û–õ–¨–ö–û –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª–∏–¥–æ–≤
- ‚úÖ TelegramSession ‚Äî —Ç–æ–ª—å–∫–æ —Ñ–ª–∞–≥ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å—Ç–∞–Ω–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —ç—Ç–∞–ª–æ–Ω—É –Ω–∞ 100%** ‚úÖ
