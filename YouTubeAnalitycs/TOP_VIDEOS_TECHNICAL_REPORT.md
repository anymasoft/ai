# –î–ï–¢–ê–õ–¨–ù–´–ô –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ô –û–¢–ß–Å–¢: Top Videos –≤ YouTubeAnalitycs

**–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞:** 2025-12-10
**–í–µ—Ä—Å–∏—è:** 1.0
**–Ø–∑—ã–∫:** –†—É—Å—Å–∫–∏–π
**–°—Ç–∞—Ç—É—Å:** –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑

---

## 1. –°–¢–†–£–ö–¢–£–†–ê –°–¢–†–ê–ù–ò–¶–´ –ö–ê–ù–ê–õ–ê

### –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞: `src/app/(dashboard)/channel/[id]/page.tsx`

**–ü–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:**

1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ NextAuth
2. –ü–æ–ª—É—á–µ–Ω–∏–µ competitorId –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
3. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `competitors`
4. –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `channel_videos` (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ viewCount DESC)
5. –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è `user_channel_state` (—Ñ–ª–∞–≥–∏ hasSyncedTopVideos, hasShownVideos)
6. –ï—Å–ª–∏ –∑–∞–ø–∏—Å–∏ –Ω–µ—Ç ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ (0, 0)
7. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ñ–ª–∞–≥–æ–≤ –∏–∑ INTEGER –≤ boolean

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSX:**
```
<Container>
  ‚îú‚îÄ Back button
  ‚îú‚îÄ Channel Header (Avatar, Title, Handle, YouTube link)
  ‚îú‚îÄ Sync buttons (SyncAllDataButton, SyncMetricsButton, SyncVideosButton, SyncCommentsButton)
  ‚îú‚îÄ Metrics (Subscribers, Videos, Views, Last Updated)
  ‚îú‚îÄ Separator
  ‚îú‚îÄ Overview (3 cards: Subscribers, Total Views, Avg Views)
  ‚îú‚îÄ SWOTAnalysisBlock
  ‚îî‚îÄ ChannelAnalytics (–û–±–µ—Ä—Ç–∫–∞ —Å–æ —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–º–∏ —Å–µ–∫—Ü–∏—è–º–∏)
      ‚îú‚îÄ Growth Over Time
      ‚îú‚îÄ Top Videos ‚Üê –ù–ê–® –†–ê–ó–î–ï–õ
      ‚îÇ   ‚îî‚îÄ TopVideosGrid (–≤–∏–¥–µ–æ –≤ —Å–µ—Ç–∫–µ)
      ‚îú‚îÄ Content Intelligence
      ‚îú‚îÄ Momentum Insights
      ‚îú‚îÄ Audience & Engagement
      ‚îú‚îÄ Comment Intelligence
      ‚îî‚îÄ Deep Comment Analysis
```

**Props –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –≤ TopVideosGrid:**
- `videos` - –í—Å–µ –≤–∏–¥–µ–æ –∏–∑ –ë–î
- `userPlan` - –ü–ª–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ('free' | 'basic' | 'professional' | 'enterprise')
- `hasSyncedTopVideos` - boolean –∏–∑ user_channel_state
- `hasShownVideos` - boolean –∏–∑ user_channel_state
- `channelId` - ID –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞ –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤

---

## 2. –ü–û–õ–ù–ê–Ø –ö–ê–†–¢–ê UI –≠–õ–ï–ú–ï–ù–¢–û–í TOP VIDEOS

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

#### TopVideosGrid.tsx
- **–ü—É—Ç—å:** `/src/components/channel/TopVideosGrid.tsx`
- **–¢–∏–ø:** Client –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (use client)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–µ—Ç–∫–∞ –≤–∏–¥–µ–æ –≤ 2-4 —Å—Ç–æ–ª–±—Ü–∞

**–õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
```typescript
const [videoList, setVideoList] = useState(videos);
const [showingVideos, setShowingVideos] = useState(false);
const [page, setPage] = useState(0);
const [hasMore, setHasMore] = useState(true);
const [isLoadingMore, setIsLoadingMore] = useState(false);
const [totalVideos, setTotalVideos] = useState(videos.length);
const [refreshingId, setRefreshingId] = useState<string | null>(null);
```

#### TopVideosTable.tsx
- **–ü—É—Ç—å:** `/src/components/channel/TopVideosTable.tsx`
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ç–∞–±–ª–∏—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ

### –û–±–µ—Ä—Ç–∫–∞ —Å —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å—é

#### ChannelAnalytics.tsx
- **–ü—É—Ç—å:** `/src/components/channel/ChannelAnalytics.tsx`
- –£–ø—Ä–∞–≤–ª—è–µ—Ç –≤–∏–¥–∏–º–æ—Å—Ç—å—é –≤—Å–µ—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–µ–∫—Ü–∏–π
- –í—Å–µ —Å–µ–∫—Ü–∏–∏ –∑–∞–∫—Ä—ã—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –ö–ª–∏–∫ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –≤–∏–¥–∏–º–æ—Å—Ç—å

### –ö–Ω–æ–ø–∫–∏ –∏ UI —ç–ª–µ–º–µ–Ω—Ç—ã

#### 1) "Sync Top Videos" (–≤ header)
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** `SyncVideosButton.tsx`
- **API:** POST `/api/channel/{id}/videos/sync`
- **–î–µ–π—Å—Ç–≤–∏–µ:** –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–∏–¥–µ–æ –∏–∑ YouTube / –∫–µ—à–∞
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** `hasSyncedTopVideos = 1` –≤ user_channel_state

#### 2) "–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ø-–≤–∏–¥–µ–æ" (–≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏ B)
- **–£—Å–ª–æ–≤–∏–µ –ø–æ–∫–∞–∑–∞:** `hasSyncedTopVideos === true AND hasShownVideos === false`
- **API:** POST `/api/channel/{id}/videos/show`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** `hasShownVideos = 1` –≤ user_channel_state

#### 3) "–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë 12" (–≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏ D)
- **–£—Å–ª–æ–≤–∏–µ –ø–æ–∫–∞–∑–∞:** `hasShownVideos && canLoadMore(userPlan) && hasMore`
- **API:** GET `/api/channel/{id}/videos/page?page=N`
- **–î–µ–π—Å—Ç–≤–∏–µ:** –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ 12 –≤–∏–¥–µ–æ

#### 4) ‚ü≥ (–û–±–Ω–æ–≤–∏—Ç—å –¥–∞—Ç—É)
- **–£—Å–ª–æ–≤–∏–µ –ø–æ–∫–∞–∑–∞:** –ï—Å–ª–∏ `publishDate === null`
- **API:** POST `/api/video/{videoId}/refresh-date`
- **–î–µ–π—Å—Ç–≤–∏–µ:** –ü—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–∞—Ç—É –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤–∏–¥–µ–æ

---

## 3. –ü–û–õ–ù–ê–Ø –ö–ê–†–¢–ê API

### POST /api/channel/{id}/videos/sync

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–µ—à–∞ (24 —á–∞—Å–∞)
2. –ï—Å–ª–∏ –∫–µ—à —Å–≤–µ–∂–∏–π ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ
3. –ï—Å–ª–∏ –∫–µ—à —Å—Ç–∞—Ä—ã–π ‚Üí –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —É ScrapeCreators API
4. –ü–æ–ª—É—á–∞–µ—Ç publishDate —Å retry (3 –ø–æ–ø—ã—Ç–∫–∏: 200ms, 400ms, 800ms)
5. –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ç–∞—Ä–∏—Ñ–Ω—ã–µ –ª–∏–º–∏—Ç—ã (12/12/60/150)
6. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `channel_videos` —Ç–∞–±–ª–∏—Ü—É (INSERT –∏–ª–∏ UPDATE)
7. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∫–µ—à (channels_cache, channel_videos_cache)
8. –û–±–Ω–æ–≤–ª—è–µ—Ç `user_channel_state`: `hasSyncedTopVideos = 1`

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "ok",
  "videos": [],
  "totalVideos": 30,
  "added": 5,
  "updated": 25,
  "plan": "professional",
  "videoLimit": 60,
  "fromCache": false
}
```

### POST /api/channel/{id}/videos/show

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–∞–µ—Ç channelId –∏–∑ —Ç–∞–±–ª–∏—Ü—ã competitors
2. –û–±–Ω–æ–≤–ª—è–µ—Ç `user_channel_state`: `hasShownVideos = 1, lastShownAt = Date.now()`

**–û—Ç–≤–µ—Ç:**
```json
{
  "ok": true,
  "message": "Videos shown successfully"
}
```

### GET /api/channel/{id}/videos/page?page=N

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä page –∏–∑ query string
2. –í—ã—á–∏—Å–ª—è–µ—Ç offset = page * VIDEO_PAGE_SIZE (12)
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ offset < maxVideos (—Ç–∞—Ä–∏—Ñ–Ω—ã–π –ª–∏–º–∏—Ç)
4. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–∏–¥–µ–æ: SELECT ... LIMIT 12 OFFSET
5. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç hasMore

**–û—Ç–≤–µ—Ç:**
```json
{
  "ok": true,
  "videos": [],
  "hasMore": true,
  "totalVideos": 150,
  "page": 0,
  "maxVideos": 60
}
```

### POST /api/video/{videoId}/refresh-date

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –≤–∏–¥–µ–æ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
2. –ü–æ–ª—É—á–∞–µ—Ç publishDate —Å retry (3 –ø–æ–ø—ã—Ç–∫–∏)
3. –ï—Å–ª–∏ —É—Å–ø–µ—Ö ‚Üí UPDATE channel_videos SET publishDate = ?

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "publishDate": "2024-12-08T00:00:00Z"
}
```

---

## 4. –°–û–°–¢–û–Ø–ù–ò–Ø UX –ò –ü–ï–†–ï–•–û–î–´

### –î–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π

```
STATE 1: Not Synced
‚îú‚îÄ hasSyncedTopVideos = false
‚îú‚îÄ hasShownVideos = false
‚îú‚îÄ UI: "–ù–∞–∂–º–∏—Ç–µ Sync Top Videos"
‚îî‚îÄ –ö–ª–∏–∫ –Ω–∞ "Sync Top Videos" ‚Üí POST /videos/sync ‚Üí router.refresh()
    ‚Üì

STATE 2: Synced but Hidden
‚îú‚îÄ hasSyncedTopVideos = true
‚îú‚îÄ hasShownVideos = false
‚îú‚îÄ UI: –ö–Ω–æ–ø–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ø-–≤–∏–¥–µ–æ"
‚îî‚îÄ –ö–ª–∏–∫ –Ω–∞ "–ü–æ–∫–∞–∑–∞—Ç—å" ‚Üí POST /videos/show ‚Üí router.refresh()
    ‚Üì

STATE 3: Videos Shown
‚îú‚îÄ hasSyncedTopVideos = true
‚îú‚îÄ hasShownVideos = true
‚îú‚îÄ UI: –°–µ—Ç–∫–∞ –≤–∏–¥–µ–æ + "–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë 12" (–µ—Å–ª–∏ applicable)
‚îî‚îÄ –ö–ª–∏–∫ "–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë 12" ‚Üí GET /videos/page?page=N
    ‚Üì
    –î–æ–±–∞–≤–ª—è–µ—Ç –≤–∏–¥–µ–æ –≤ —Å–ø–∏—Å–æ–∫ (–±–µ–∑ router.refresh)
```

---

## 5. –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–ï USER_CHANNEL_STATE

**–¢–∞–±–ª–∏—Ü–∞:** `/src/lib/db.ts` line 432-441

```sql
CREATE TABLE IF NOT EXISTS user_channel_state (
  userId TEXT NOT NULL,
  channelId TEXT NOT NULL,
  hasSyncedTopVideos INTEGER NOT NULL DEFAULT 0,
  hasShownVideos INTEGER NOT NULL DEFAULT 0,
  lastSyncAt INTEGER,
  lastShownAt INTEGER,
  PRIMARY KEY (userId, channelId)
);
```

**–°–º—ã—Å–ª —Ñ–ª–∞–≥–æ–≤:**

- `hasSyncedTopVideos`: –ü–æ–ª—É—á–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–æ –∏–∑ API
  - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `/videos/sync`
  - –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –ø–æ–∫–∞–∑ –∫–Ω–æ–ø–∫–∏ "–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ø-–≤–∏–¥–µ–æ"

- `hasShownVideos`: –ù–∞–∂–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ø-–≤–∏–¥–µ–æ"
  - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `/videos/show`
  - –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –ø–æ–∫–∞–∑ —Å–µ—Ç–∫–∏ –≤–∏–¥–µ–æ –∏ Load More

**–ú–∏–≥—Ä–∞—Ü–∏—è:**
```typescript
await addColumnIfNotExists(_client, 'user_channel_state', 'hasShownVideos', 'INTEGER NOT NULL DEFAULT 0');
await addColumnIfNotExists(_client, 'user_channel_state', 'lastSyncAt', 'INTEGER');
await addColumnIfNotExists(_client, 'user_channel_state', 'lastShownAt', 'INTEGER');
```

---

## 6. –ì–õ–û–ë–ê–õ–¨–ù–´–ô –ö–ï–® YOUTUBE

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω—è—Ç—å YouTube –¥–∞–Ω–Ω—ã–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—ç–∫–æ–Ω–æ–º–∏—è API –∑–∞–ø—Ä–æ—Å–æ–≤)

**–í—Ä–µ–º—è –∂–∏–∑–Ω–∏:** 24 —á–∞—Å–∞ (86400000 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥)

**–¢–∞–±–ª–∏—Ü—ã –∫–µ—à–∞:**

1. **channels_cache** - –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–Ω–∞–ª–µ
2. **channel_videos_cache** - –°–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –∫–∞–Ω–∞–ª–∞
3. **videos_cache** - –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∏–¥–µ–æ

**–õ–æ–≥–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ /videos/sync:**

```typescript
const cachedVideos = await getCachedChannelVideos(channelId);
const cachedChannel = await getCachedChannel(channelId);
const cacheAgeMs = Date.now() - cachedChannel.lastUpdated;
const isCacheFresh = cachedVideos.length > 0 && cacheAgeMs < 24 * 60 * 60 * 1000;

if (isCacheFresh) {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  videos = cachedVideos.slice(0, maxVideos);
} else {
  // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —É ScrapeCreators API
  videos = await getYoutubeChannelVideos(channelId, handle);
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫–µ—à
  await saveChannelVideosToCache(channelId, videos);
}
```

---

## 7. –ü–ê–ì–ò–ù–ê–¶–ò–Ø (LOAD MORE)

**–†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã:** `VIDEO_PAGE_SIZE = 12` –≤–∏–¥–µ–æ

**–¢–∞—Ä–∏—Ñ–Ω—ã–µ –ª–∏–º–∏—Ç—ã:**

```typescript
const TIER_VIDEO_LIMITS = {
  free: 12,          // –ë–µ–∑ Load More
  basic: 12,         // –ë–µ–∑ Load More
  professional: 60,  // –î–æ 5 —Å—Ç—Ä–∞–Ω–∏—Ü
  enterprise: 150,   // –î–æ 12+ —Å—Ç—Ä–∞–Ω–∏—Ü
};
```

**–£—Å–ª–æ–≤–∏–µ –ø–æ–∫–∞–∑–∞ –∫–Ω–æ–ø–∫–∏ "–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë 12":**

```typescript
{hasShownVideos && canLoadMore && hasMore && (
  <Button onClick={loadMore}>–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë 12</Button>
)}
```

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ hasMore –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

```typescript
const nextPageStart = (page + 1) * VIDEO_PAGE_SIZE;
const hasMore = nextPageStart < totalVideos && nextPageStart < maxVideos;
```

---

## 8. –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú –ò –ù–ï–°–û–°–¢–´–ö–û–í–û–ö

### –ü–†–û–ë–õ–ï–ú–ê 1: –ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–µ—à–∞
- User 1 —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –∫–∞–Ω–∞–ª ‚Üí –≤–∏–¥–µ–æ –≤ –∫–µ—à–µ
- User 2 —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Ç–æ—Ç –∂–µ –∫–∞–Ω–∞–ª ‚Üí –±–µ—Ä—ë—Ç –∏–∑ –∫–µ—à–∞
- –ù–æ –µ—Å–ª–∏ User 1 –æ–±–Ω–æ–≤–∏—Ç –∫–µ—à –ø–æ–∑–∂–µ ‚Üí —á—Ç–æ –≤–∏–¥–∏—Ç User 2?

### –ü–†–û–ë–õ–ï–ú–ê 2: –†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è publishDate
- ScrapeCreators API –º–æ–∂–µ—Ç –Ω–µ –≤–µ—Ä–Ω—É—Ç—å publishDate –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –≤–∏–¥–µ–æ
- Retry –º–µ—Ö–∞–Ω–∏–∑–º –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∫–Ω–æ–ø–∫—É ‚ü≥ –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –Ω–µ –ø–æ–º–æ—á—å

### –ü–†–û–ë–õ–ï–ú–ê 3: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ feedback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- Load More –º–æ–∂–µ—Ç fail –º–æ–ª—á–∞
- –ù–µ—Ç toast/alert —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–Ω–∞–µ—Ç —á—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å

### –ü–†–û–ë–õ–ï–ú–ê 4: –î–≤—É—Ö—ç—Ç–∞–ø–Ω–æ—Å—Ç—å Sync + Show
- –¢—Ä–µ–±—É–µ—Ç –¥–≤—É—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–π
- –ö–∞–∂–¥–∞—è —Ç—Ä–µ–±—É–µ—Ç router.refresh() –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
- –ù–µ–ø–æ–Ω—è—Ç–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ—á–µ–º—É –¥–≤–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏

### –ü–†–û–ë–õ–ï–ú–ê 5: router.refresh() –º–µ–¥–ª–µ–Ω–Ω—ã–π
- –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–¥–µ–ª–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤ page.tsx
- –ú–µ—Ä—Ü–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ü–æ—Ç–µ—Ä—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏

### –ü–†–û–ë–õ–ï–ú–ê 6: –ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç —Ç–∞—Ä–∏—Ñ ‚Üí maxVideos –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—é –º–µ–∂–¥—É UI –∏ –ë–î

### –ü–†–û–ë–õ–ï–ú–ê 7: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ retry –ø—Ä–∏ –æ—à–∏–±–∫–µ Load More
- –ï—Å–ª–∏ —Å–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ ‚Üí –≤–∏–¥–µ–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
- –ù–µ—Ç –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–∞ –ø–æ–ø—ã—Ç–∫–∏

### –ü–†–û–ë–õ–ï–ú–ê 8: Race condition –ø—Ä–∏ –±—ã—Å—Ç—Ä—ã—Ö –∫–ª–∏–∫–∞—Ö
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞–∂–∞—Ç—å "–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë 12" –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–¥—Ä—è–¥
- –ú–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –≤–∏–¥–µ–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑

### –ü–†–û–ë–õ–ï–ú–ê 9: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É sortedVideos –∏ videoList
- videoList —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–∏–¥–µ–æ –≤ –ø–æ—Ä—è–¥–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏
- sortedVideos —ç—Ç–æ –≤–∏–¥–µ–æ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º
- Pagination –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ unsorted videoList

### –ü–†–û–ë–õ–ï–ú–ê 10: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
- channelId –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è API
- –ï—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω ‚Üí —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–ª—á–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

---

## 9. –ö–ê–†–¢–ê –í–°–ï–• –°–í–Ø–ó–ê–ù–ù–´–• –§–ê–ô–õ–û–í

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `TopVideosGrid.tsx` - –°–µ—Ç–∫–∞ –≤–∏–¥–µ–æ
- `TopVideosTable.tsx` - –¢–∞–±–ª–∏—Ü–∞ –≤–∏–¥–µ–æ
- `ChannelAnalytics.tsx` - –û–±–µ—Ä—Ç–∫–∞ —Å–æ —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å—é
- `SyncVideosButton.tsx` - –ö–Ω–æ–ø–∫–∞ Sync

### –°—Ç—Ä–∞–Ω–∏—Ü—ã
- `src/app/(dashboard)/channel/[id]/page.tsx` - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞–Ω–∞–ª–∞

### API Routes
- `src/app/api/channel/[id]/videos/sync/route.ts` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- `src/app/api/channel/[id]/videos/show/route.ts` - –ü–æ–∫–∞–∑–∞—Ç—å –≤–∏–¥–µ–æ
- `src/app/api/channel/[id]/videos/page/route.ts` - –ü–∞–≥–∏–Ω–∞—Ü–∏—è
- `src/app/api/channel/[id]/videos/enrich/route.ts` - –û–±–æ–≥–∞—â–µ–Ω–∏–µ –≤–∏–¥–µ–æ
- `src/app/api/video/[videoId]/refresh-date/route.ts` - –û–±–Ω–æ–≤–∏—Ç—å –¥–∞—Ç—É

### –£—Ç–∏–ª–∏—Ç—ã
- `src/lib/db.ts` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î, —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
- `src/lib/date-formatting.ts` - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç
- `src/lib/scrapecreators.ts` - –ö–ª–∏–µ–Ω—Ç ScrapeCreators API
- `src/lib/user-plan.ts` - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `src/lib/cache/youtube-cache.ts` - –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫–µ—à

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `src/config/limits.ts` - –¢–∞—Ä–∏—Ñ–Ω—ã–µ –ª–∏–º–∏—Ç—ã –≤–∏–¥–µ–æ

### –¢–∞–±–ª–∏—Ü—ã –ë–î
- `competitors` - –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ –∫–∞–Ω–∞–ª—ã
- `channel_videos` - –í–∏–¥–µ–æ –∫–∞–Ω–∞–ª–æ–≤ (–ª–æ–∫–∞–ª—å–Ω—ã–µ)
- `user_channel_state` - –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–ª—é—á: userId + channelId)
- `channels_cache` - –ö–µ—à –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–∞–Ω–∞–ª–∞—Ö
- `channel_videos_cache` - –ö–µ—à —Å–ø–∏—Å–∫–æ–≤ –≤–∏–¥–µ–æ
- `videos_cache` - –ö–µ—à –¥–µ—Ç–∞–ª–µ–π –≤–∏–¥–µ–æ

---

## 10. –í–´–í–û–î–´ –ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ö–∞–∫ —Å–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
User –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É
  ‚Üì
Client –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç API –∑–∞–ø—Ä–æ—Å
  ‚Üì
Server –æ–±–Ω–æ–≤–ª—è–µ—Ç –ë–î (channel_videos, user_channel_state, –∫–µ—à)
  ‚Üì
router.refresh() –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç page.tsx
  ‚Üì
page.tsx —Å–Ω–æ–≤–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
  ‚Üì
Props –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
  ‚Üì
UI –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
```

### –ß—Ç–æ –ü–†–ê–í–ò–õ–¨–ù–û

‚úÖ –ú–æ–¥—É–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ API (–æ—Ç–¥–µ–ª—å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)
‚úÖ UX-–∏–∑–æ–ª—è—Ü–∏—è —á–µ—Ä–µ–∑ user_channel_state (–∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ–∑–∞–≤–∏—Å–∏–º)
‚úÖ –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫–µ—à –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (—ç–∫–æ–Ω–æ–º–∏—è API)
‚úÖ Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è publishDate (3 –ø–æ–ø—ã—Ç–∫–∏)
‚úÖ –¢–∞—Ä–∏—Ñ–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ API –∏ UI
‚úÖ –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–µ —Å–µ–∫—Ü–∏–∏ (–Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)

### –ß—Ç–æ –ù–£–ñ–ù–û —É–ª—É—á—à–∏—Ç—å

‚ùå –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ (toast, feedback)
‚ùå –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI (–Ω–µ router.refresh)
‚ùå –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É publishDate (–Ω–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π)
‚ùå –î–æ–±–∞–≤–∏—Ç—å retry –¥–ª—è Load More (–ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö)
‚ùå –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ Sync + Show (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –£–∑–∫–∏–µ –º–µ—Å—Ç–∞ UX

üî¥ –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (router.refresh —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ–ø—Ä–æ—Å–∞)
üî¥ –ù–µ–ø–æ–Ω—è—Ç–Ω–∞—è –¥–≤—É—Ö—ç—Ç–∞–ø–Ω–æ—Å—Ç—å (Sync + Show)
üî¥ –ö–Ω–æ–ø–∫–∞ ‚ü≥ –±–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏–π (–º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å)
üî¥ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ feedback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
üî¥ Race condition –ø—Ä–∏ –±—ã—Å—Ç—Ä—ã—Ö –∫–ª–∏–∫–∞—Ö

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –æ–ø–∞—Å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

‚ùå –£–±—Ä–∞—Ç—å user_channel_state (–ø–æ—Ç–µ—Ä—è UX-–∏–∑–æ–ª—è—Ü–∏–∏)
‚ùå –£–±—Ä–∞—Ç—å —Ñ–ª–∞–≥–∏ hasSyncedTopVideos/hasShownVideos
‚ùå –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å API —Å—Ç—Ä—É–∫—Ç—É—Ä—É
‚ùå –£–¥–∞–ª–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É channel_videos
‚ùå –ò–∑–º–µ–Ω–∏—Ç—å PRIMARY KEY user_channel_state

### –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

‚úÖ –î–æ–±–∞–≤–∏—Ç—å toast –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å Fetch –≤—ã–∑–æ–≤—ã (useSWR)
‚úÖ –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É publishDate
‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é props –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
‚úÖ –£–ª—É—á—à–∏—Ç—å retry –ª–æ–≥–∏–∫—É –¥–ª—è Load More
‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚úÖ –û–±–Ω–æ–≤–∏—Ç—å CSS —Å—Ç–∏–ª–∏
‚úÖ –ò–∑–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏–π

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-10
**–í–µ—Ä—Å–∏—è –æ—Ç—á—ë—Ç–∞:** 1.0
**–°—Ç–∞—Ç—É—Å:** –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑
