# Changes

This file is intentionally kept minimal.
All changes are tracked in git history.

---

## 2025-12-12 - Исправление обработки ошибок в Momentum API

### Проблема
При ошибке генерации анализа momentum пользователь видел в консоли пустой объект `{}` вместо понятного сообщения об ошибке, и ошибка не отображалась в интерфейсе.

### Решение
Обновлен компонент `MomentumInsightsSection`:
- ✅ Добавлено состояние `error` для хранения текста ошибки
- ✅ Извлечение сообщения об ошибке из API ответа: `syncError?.error`
- ✅ Отображение ошибки в интерфейсе с стилем `destructive`
- ✅ Явные резервные сообщения об ошибках для обеих операций (sync и show)
- ✅ Добавлены логи с префиксом `[MomentumInsightsSection]` для отладки

Все momentum API endpoints уже имели правильную обработку ошибок с явными сообщениями. Проблема была в том, что frontend компонент не извлекал и не отображал эти сообщения пользователю.

### Гарантии архитектуры
- ✅ Пользователь видит понятное сообщение об ошибке в интерфейсе
- ✅ Сообщение об ошибке логируется в консоль с контекстом
- ✅ Обе операции (POST momentum и POST momentum/show) имеют собственные сообщения об ошибках
- ✅ Неудачная операция не блокирует пользователя молча - ошибка отображается явно

---

## 2025-12-12 - Глобальное хранилище состояния генерации аналитики (Generation Status Store)

### Проблема
Состояние кнопок генерации аналитики теряется при collapse/unmount компонентов, что приводит к:
- Потере статуса загрузки при сворачивании секции
- Возможности повторного запуска генерации, уже находящейся в процессе
- Дублированию задач на бэкенде

### Решение
Создан глобальный Zustand store для надежного хранения состояния генерации:
- **Новый файл:** `src/store/generationStatusStore.ts` - глобальное хранилище состояния
- **Тип:** `GenerationStatus = "idle" | "loading" | "success" | "error"`
- **Ключ состояния:** `${competitorId}:${sectionType}` - уникален на связку компонента и компетитора

### Обновленные компоненты
1. **ContentIntelligenceBlock.tsx** - теперь использует store для состояния загрузки
2. **MomentumInsights.tsx** - переведён на глобальное состояние
3. **DeepCommentAnalysis.tsx** - состояние синхронизировано через store
4. **AudienceInsights.tsx** - обновлён для использования глобального store
5. **DeepAudienceAnalysis.tsx** - состояние генерации в глобальном хранилище
6. **CommentInsights.tsx** - заменён на useGenerationStatusStore

### Гарантии архитектуры
- ✅ Состояние НЕ теряется при collapse/unmount
- ✅ Невозможно запустить дублирующиеся задачи
- ✅ Состояние уникально для каждого компонента и компетитора
- ✅ Полная совместимость с существующими API endpoints
- ✅ Не требуются изменения в backend
- ✅ Масштабируется на новые типы анализа
