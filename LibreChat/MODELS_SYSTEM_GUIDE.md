# ๐ฏ ะะพะปะฝะพะต ััะบะพะฒะพะดััะฒะพ: ะกะธััะตะผะฐ ัะฟัะฐะฒะปะตะฝะธั ะผะพะดะตะปัะผะธ ะธ ัะฐัะธัะฐะผะธ

## โ ะงัะพ ัะตะฐะปะธะทะพะฒะฐะฝะพ

### 1. **ะะ - ะะฐัะฐะปะพะณ ะผะพะดะตะปะตะน (AiModel.js)**
โ 14 ะพัะฝะพะฒะฝัั ะผะพะดะตะปะตะน:
- **OpenAI:** gpt-4o, gpt-4o-mini, gpt-4.1-mini, gpt-4-turbo, gpt-4, gpt-3.5-turbo, ะธ ั.ะด.
- **Anthropic:** claude-sonnet-4-6, claude-opus-4-6, claude-haiku-3.5
- **DeepSeek:** deepseek-chat, deepseek-reasoner
- **Google:** gemini-2.0-flash, gemini-1.5-pro
- **Groq:** llama-3.1-70b-versatile, mixtral-8x7b-32768

### 2. **ะะ - ะขะฐัะธัะฝัะต ะฟะปะฐะฝั (Plan.js)**
โ 3 ะฟะปะฐะฝะฐ ั ัะฐะทะฝัะผะธ ะผะพะดะตะปัะผะธ:
- **FREE:** 2 ะผะพะดะตะปะธ (gpt-4o-mini, gpt-3.5-turbo)
- **PRO:** 7 ะผะพะดะตะปะตะน (GPT-4o, Claude, DeepSeek ะธ ั.ะด.)
- **BUSINESS:** 15 ะผะพะดะตะปะตะน (ะฒัะต ะพัะฝะพะฒะฝัะต)

### 3. **API - ะฃะฟัะฐะฒะปะตะฝะธะต ะผะพะดะตะปัะผะธ**

#### `/api/models/all` (ะฟัะฑะปะธัะฝัะน)
ะะพะทะฒัะฐัะฐะตั **ะฒัะต ะฐะบัะธะฒะฝัะต ะผะพะดะตะปะธ** ะธะท ะะ
```json
{
  "models": [
    { "modelId": "gpt-4o", "provider": "openai", "endpointKey": "openAI", "displayName": "GPT-4o" },
    { "modelId": "gpt-4o-mini", "provider": "openai", "endpointKey": "openAI", "displayName": "GPT-4o Mini" },
    ...
  ]
}
```

#### `/api/models/allowed` (ั auth)
ะะพะทะฒัะฐัะฐะตั **ัะพะปัะบะพ ะผะพะดะตะปะธ ัะฐะทัะตััะฝะฝัะต ะดะปั ัะตะบััะตะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั**:
1. ะัะพะฒะตััะตั ะฟะพะดะฟะธัะบั ะฟะพะปัะทะพะฒะฐัะตะปั (ะบะฐะบะพะน ั ะฝะตะณะพ ะฟะปะฐะฝ)
2. ะะฐัะพะดะธั `allowedModels` ะดะปั ััะพะณะพ ะฟะปะฐะฝะฐ
3. ะะพะทะฒัะฐัะฐะตั ัะพะปัะบะพ ััะธ ะผะพะดะตะปะธ

```json
{
  "models": [ ... ะผะพะดะตะปะธ ะดะปั ะฟะปะฐะฝะฐ ะฟะพะปัะทะพะฒะฐัะตะปั ... ],
  "plan": "pro"
}
```

#### `/api/admin/mvp/plans` (ะฐะดะผะธะฝ)
ะฃะฟัะฐะฒะปะตะฝะธะต ะฟะปะฐะฝะฐะผะธ ะธ ะธั ะผะพะดะตะปัะผะธ:
- GET - ะฟะพะปััะธัั ะฒัะต ะฟะปะฐะฝั
- PATCH `/api/admin/mvp/plans/:planId` - ะพะฑะฝะพะฒะธัั ะฟะปะฐะฝ

### 4. **ะะดะผะธะฝ ะฟะฐะฝะตะปั (Settings โ ะะปะฐะฝั)**

โ **ะะปั ะบะฐะถะดะพะณะพ ะฟะปะฐะฝะฐ ะฟะพะบะฐะทัะฒะฐัััั:**
- ะะฐะทะฒะฐะฝะธะต ะฟะปะฐะฝะฐ
- ะฆะตะฝะฐ (โฝ)
- ะัะตะดะธัั ะฟัะธ ะฟะพะบัะฟะบะต
- **ะกะฟะธัะพะบ ัะตะบะฑะพะบัะพะฒ ัะพ ะฒัะตะผะธ ะผะพะดะตะปัะผะธ** โ ะฒะพั ััะพ ะณะปะฐะฒะฝะพะต!

**ะะฐะบ ัะตะดะฐะบัะธัะพะฒะฐัั:**
1. ะะฐะนัะธ Admin Panel โ Settings
2. ะะฐะนัะธ ะฝัะถะฝัะน ะฟะปะฐะฝ (Free/Pro/Business)
3. ะัะผะตัะธัั/ะพัะผะตัะธัั ัะตะบะฑะพะบัั ะดะปั ะผะพะดะตะปะตะน
4. ะะฐะถะฐัั "ะกะพััะฐะฝะธัั"
5. ะะทะผะตะฝะตะฝะธั ะฟัะธะผะตะฝััััั ะฝะตะผะตะดะปะตะฝะฝะพ ัะตัะตะท React Query ะบัั (60 ัะตะบ)

### 5. **ะกะตะปะตะบัะพั ะผะพะดะตะปะตะน ะฒ ัะฐัะต**

โ **ะะพะณะธะบะฐ:**
1. ะัะธ ะพัะบัััะธะธ ัะตะปะตะบัะพัะฐ ะทะฐะณััะถะฐะตั `/api/models/allowed`
2. ะะพะปััะฐะตั ัะฟะธัะพะบ ัะฐะทัะตััะฝะฝัั ะผะพะดะตะปะตะน ะดะปั ัะตะบััะตะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั
3. ะััะธะปัััะพะฒัะฒะฐะตั `modelSpecs` ะธะท YAML ัะพะปัะบะพ ะฟะพ ัะฐะทัะตััะฝะฝัะผ
4. ะะพะบะฐะทัะฒะฐะตั **ะขะะะฌะะ ัะต ะผะพะดะตะปะธ ะบะพัะพััะต ะดะพัััะฟะฝั ะดะปั ะฟะปะฐะฝะฐ**

**ะะตะทัะปััะฐัั:**
- **Free ะฟะพะปัะทะพะฒะฐัะตะปั ะฒะธะดะธั:** ัะพะปัะบะพ 2 ะผะพะดะตะปะธ (gpt-4o-mini, gpt-3.5-turbo)
- **Pro ะฟะพะปัะทะพะฒะฐัะตะปั ะฒะธะดะธั:** 7 ะผะพะดะตะปะตะน
- **Business ะฟะพะปัะทะพะฒะฐัะตะปั ะฒะธะดะธั:** 15 ะผะพะดะตะปะตะน

---

## ๐งช ะะฐะบ ัะตััะธัะพะฒะฐัั

### ะขะตัั 1: ะะดะผะธะฝ ะฟะฐะฝะตะปั
```
1. ะะฐะนัะธ ะฒ Admin Panel โ Settings
2. ะะพะปะถะฝั ัะฒะธะดะตัั 3 ะฟะปะฐะฝะฐ ั ัะตะบะฑะพะบัะฐะผะธ
3. Free ะดะพะปะถะตะฝ ะธะผะตัั 2 ะพัะผะตัะตะฝะฝัั ะผะพะดะตะปะธ
4. Pro ะดะพะปะถะตะฝ ะธะผะตัั 7 ะพัะผะตัะตะฝะฝัั ะผะพะดะตะปะตะน
5. Business ะดะพะปะถะตะฝ ะธะผะตัั 15 ะพัะผะตัะตะฝะฝัั ะผะพะดะตะปะตะน
```

### ะขะตัั 2: API ะผะพะดะตะปะธ
```bash
# ะัะต ะผะพะดะตะปะธ
curl http://localhost/api/models/all

# ะะพะดะตะปะธ ะดะปั ัะตะบััะตะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั (ะฝัะถะฝะฐ auth)
curl -H "Authorization: Bearer TOKEN" http://localhost/api/models/allowed
```

### ะขะตัั 3: ะกะตะปะตะบัะพั ะฒ ัะฐัะต
```
1. ะะฐะปะพะณะธะฝะธัััั ะบะฐะบ FREE ะฟะพะปัะทะพะฒะฐัะตะปั
2. ะัะบัััั ัะตะปะตะบัะพั ะผะพะดะตะปะตะน ะฒ ัะฐัะต
3. ะะพะปะถะฝั ะฒะธะดะตัั ะขะะะฌะะ: gpt-4o-mini, gpt-3.5-turbo
4. ะะพะฟัะพะฑะพะฒะฐัั ะฝะฐะฟะธัะฐัั ัะพะพะฑัะตะฝะธะต
5. ะัะต ะดะพะปะถะฝั ัะฐะฑะพัะฐัั

6. ะะฐะปะพะณะธะฝะธัััั ะบะฐะบ PRO ะฟะพะปัะทะพะฒะฐัะตะปั
7. ะัะบัััั ัะตะปะตะบัะพั
8. ะะพะปะถะฝั ะฒะธะดะตัั 7 ะผะพะดะตะปะตะน
9. ะัะต ะดะพะปะถะฝั ัะฐะฑะพัะฐัั
```

### ะขะตัั 4: ะะธะฝะฐะผะธัะตัะบะพะต ะพะฑะฝะพะฒะปะตะฝะธะต
```
1. ะะดะผะธะฝ ะทะฐัะพะดะธั ะฒ Settings
2. ะฃะฑะธัะฐะตั ะณะฐะปะพัะบั ั claude-sonnet-4-6 ะธะท Pro ะฟะปะฐะฝะฐ
3. ะะฐะถะธะผะฐะตั "ะกะพััะฐะฝะธัั"
4. Pro ะฟะพะปัะทะพะฒะฐัะตะปั ะพะฑะฝะพะฒะปัะตั ัััะฐะฝะธัั (ะธะปะธ ะถะดัั 60 ัะตะบ)
5. claude-sonnet-4-6 ะดะพะปะถะฝะฐ ะธััะตะทะฝััั ะธะท ะตะณะพ ัะตะปะตะบัะพัะฐ
```

---

## ๐ ะััะธัะตะบัััะฐ ะดะฐะฝะฝัั

```
ะะ (MongoDB)
โโโ AiModel (ะบะฐัะฐะปะพะณ ะผะพะดะตะปะตะน)
โ   โโโ gpt-4o-mini
โ   โโโ gpt-4.1-mini
โ   โโโ claude-sonnet-4-6
โ   โโโ ... 14 ะผะพะดะตะปะตะน ะฒัะตะณะพ
โ
โโโ Plan (ัะฐัะธัะฝัะต ะฟะปะฐะฝั)
    โโโ free โ allowedModels: ['gpt-4o-mini', 'gpt-3.5-turbo']
    โโโ pro โ allowedModels: ['gpt-4o', 'gpt-4o-mini', 'gpt-4.1-mini', ...]
    โโโ business โ allowedModels: [ะฒัะต 15 ะผะพะดะตะปะตะน]

User (Subscription)
โโโ userId
โโโ plan: 'pro'
โโโ planExpiresAt: Date

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              API Endpoints                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ /api/models/all         โ All models from AiModel   โ
โ /api/models/allowed     โ Models for user's plan    โ
โ /api/admin/mvp/plans    โ Manage plans              โ
โ /api/admin/mvp/models   โ Manage models             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              ะะปะธะตะฝั (Frontend)                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ AdminPanel.tsx                                      โ
โ โโ loadSettings() โ GET /api/admin/mvp/plans       โ
โ โโ savePlan() โ PATCH /api/admin/mvp/plans/:id     โ
โ โโ availableModels โ GET /api/models/all           โ
โ                                                     โ
โ ModelSelectorContext.tsx                           โ
โ โโ /api/models/allowed (React Query)               โ
โ โโ ะคะธะปััััะตั modelSpecs ะฟะพ allowedModelIds         โ
โ                                                     โ
โ Chat Selector                                      โ
โ โโ ะะพะบะฐะทัะฒะฐะตั ัะพะปัะบะพ ัะฐะทัะตััะฝะฝัะต ะผะพะดะตะปะธ           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ะะพัะพะบ ะดะฐะฝะฝัั ะฟัะธ ะฒัะฑะพัะต ะผะพะดะตะปะธ

```
ะะพะปัะทะพะฒะฐัะตะปั ะพัะบััะฒะฐะตั ัะฐั
    โ
ModelSelectorContext ะทะฐะณััะถะฐะตั /api/models/allowed
    โ
ะกะตัะฒะตั ะฟัะพะฒะตััะตั:
  1. ะัะพ ััะพ (userId)
  2. ะะฐะบะพะน ั ะฝะตะณะพ ะฟะปะฐะฝ (Subscription)
  3. ะะฐะบะธะต ะผะพะดะตะปะธ ัะฐะทัะตัะตะฝั ะดะปั ััะพะณะพ ะฟะปะฐะฝะฐ (Plan.allowedModels)
    โ
ะะพะทะฒัะฐัะฐะตั ะผะพะดะตะปะธ: [gpt-4o-mini, gpt-4.1-mini, ...]
    โ
ะกะตะปะตะบัะพั ัะธะปััััะตั modelSpecs:
  - ะะตััั ะณะฐัะฐะฝัะธัะพะฒะฐะฝะฝัะต preset ะผะพะดะตะปะตะน ะธะท YAML
  - ะััะฐะฒะปัะตั ัะพะปัะบะพ ัะต ััะพ ะฒ allowedModelIds
    โ
ะะพะปัะทะพะฒะฐัะตะปั ะฒะธะดะธั ัะตะปะตะบัะพั ั ะขะะะฌะะ ะตะณะพ ะผะพะดะตะปัะผะธ
    โ
ะัะฑะธัะฐะตั ะผะพะดะตะปั โ ะพัะฟัะฐะฒะปัะตั ัะพะพะฑัะตะฝะธะต
    โ
ะกะตัะฒะตั ะฟัะพะฒะตััะตั: ัะฐะทัะตัะตะฝะฐ ะปะธ ััะฐ ะผะพะดะตะปั ะดะปั ะฟะปะฐะฝะฐ
    โ
ะะฑัะฐะฑะฐััะฒะฐะตั ะทะฐะฟัะพั ะธะปะธ ะพัะธะฑะบะฐ "Model not allowed"
```

---

## โ๏ธ ะะฐะบ ะดะพะฑะฐะฒะธัั ะฝะพะฒัั ะผะพะดะตะปั

### ะะฐัะธะฐะฝั 1: ะงะตัะตะท ะบะพะด (ัะฐะทัะฐะฑะพััะธะบ)
1. ะััะตะดะฐะบัะธัะพะฒะฐัั `api/models/AiModel.js` SEED_DEFAULTS
2. ะะพะฑะฐะฒะธัั ะฝะพะฒัั ัััะพะบั ั ะผะพะดะตะปัั
3. ะะ ะฟะตัะตะธะฝะธัะธะฐะปะธะทะธััะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ (seedDefaults)

### ะะฐัะธะฐะฝั 2: ะงะตัะตะท ะฐะดะผะธะฝ ะฟะฐะฝะตะปั (ะฐะดะผะธะฝ)
1. Admin Panel โ Settings โ ะะพะดะตะปะธ (ะตัะปะธ ะตััั ัะฐะบะพะน ัะฐะทะดะตะป)
2. ะะปะธ ะฟัะพััะพ ะพััะตะดะฐะบัะธัะพะฒะฐัั Plan.allowedModels ะฒัััะฝัั ัะตัะตะท API

---

## ๐จ ะะฐะถะฝัะต ะผะพะผะตะฝัั

### โ ะะฐะฑะพัะฐะตั ะฟัะฐะฒะธะปัะฝะพ:
- โ ะะดะผะธะฝ ะผะพะถะตั ัะฟัะฐะฒะปััั ะบะฐะบะธะต ะผะพะดะตะปะธ ะฒ ะบะฐะบะพะผ ะฟะปะฐะฝะต
- โ Free ะฒะธะดะธั ัะพะปัะบะพ ัะฒะพะธ ะผะพะดะตะปะธ
- โ Pro ะฒะธะดะธั ัะฒะพะธ ะผะพะดะตะปะธ
- โ ะกะตะปะตะบัะพั ัะธะปััััะตััั ะฟะพ ะฟะปะฐะฝั ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
- โ ะัั ะฝะฐ 60 ัะตะบัะฝะด (ะฑััััะพ, ะฝะพ ะฑะตะทะพะฟะฐัะฝะพ)

### โ๏ธ ะงัะพ ะฝัะถะฝะพ ััะธััะฒะฐัั:
- ะัะปะธ ะฟะพะปัะทะพะฒะฐัะตะปั ะผะตะฝัะตั ะฟะปะฐะฝ โ ะฝัะถะฝะพ ะพะฑะฝะพะฒะธัั ัััะฐะฝะธัั (ะบัั 60 ัะตะบ)
- ะัะปะธ ะฐะดะผะธะฝ ะผะตะฝัะตั allowedModels โ ะฟะพะปัะทะพะฒะฐัะตะปั ัะฒะธะดะธั ะทะฐ 60 ัะตะบ (ะบัั)
- ะะพะดะตะปั ะดะพะปะถะฝะฐ ัััะตััะฒะพะฒะฐัั ะฒ AiModel ััะพะฑั ะฑััั ะฒ allowedModels
- ะะพะดะตะปั ะดะพะปะถะฝะฐ ะฑััั `isActive: true` ััะพะฑั ะพัะพะฑัะฐะถะฐัััั

---

## ๐ ะคะฐะนะปั ะบะพัะพััะต ะฝัะถะฝะพ ะทะฝะฐัั

| ะคะฐะนะป | ะงัะพ ัะฐะผ |
|------|---------|
| `api/models/AiModel.js` | ะะฐัะฐะปะพะณ ะฒัะตั ะผะพะดะตะปะตะน (SEED_DEFAULTS) |
| `api/models/Plan.js` | ะขะฐัะธัะฝัะต ะฟะปะฐะฝั ะธ ะธั allowedModels |
| `api/server/routes/models.js` | API endpoints ะดะปั ะผะพะดะตะปะตะน |
| `client/src/routes/AdminPanel.tsx` | ะะดะผะธะฝ ะฟะฐะฝะตะปั ั ัะตะบะฑะพะบัะฐะผะธ |
| `client/src/components/Chat/Menus/Endpoints/ModelSelectorContext.tsx` | ะคะธะปัััะฐัะธั ะผะพะดะตะปะตะน ะฟะพ ะฟะปะฐะฝั |

---

## โ ะงะตะบ-ะปะธัั ััะพ ะฟัะพะฒะตัะธัั

- [ ] ะะ ัะพะดะตัะถะธั 14+ ะผะพะดะตะปะตะน (AiModel.js SEED_DEFAULTS)
- [ ] 3 ะฟะปะฐะฝะฐ ั ัะฐะทะฝัะผะธ allowedModels (Plan.js SEED_DEFAULTS)
- [ ] `/api/models/all` ะฒะพะทะฒัะฐัะฐะตั ะฒัะต ะผะพะดะตะปะธ
- [ ] `/api/models/allowed` ะฒะพะทะฒัะฐัะฐะตั ะผะพะดะตะปะธ ะดะปั ะฟะปะฐะฝะฐ
- [ ] ะะดะผะธะฝ ะฟะฐะฝะตะปั ะฟะพะบะฐะทัะฒะฐะตั ัะตะบะฑะพะบัั ะดะปั ะผะพะดะตะปะตะน
- [ ] ะกะตะปะตะบัะพั ะฒ ัะฐัะต ัะธะปััััะตััั ะฟะพ ะฟะปะฐะฝั ะฟะพะปัะทะพะฒะฐัะตะปั
- [ ] Free ะฒะธะดะธั 2 ะผะพะดะตะปะธ, Pro ะฒะธะดะธั 7, Business ะฒะธะดะธั 15
- [ ] ะะพัะปะต ะธะทะผะตะฝะตะฝะธั ะฒ ะฐะดะผะธะฝ ะฟะฐะฝะตะปะธ ะฒัั ะพะฑะฝะพะฒะปัะตััั ัะตัะตะท 60 ัะตะบ

**ะัั ะณะพัะพะฒะพ!** ๐
